<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: xtb_optimizer Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li class="current"><a href="namespaces.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Types&#160;List</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="namespaces.html"><span>Modules&#160;List</span></a></li>
      <li><a href="namespacemembers.html"><span>Module&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Types</a> &#124;
<a href="#func-members">Functions/Subroutines</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">xtb_optimizer Module Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Types</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">interface &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structxtb__optimizer_1_1convergence__log.html">convergence_log</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:ab081e2736bbf00fa907a142b49fbac44"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacextb__optimizer.html#ab081e2736bbf00fa907a142b49fbac44">get_optthr</a> (n, olev, ethr, gthr, maxcycle, acc)</td></tr>
<tr class="separator:ab081e2736bbf00fa907a142b49fbac44"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1743159550358c92fb2761af80e15285"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacextb__optimizer.html#a1743159550358c92fb2761af80e15285">ancopt</a> (env, ilog, mol, <a class="el" href="neighbor_8f90.html#a5df91039130b0032e4f6ce1853b1af8a">chk</a>, calc, egap, et, maxiter, maxcycle_in, etot, g, sigma, tight, pr, fail)</td></tr>
<tr class="separator:a1743159550358c92fb2761af80e15285"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ae8aa844914d8a5dfd34b5a91faaf32"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacextb__optimizer.html#a0ae8aa844914d8a5dfd34b5a91faaf32">relax</a> (env, iter, mol, anc, restart, maxcycle, maxdispl, ethr, gthr, ii, <a class="el" href="neighbor_8f90.html#a5df91039130b0032e4f6ce1853b1af8a">chk</a>, calc, egap, acc_in, et, maxiter, iupdat, etot, g, sigma, ilog, pr, fail, converged, timer, exact, avconv)</td></tr>
<tr class="memdesc:a0ae8aa844914d8a5dfd34b5a91faaf32"><td class="mdescLeft">&#160;</td><td class="mdescRight">actual optimization procedure  <a href="namespacextb__optimizer.html#a0ae8aa844914d8a5dfd34b5a91faaf32">More...</a><br /></td></tr>
<tr class="separator:a0ae8aa844914d8a5dfd34b5a91faaf32"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ac82175dfc1e58dcde2f5ae0cf4ed2d"><td class="memItemLeft" align="right" valign="top">pure subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacextb__optimizer.html#a2ac82175dfc1e58dcde2f5ae0cf4ed2d">solver_ssyevx</a> (n, thr, A, U, e, fail)</td></tr>
<tr class="separator:a2ac82175dfc1e58dcde2f5ae0cf4ed2d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac6dbeb7fcdaa9630e9042c20479010d9"><td class="memItemLeft" align="right" valign="top">pure subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacextb__optimizer.html#ac6dbeb7fcdaa9630e9042c20479010d9">solver_sspevx</a> (n, thr, A, U, e, fail)</td></tr>
<tr class="separator:ac6dbeb7fcdaa9630e9042c20479010d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac5e0b67e6d0738befcb2a7b5b3a232e"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacextb__optimizer.html#aac5e0b67e6d0738befcb2a7b5b3a232e">findlroot</a> (i0, n, e, el)</td></tr>
<tr class="separator:aac5e0b67e6d0738befcb2a7b5b3a232e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa550726c73111ebcaad1877c07586771"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacextb__optimizer.html#aa550726c73111ebcaad1877c07586771">sort</a> (nat3, nvar, hess, b)</td></tr>
<tr class="separator:aa550726c73111ebcaad1877c07586771"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8b96d1bdf59374d1f9d98170739bbf6"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacextb__optimizer.html#ad8b96d1bdf59374d1f9d98170739bbf6">prdechng</a> (nat3, grad, displ, hess, depred)</td></tr>
<tr class="separator:ad8b96d1bdf59374d1f9d98170739bbf6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9e82f5562bec14f4a2b3dbd9bb5c804d"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacextb__optimizer.html#a9e82f5562bec14f4a2b3dbd9bb5c804d">trfp2xyz</a> (nvar, nat3, p, xyz0, h, dspl)</td></tr>
<tr class="separator:a9e82f5562bec14f4a2b3dbd9bb5c804d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0811d242ecca3d083b72ce4ffe706d6e"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacextb__optimizer.html#a0811d242ecca3d083b72ce4ffe706d6e">prdispl</a> (nvar, displ)</td></tr>
<tr class="separator:a0811d242ecca3d083b72ce4ffe706d6e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9fc9ad9955c0a2ef4872d25495d02901"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacextb__optimizer.html#a9fc9ad9955c0a2ef4872d25495d02901">modhes</a> (env, calc, modh, natoms, xyz, chg, Hess, pr)</td></tr>
<tr class="separator:a9fc9ad9955c0a2ef4872d25495d02901"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b94fa2f1fead1036c5fcf11605a23a1"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacextb__optimizer.html#a7b94fa2f1fead1036c5fcf11605a23a1">itochess</a> (nvar, nat3, b, hess, fc)</td></tr>
<tr class="separator:a7b94fa2f1fead1036c5fcf11605a23a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a883d1b09a784468979d989277b406a30"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacextb__optimizer.html#a883d1b09a784468979d989277b406a30">read_hessian</a> (ihess, ndim, hessian, error)</td></tr>
<tr class="separator:a883d1b09a784468979d989277b406a30"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4e5edb3c372707d7fc17738f8e563088"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacextb__optimizer.html#a4e5edb3c372707d7fc17738f8e563088">geoconvav</a> (nc, e, g, val, deriv)</td></tr>
<tr class="separator:a4e5edb3c372707d7fc17738f8e563088"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a162008fd7928b139bb350d4f04973108"><td class="memItemLeft" align="right" valign="top">pure type(<a class="el" href="structxtb__optimizer_1_1convergence__log.html">convergence_log</a>) function&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacextb__optimizer.html#a162008fd7928b139bb350d4f04973108">new_convergence_log</a> (nmax)</td></tr>
<tr class="separator:a162008fd7928b139bb350d4f04973108"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c5a5499961d823aba5503ed3aed9716"><td class="memItemLeft" align="right" valign="top">type(<a class="el" href="structxtb__optimizer_1_1convergence__log.html">convergence_log</a>) function&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacextb__optimizer.html#a7c5a5499961d823aba5503ed3aed9716">load_turbomole_log</a> (nmax)</td></tr>
<tr class="separator:a7c5a5499961d823aba5503ed3aed9716"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a18c51670400f13cceb6241536779318b"><td class="memItemLeft" align="right" valign="top">logical function&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacextb__optimizer.html#a18c51670400f13cceb6241536779318b">tokenize_cycle</a> (line, e, g)</td></tr>
<tr class="separator:a18c51670400f13cceb6241536779318b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac917d2cb3a3dc7ed9dcda048740f7605"><td class="memItemLeft" align="right" valign="top">pure real(wp) function&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacextb__optimizer.html#ac917d2cb3a3dc7ed9dcda048740f7605">get_averaged_energy</a> (self)</td></tr>
<tr class="separator:ac917d2cb3a3dc7ed9dcda048740f7605"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a80671364fb57d114f191e1477b4bcfaf"><td class="memItemLeft" align="right" valign="top">pure real(wp) function&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacextb__optimizer.html#a80671364fb57d114f191e1477b4bcfaf">get_averaged_gradient</a> (self)</td></tr>
<tr class="separator:a80671364fb57d114f191e1477b4bcfaf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5867ec28107670e95b06ff7b4baaf300"><td class="memItemLeft" align="right" valign="top">pure subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacextb__optimizer.html#a5867ec28107670e95b06ff7b4baaf300">set_eg_log</a> (self, e, g)</td></tr>
<tr class="separator:a5867ec28107670e95b06ff7b4baaf300"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:af6d551356c63a70e8a29e322174fe053"><td class="memItemLeft" align="right" valign="top">logical, parameter, private&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacextb__optimizer.html#af6d551356c63a70e8a29e322174fe053">profile</a> = .true.</td></tr>
<tr class="separator:af6d551356c63a70e8a29e322174fe053"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="a1743159550358c92fb2761af80e15285"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1743159550358c92fb2761af80e15285">&#9670;&nbsp;</a></span>ancopt()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine xtb_optimizer::ancopt </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structxtb__type__environment_1_1tenvironment.html">tenvironment</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>ilog</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structxtb__type__molecule_1_1tmolecule.html">tmolecule</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>mol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structxtb__type__restart_1_1trestart.html">trestart</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>chk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">class(<a class="el" href="structxtb__type__calculator_1_1tcalculator.html">tcalculator</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>calc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp), intent(inout)&#160;</td>
          <td class="paramname"><em>egap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp), intent(in)&#160;</td>
          <td class="paramname"><em>et</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>maxiter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>maxcycle_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp), intent(inout)&#160;</td>
          <td class="paramname"><em>etot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp), dimension(3,mol%n), intent(inout)&#160;</td>
          <td class="paramname"><em>g</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp), dimension(3,3), intent(inout)&#160;</td>
          <td class="paramname"><em>sigma</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>tight</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>pr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(out)&#160;</td>
          <td class="paramname"><em>fail</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">env</td><td>Calculation environment </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="optimizer_8f90_source.html#l00108">108</a> of file <a class="el" href="optimizer_8f90_source.html">optimizer.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__mctc__convert.html">xtb_mctc_convert</a></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__mctc__la.html">xtb_mctc_la</a></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160; </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__type__molecule.html">xtb_type_molecule</a></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__type__anc.html">xtb_type_anc</a></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__type__restart.html">xtb_type_restart</a></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__type__calculator.html">xtb_type_calculator</a></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__type__dummycalc.html">xtb_type_dummycalc</a></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__type__data.html">xtb_type_data</a></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__type__timer.html">xtb_type_timer</a></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160; </div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__setparam.html">xtb_setparam</a></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__fixparam.html">xtb_fixparam</a></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160; </div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__setmod.html">xtb_setmod</a>, <span class="keywordtype">only</span> : <a class="code" href="namespacextb__setmod.html#abb520d5a1aa4dab437dac11b5c3070c9">int2optlevel</a></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160; </div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__single.html">xtb_single</a>, <span class="keywordtype">only</span> : <a class="code" href="interfacextb__type__calculator_1_1singlepoint.html">singlepoint</a></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__axis.html">xtb_axis</a>, <span class="keywordtype">only</span> : <a class="code" href="namespacextb__axis.html#acee39fbdfe7b649e0ef5425e39d4faf2">axis2</a></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__hessian.html">xtb_hessian</a>, <span class="keywordtype">only</span> : trproj,rdhess</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__readin.html">xtb_readin</a></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__lsrmsd.html">xtb_lsrmsd</a></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160; </div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;   <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160; </div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;   <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">parameter</span> :: source = <span class="stringliteral">&quot;optimizer_ancopt&quot;</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160; </div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;   <span class="keywordtype">type</span>(TEnvironment), <span class="keywordtype">intent(inout)</span> :: env</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160; </div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;   <span class="keywordtype">type</span>(TMolecule), <span class="keywordtype">intent(inout)</span> :: mol</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>    :: tight</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>    :: maxiter</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>    :: maxcycle_in</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;   <span class="keywordtype">type</span>(TRestart),<span class="keywordtype">intent(inout)</span> :: chk</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;   <span class="keywordtype">class</span>(TCalculator), <span class="keywordtype">intent(inout)</span> :: calc</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="keywordtype">   real</span>(wp) :: eel</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(inout)</span> :: etot</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(in)</span>    :: et</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(inout)</span> :: egap</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(inout)</span> :: g(3,mol%n)</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(inout)</span> :: sigma(3,3)</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;   <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span>    :: pr</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;   <span class="keywordtype">logical</span>, <span class="keywordtype">intent(out)</span>   :: fail</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160; </div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;   <span class="keywordtype">type</span>(TMolecule) :: molopt</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;   <span class="keywordtype">type</span>(scc_results) :: res</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;   <span class="keywordtype">type</span>(tb_anc) :: anc</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;   <span class="keywordtype">type</span>(tb_timer) :: timer</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="keywordtype">   real</span>(wp) :: step,amu2au,au2cm,dumi,dumj,damp,hlow,edum,s6,thr,aaa,bbb</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="keywordtype">   real</span>(wp) :: maxdispl,gthr,ethr,hmax,energy,acc,rij(3),t1,t0,w1,w0,ccc</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;   <span class="keywordtype">integer</span>  :: n3,i,j,k,l,jjj,ic,jc,ia,ja,ii,jj,info,lwork,nat3,liwork</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;   <span class="keywordtype">integer</span>  :: nvar,iter,nread,maxcycle,maxmicro,itry,maxopt,iupdat,iii</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;   <span class="keywordtype">integer</span>  :: id,ihess,error</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: ilog</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">external</span>    :: lin</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">allocatable</span> :: h (:,:)</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">allocatable</span> :: b (:,:)</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">allocatable</span> :: fc(:)</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">allocatable</span> :: eig(:)</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">allocatable</span> :: aux(:)</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">allocatable</span> :: hess(:)</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">allocatable</span> :: iwork(:)</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">allocatable</span> :: totsym(:)</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">allocatable</span> :: pmode(:,:)</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">allocatable</span> :: grmsd(:,:)</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;   <span class="keywordtype">type</span>(convergence_log), <span class="keywordtype">allocatable</span> :: avconv</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="keywordtype">   real</span>(wp) :: U(3,3), x_center(3), y_center(3), rmsdval</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;   <span class="keywordtype">integer</span> :: modef</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;   <span class="keywordtype">logical</span> :: restart,ex,converged,linear</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="keywordtype">   real</span>(wp) :: estart,esave</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;   <span class="keywordtype">character(len=*)</span>,<span class="keywordtype">parameter</span> :: scifmt = &amp;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      <span class="stringliteral">&#39;(10x,&quot;:&quot;,3x,a,e22.7,1x,a,1x,&quot;:&quot;)&#39;</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;   <span class="keywordtype">character(len=*)</span>,<span class="keywordtype">parameter</span> :: dblfmt = &amp;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      <span class="stringliteral">&#39;(10x,&quot;:&quot;,3x,a,f18.7,5x,a,1x,&quot;:&quot;)&#39;</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;   <span class="keywordtype">character(len=*)</span>,<span class="keywordtype">parameter</span> :: intfmt = &amp;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      <span class="stringliteral">&#39;(10x,&quot;:&quot;,3x,a,i18,      10x,&quot;:&quot;)&#39;</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;   <span class="keywordtype">character(len=*)</span>,<span class="keywordtype">parameter</span> :: chrfmt = &amp;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      <span class="stringliteral">&#39;(10x,&quot;:&quot;,3x,a,a18,      10x,&quot;:&quot;)&#39;</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160; </div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;   <span class="keywordflow">if</span>(mol%n.eq.1) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;   <span class="keywordflow">if</span> (profile) <span class="keyword">call </span><a class="code" href="namespacextb__type__timer.html#a1dcf014087e66f68529af68ba3ab41b0">timer</a>%new(8,.false.)</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;   <span class="keywordflow">if</span> (profile) <span class="keyword">call </span><a class="code" href="namespacextb__type__timer.html#a1dcf014087e66f68529af68ba3ab41b0">timer</a>%measure(1,<span class="stringliteral">&#39;optimizer setup&#39;</span>)</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160; </div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">!  defaults</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;   fail =.false.</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;   modef=0</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;   hmax =  5.0_wp</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;   maxdispl=<a class="code" href="namespacextb__setparam.html#a4722ee08c0653964a42e6d1b73425431">optset</a>%maxdispl_opt</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;   hlow = <a class="code" href="namespacextb__setparam.html#a4722ee08c0653964a42e6d1b73425431">optset</a>%hlow_opt<span class="comment">!0.01 in ancopt, 0.002 too small</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;   s6   = <a class="code" href="namespacextb__setparam.html#a474ce1401632b916b72f30403fbea1bc">mhset</a>%s6  <span class="comment">!slightly better than 30 for various proteins</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">! initial number of steps before new ANC are made by model Hessian</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">! increased during opt.</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;   maxmicro=<a class="code" href="namespacextb__setparam.html#a4722ee08c0653964a42e6d1b73425431">optset</a>%micro_opt</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;   estart = etot</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160; </div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;   iupdat=0 <span class="comment">!0=BFGS, 1=Powell</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160; </div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;   <span class="keywordflow">if</span>(<a class="code" href="namespacextb__setparam.html#a258cf30bdaa01dbe3cfe70faaa962071">tsopt</a>)<span class="keywordflow">then</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      hlow=max(hlow,0.250d0)</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      iupdat=1</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160; </div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;   <span class="keyword">call </span>get_optthr(mol%n,tight,ethr,gthr,maxcycle,acc)</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160; </div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;   <span class="keywordflow">if</span>(maxcycle_in.le.0)<span class="keywordflow">then</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      maxopt=maxcycle</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;      maxopt=maxcycle_in</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;   <span class="keywordflow">if</span>(maxopt.lt.maxmicro) maxmicro=maxopt</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="namespacextb__setparam.html#a4722ee08c0653964a42e6d1b73425431">optset</a>%average_conv) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      <span class="keywordflow">select type</span>(calc)</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="keywordflow">      class is</span>(<a class="code" href="structxtb__type__dummycalc_1_1tdummycalculator.html">tdummycalculator</a>)</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;         avconv = load_turbomole_log(maxopt)</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;         <span class="keywordflow">if</span> (avconv%nlog &gt; 0 .and. pr) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            <span class="keyword">write</span>(env%unit, <span class="stringliteral">&#39;(a, 1x, i0, 1x, a)&#39;</span>) &amp;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;               <span class="stringliteral">&quot;Convergence averaging initialized with&quot;</span>, avconv%nlog, <span class="stringliteral">&quot;entries&quot;</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="keywordflow">         end if</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="keywordflow">      class default</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;         avconv = convergence_log(maxopt)</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="keywordflow">      end select</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="keywordflow">   end if</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160; </div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;   <span class="keyword">call </span><a class="code" href="namespacextb__axis.html#acee39fbdfe7b649e0ef5425e39d4faf2">axis2</a>(mol%n,mol%at,mol%xyz,aaa,bbb,ccc,dumi,dumj)</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160; </div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;   <span class="comment">!call open_file(ilog,&#39;xtbopt.log&#39;,&#39;w&#39;)</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;   iter = 0</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;   nat3 = 3 * mol%n</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;   nvar = nat3 - 6</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;   linear = .false.</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;   <span class="keywordflow">if</span>(ccc.lt.1.d-10) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      linear = .<a class="code" href="symmetry__i_8c.html#aa77c823a9fc018ae1d437369708d8727">true</a>.</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      nvar = nat3 - 5</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;   <span class="keywordflow">if</span>(<a class="code" href="namespacextb__fixparam.html#a5b7d157c117b85a2f9d402d6c61f8b37">fixset</a>%n.gt.0) <span class="keywordflow">then</span> <span class="comment">! exact fixing</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      nvar=nat3-3*<a class="code" href="namespacextb__fixparam.html#a5b7d157c117b85a2f9d402d6c61f8b37">fixset</a>%n-3</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      <span class="keywordflow">if</span>(nvar.le.0) nvar=1</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160; </div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;   <span class="keyword">call </span><a class="code" href="filetools_8F90.html#a3b178f7f1f1e22ef97fda0ce2bb8e608">open_binary</a>(id,<span class="stringliteral">&#39;.xtbtmpmode&#39;</span>,<span class="stringliteral">&#39;r&#39;</span>)</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;   <span class="keywordflow">if</span>(id.ne.-1)<span class="keywordflow">then</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      <span class="keyword">read</span> (id) modef</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      <span class="keyword">allocate</span>(pmode(nat3,modef))</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      <span class="keyword">read</span> (id) pmode</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      <span class="keyword">call </span><a class="code" href="filetools_8F90.html#abe40c19bea97456da4d616af69059aeb">close_file</a>(id)</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      nvar=nvar-modef</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      <span class="keyword">allocate</span>(pmode(nat3,1)) <span class="comment">! dummy allocated</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160; </div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;   <span class="keywordflow">if</span>(pr)<span class="keywordflow">then</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      <span class="keyword">write</span>(env%unit,<span class="stringliteral">&#39;(/,10x,51(&quot;.&quot;))&#39;</span>)</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      <span class="keyword">write</span>(env%unit,<span class="stringliteral">&#39;(10x,&quot;:&quot;,22x,a,22x,&quot;:&quot;)&#39;</span>) <span class="stringliteral">&quot;SETUP&quot;</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      <span class="keyword">write</span>(env%unit,<span class="stringliteral">&#39;(10x,&quot;:&quot;,49(&quot;.&quot;),&quot;:&quot;)&#39;</span>)</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      <span class="keyword">write</span>(env%unit,chrfmt) <span class="stringliteral">&quot;optimization level&quot;</span>,<a class="code" href="namespacextb__setmod.html#abb520d5a1aa4dab437dac11b5c3070c9">int2optlevel</a>(tight)</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;      <span class="keyword">write</span>(env%unit,intfmt) <span class="stringliteral">&quot;max. optcycles    &quot;</span>,maxopt</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      <span class="keyword">write</span>(env%unit,intfmt) <span class="stringliteral">&quot;ANC micro-cycles  &quot;</span>,maxmicro</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      <span class="keyword">write</span>(env%unit,intfmt) <span class="stringliteral">&quot;degrees of freedom&quot;</span>,nvar</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;      <span class="keywordflow">if</span> (modef&gt;0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;      <span class="keyword">write</span>(env%unit,intfmt) <span class="stringliteral">&quot;# mode follow     &quot;</span>,modef</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      <span class="keyword">write</span>(env%unit,<span class="stringliteral">&#39;(10x,&quot;:&quot;,49(&quot;.&quot;),&quot;:&quot;)&#39;</span>)</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacextb__setparam.html#a4722ee08c0653964a42e6d1b73425431">optset</a>%exact_rf) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      <span class="keyword">write</span>(env%unit,chrfmt) <span class="stringliteral">&quot;RF solver         &quot;</span>,<span class="stringliteral">&quot;spevx&quot;</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      <span class="keyword">write</span>(env%unit,chrfmt) <span class="stringliteral">&quot;RF solver         &quot;</span>,<span class="stringliteral">&quot;davidson&quot;</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;      <span class="keyword">write</span>(env%unit,chrfmt) <span class="stringliteral">&quot;write xtbopt.log  &quot;</span>,<a class="code" href="namespacextb__readin.html#a3f2a0a4ba8d18c910b3a058712e42867">bool2string</a>(ilog.ne.-1)</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;      <span class="keywordflow">if</span> (linear) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      <span class="keyword">write</span>(env%unit,chrfmt) <span class="stringliteral">&quot;linear (good luck)&quot;</span>,<a class="code" href="namespacextb__readin.html#a3f2a0a4ba8d18c910b3a058712e42867">bool2string</a>(linear)</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      <span class="keyword">write</span>(env%unit,chrfmt) <span class="stringliteral">&quot;linear?           &quot;</span>,<a class="code" href="namespacextb__readin.html#a3f2a0a4ba8d18c910b3a058712e42867">bool2string</a>(linear)</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      <span class="keyword">write</span>(env%unit,scifmt) <span class="stringliteral">&quot;energy convergence&quot;</span>,ethr,    <span class="stringliteral">&quot;Eh  &quot;</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      <span class="keyword">write</span>(env%unit,scifmt) <span class="stringliteral">&quot;grad. convergence &quot;</span>,gthr,    Î±<span class="stringliteral">&quot;Eh/&quot;</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;      <span class="keyword">write</span>(env%unit,dblfmt) <span class="stringliteral">&quot;maximium RF displ.&quot;</span>,maxdispl,<span class="stringliteral">&quot;    &quot;</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      <span class="keyword">write</span>(env%unit,scifmt) <span class="stringliteral">&quot;Hlow (freq-cutoff)&quot;</span>,hlow,    <span class="stringliteral">&quot;    &quot;</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      <span class="keyword">write</span>(env%unit,dblfmt) <span class="stringliteral">&quot;Hmax (freq-cutoff)&quot;</span>,hmax,    <span class="stringliteral">&quot;    &quot;</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      <span class="keyword">write</span>(env%unit,dblfmt) <span class="stringliteral">&quot;S6 in model hess. &quot;</span>,s6,      <span class="stringliteral">&quot;    &quot;</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;      <span class="keyword">write</span>(env%unit,<span class="stringliteral">&#39;(10x,51(&quot;.&quot;))&#39;</span>)</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160; </div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;   lwork  = 1 + 6*nat3 + 2*nat3**2</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;   liwork = 8 * nat3</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160; </div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;   <span class="keyword">allocate</span>(h(nat3,nat3),fc(nat3*(nat3+1)/2),eig(nat3))</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160; </div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="namespacextb__setparam.html#a474ce1401632b916b72f30403fbea1bc">mhset</a>%model == <a class="code" href="namespacextb__setparam.html#ac07fd07721c7559a18ca5011bc2e1a9c">p_modh_read</a>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      <span class="keyword">call </span><a class="code" href="filetools_8F90.html#a68160ec369d61855ea12b180c7ce8c21">open_file</a>(ihess, <span class="stringliteral">&#39;hessian&#39;</span>, <span class="stringliteral">&#39;r&#39;</span>)</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      <span class="keywordflow">if</span> (ihess == -1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;         <span class="keyword">call </span>env%error(<span class="stringliteral">&quot;Could not read in hessian as requested.&quot;</span>, source)</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      <span class="keyword">call </span>read_hessian(ihess, nat3, h, error)</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      <span class="keywordflow">if</span> (error /= 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;         <span class="keyword">call </span>env%error(<span class="stringliteral">&quot;Could not read hessian from file.&quot;</span>, source)</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      <span class="comment">! do not reset the hessian</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      maxmicro = maxopt</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      ex = .<a class="code" href="symmetry__i_8c.html#aa77c823a9fc018ae1d437369708d8727">true</a>.</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      ex = .false.</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160; </div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;   <span class="keyword">call </span>anc%allocate(mol%n,nvar,hlow,hmax)</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160; </div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;   molopt = mol</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160; </div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;   <span class="keywordflow">if</span> (profile) <span class="keyword">call </span><a class="code" href="namespacextb__type__timer.html#a1dcf014087e66f68529af68ba3ab41b0">timer</a>%measure(1)</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160; </div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment">! ======================================================================</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;   anc_microiter: <span class="keywordflow">do</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment">! ======================================================================</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160; </div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;   <span class="keywordflow">if</span> (profile) <span class="keyword">call </span><a class="code" href="namespacextb__type__timer.html#a1dcf014087e66f68529af68ba3ab41b0">timer</a>%measure(2,<span class="stringliteral">&#39;model hessian&#39;</span>)</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;   <span class="keywordflow">if</span> (.not.ex)<span class="keywordflow">then</span> <span class="comment">! normal case</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;     <span class="keywordflow">if</span>(pr)<span class="keyword">write</span>(env%unit,<span class="stringliteral">&#39;(/,&#39;</span><span class="stringliteral">&#39;generating ANC from model Hessian ...&#39;</span><span class="stringliteral">&#39;)&#39;</span>)</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;     <span class="keyword">call </span>modhes(env, calc, <a class="code" href="namespacextb__setparam.html#a474ce1401632b916b72f30403fbea1bc">mhset</a>, molopt%n, molopt%xyz, molopt%at, fc, pr)   <span class="comment">! WBO (array wb) not used in present version</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;     <span class="keyword">call </span>env%check(fail)</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;     <span class="keywordflow">if</span> (fail) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        <span class="keyword">call </span>env%error(<span class="stringliteral">&quot;Calculation of model hessian failed&quot;</span>, source)</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        <span class="keywordflow">return</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="keywordflow">     end if</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;     <span class="comment">!call qpothess(molopt%n,fc,molopt%xyz)</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;     thr=1.d-11</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;     <span class="keywordflow">if</span>(pr)<span class="keyword">write</span>(env%unit,<span class="stringliteral">&#39;(/,&#39;</span><span class="stringliteral">&#39;generating ANC from read Hessian ...&#39;</span><span class="stringliteral">&#39;)&#39;</span>)</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;     k=0</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;     <span class="keywordflow">do</span> i=1,nat3</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        <span class="keywordflow">do</span> j=1,i</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;         k=k+1</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;         fc(k)=h(j,i)</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="keywordflow">     enddo</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;     thr=1.d-10</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160; </div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;   <span class="keywordflow">if</span>(modef.eq.0)<span class="keywordflow">then</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="namespacextb__fixparam.html#a5b7d157c117b85a2f9d402d6c61f8b37">fixset</a>%n.gt.0)<span class="keywordflow">then</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;         <span class="keyword">call </span>trproj(molopt%n,nat3,molopt%xyz,fc,.false., -1  ,pmode,1)     <span class="comment">! exact fixing</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;         <span class="keywordflow">if</span> (.not.linear) &amp;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;         <span class="keyword">call </span>trproj(molopt%n,nat3,molopt%xyz,fc,.false.,modef,pmode,1)     <span class="comment">! normal</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      <span class="keyword">call </span>trproj(molopt%n,nat3,molopt%xyz,fc,.false.,modef,pmode,modef) <span class="comment">! NMF</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;   <span class="keywordflow">if</span> (profile) <span class="keyword">call </span><a class="code" href="namespacextb__type__timer.html#a1dcf014087e66f68529af68ba3ab41b0">timer</a>%measure(2)</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160; </div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;   <span class="keywordflow">if</span> (profile) <span class="keyword">call </span><a class="code" href="namespacextb__type__timer.html#a1dcf014087e66f68529af68ba3ab41b0">timer</a>%measure(3,<span class="stringliteral">&#39;ANC generation&#39;</span>)</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;   <span class="comment">! this is completely useless, we blow up the Hessian, just to pack it again...</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;   k=0</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;   <span class="keywordflow">do</span> i=1,nat3</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      <span class="keywordflow">do</span> j=1,i</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;         k=k+1</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;         h(i,j)=fc(k)</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;         h(j,i)=fc(k)</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160; </div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">!  initialize hessian for opt.</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;   <span class="keyword">call </span>anc%new(env%unit,molopt%xyz,h,pr,linear)</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160; </div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;   <span class="keywordflow">if</span> (profile) <span class="keyword">call </span><a class="code" href="namespacextb__type__timer.html#a1dcf014087e66f68529af68ba3ab41b0">timer</a>%measure(3)</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160; </div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;   esave = etot</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160; </div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">! now everything is prepared for the optimization</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;   <span class="keyword">call </span>relax(env,iter,molopt,anc,restart,maxmicro,maxdispl,ethr,gthr, &amp;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;      &amp; iii,<a class="code" href="neighbor_8f90.html#a5df91039130b0032e4f6ce1853b1af8a">chk</a>,calc,egap,acc,et,maxiter,iupdat,etot,g,sigma,ilog,pr,fail, &amp;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;      &amp; converged,<a class="code" href="namespacextb__type__timer.html#a1dcf014087e66f68529af68ba3ab41b0">timer</a>,<a class="code" href="namespacextb__setparam.html#a4722ee08c0653964a42e6d1b73425431">optset</a>%exact_rf,avconv)</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160; </div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;   <span class="keyword">call </span>env%check(fail)</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;   <span class="keywordflow">if</span> (fail) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      <span class="keyword">call </span>env%error(<span class="stringliteral">&quot;Could not relax structure&quot;</span>, source)</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      <span class="keywordflow">return</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160; </div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;   maxmicro=min(int(maxmicro*1.1),2*<a class="code" href="namespacextb__setparam.html#a4722ee08c0653964a42e6d1b73425431">optset</a>%micro_opt)</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160; </div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;   <span class="keyword">call </span><a class="code" href="namespacextb__lsrmsd.html#a7de6c8c9dfc5be748e05c80b2cb8b092">rmsd</a>(molopt%n,anc%xyz,molopt%xyz,1,u,x_center,y_center,rmsdval,.false.,grmsd)</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160; </div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;   <span class="comment">! this comes close to a goto, but it&#39;s not a goto ... it&#39;s even worse</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;   <span class="keywordflow">if</span> (restart.and.iter.lt.maxopt) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;      <span class="keywordflow">if</span> (pr) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;         <span class="keyword">write</span>(env%unit,Î±<span class="stringliteral">&#39;(&quot; * RMSD in coord.:&quot;,f14.7,1x,&quot;&quot;)&#39;</span>,advance=<span class="stringliteral">&#39;no&#39;</span>) rmsdval</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;         <span class="keyword">write</span>(env%unit,<span class="stringliteral">&#39;(6x,&quot;energy gain&quot;,e16.7,1x,&quot;Eh&quot;)&#39;</span>) etot-esave</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;      cycle anc_microiter</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;   <span class="keywordflow">exit</span>  anc_microiter</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="comment">! ======================================================================</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="keywordflow">   enddo</span> anc_microiter</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment">! ======================================================================</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160; </div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;   <span class="keywordflow">if</span> (converged) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;      <span class="keywordflow">if</span>(pr) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;         <span class="keyword">call </span><a class="code" href="namespacextb__lsrmsd.html#a7de6c8c9dfc5be748e05c80b2cb8b092">rmsd</a>(mol%n,mol%xyz,molopt%xyz,1,u,x_center,y_center,rmsdval,.false.,grmsd)</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;         <span class="keyword">write</span>(env%unit,<span class="stringliteral">&#39;(/,3x,&quot;***&quot;,1x,a,1x,i0,1x,a,1x,&quot;***&quot;,/)&#39;</span>) &amp;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;            <span class="stringliteral">&quot;GEOMETRY OPTIMIZATION CONVERGED AFTER&quot;</span>,iter,<span class="stringliteral">&quot;ITERATIONS&quot;</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;         <span class="keyword">write</span>(env%unit,<span class="stringliteral">&#39;(72(&quot;-&quot;))&#39;</span>)</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;         <span class="keyword">write</span>(env%unit,<span class="stringliteral">&#39;(1x,&quot;total energy gain   :&quot;,F18.7,1x,&quot;Eh&quot;,F14.4,1x,&quot;kcal/mol&quot;)&#39;</span>) &amp;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;            etot-estart, (etot-estart)*<a class="code" href="namespacextb__mctc__convert.html#a78b2b5f984829caf56f363adf0cd6319">autokcal</a></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;         <span class="keyword">write</span>(env%unit,Ã<span class="stringliteral">&#39;(1x,&quot;total RMSD          :&quot;,F18.7,1x,&quot;a0&quot;,F14.4,1x,&quot;&quot;)&#39;</span>) &amp;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;            rmsdval, rmsdval*<a class="code" href="namespacextb__mctc__convert.html#ada4c2e75cba454ef480ef0cb3da373c7">autoaa</a></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;         <span class="keywordflow">if</span> (profile) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;            <span class="keyword">write</span>(env%unit,<span class="stringliteral">&#39;(1x,&quot;total power (kW/mol):&quot;,F18.7,1x,&quot;(step)&quot;,F10.4,1x,&quot;(real)&quot;)&#39;</span>) &amp;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;               &amp; (etot-estart)*<a class="code" href="namespacextb__mctc__convert.html#aaa00b5a4d1b35d5634b49708f43dd0a1">autokj</a>/iter, (etot-estart)*<a class="code" href="namespacextb__mctc__convert.html#aaa00b5a4d1b35d5634b49708f43dd0a1">autokj</a>/<a class="code" href="namespacextb__type__timer.html#a1dcf014087e66f68529af68ba3ab41b0">timer</a>%get()</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;         <span class="keyword">write</span>(env%unit,<span class="stringliteral">&#39;(72(&quot;-&quot;))&#39;</span>)</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment">!  not converging in the given cycles is a FAILURE, we should make this clearer</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment">!  This is still no ERROR, since we want the geometry written afterwards</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;      <span class="keywordflow">if</span>(pr) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;         <span class="keyword">write</span>(env%unit,<span class="stringliteral">&#39;(/,3x,&quot;***&quot;,1x,a,1x,i0,1x,a,1x,&quot;***&quot;,/)&#39;</span>) &amp;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;            <span class="stringliteral">&quot;FAILED TO CONVERGE GEOMETRY OPTIMIZATION IN&quot;</span>,iter,<span class="stringliteral">&quot;ITERATIONS&quot;</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160; </div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;   mol = molopt</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160; </div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;   <span class="comment">!call close_file(ilog)</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160; </div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;   <span class="keywordflow">if</span> (pr.and.profile) <span class="keyword">call </span><a class="code" href="namespacextb__type__timer.html#a1dcf014087e66f68529af68ba3ab41b0">timer</a>%write(env%unit,<span class="stringliteral">&#39;ANCopt&#39;</span>)</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160; </div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;   <span class="keywordflow">if</span> (profile) <span class="keyword">call </span><a class="code" href="namespacextb__type__timer.html#a1dcf014087e66f68529af68ba3ab41b0">timer</a>%deallocate</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;   <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(pmode))  <span class="keyword">deallocate</span>(pmode)</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;   <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(h))      <span class="keyword">deallocate</span>(h)</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;   <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(fc))     <span class="keyword">deallocate</span>(fc)</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;   <span class="keyword">call </span>anc%deallocate</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160; </div>
<div class="ttc" id="afiletools_8F90_html_a3b178f7f1f1e22ef97fda0ce2bb8e608"><div class="ttname"><a href="filetools_8F90.html#a3b178f7f1f1e22ef97fda0ce2bb8e608">open_binary</a></div><div class="ttdeci">subroutine open_binary(iunit, name, status)</div><div class="ttdef"><b>Definition:</b> <a href="filetools_8F90_source.html#l00047">filetools.F90:48</a></div></div>
<div class="ttc" id="afiletools_8F90_html_a68160ec369d61855ea12b180c7ce8c21"><div class="ttname"><a href="filetools_8F90.html#a68160ec369d61855ea12b180c7ce8c21">open_file</a></div><div class="ttdeci">subroutine open_file(iunit, name, status)</div><div class="ttdef"><b>Definition:</b> <a href="filetools_8F90_source.html#l00065">filetools.F90:66</a></div></div>
<div class="ttc" id="afiletools_8F90_html_abe40c19bea97456da4d616af69059aeb"><div class="ttname"><a href="filetools_8F90.html#abe40c19bea97456da4d616af69059aeb">close_file</a></div><div class="ttdeci">subroutine close_file(unit)</div><div class="ttdef"><b>Definition:</b> <a href="filetools_8F90_source.html#l00083">filetools.F90:84</a></div></div>
<div class="ttc" id="ainterfacextb__type__calculator_1_1singlepoint_html"><div class="ttname"><a href="interfacextb__type__calculator_1_1singlepoint.html">xtb_type_calculator::singlepoint</a></div><div class="ttdef"><b>Definition:</b> <a href="type_2calculator_8f90_source.html#l00051">calculator.f90:51</a></div></div>
<div class="ttc" id="anamespacextb__axis_html"><div class="ttname"><a href="namespacextb__axis.html">xtb_axis</a></div><div class="ttdef"><b>Definition:</b> <a href="axis__trafo_8f90_source.html#l00018">axis_trafo.f90:18</a></div></div>
<div class="ttc" id="anamespacextb__axis_html_acee39fbdfe7b649e0ef5425e39d4faf2"><div class="ttname"><a href="namespacextb__axis.html#acee39fbdfe7b649e0ef5425e39d4faf2">xtb_axis::axis2</a></div><div class="ttdeci">subroutine axis2(numat, nat, xyz, aa, bb, cc, avmom, sumw)</div><div class="ttdef"><b>Definition:</b> <a href="axis__trafo_8f90_source.html#l00115">axis_trafo.f90:116</a></div></div>
<div class="ttc" id="anamespacextb__fixparam_html"><div class="ttname"><a href="namespacextb__fixparam.html">xtb_fixparam</a></div><div class="ttdef"><b>Definition:</b> <a href="fixparam_8f90_source.html#l00018">fixparam.f90:18</a></div></div>
<div class="ttc" id="anamespacextb__fixparam_html_a5b7d157c117b85a2f9d402d6c61f8b37"><div class="ttname"><a href="namespacextb__fixparam.html#a5b7d157c117b85a2f9d402d6c61f8b37">xtb_fixparam::fixset</a></div><div class="ttdeci">type(fix_setvar) fixset</div><div class="ttdef"><b>Definition:</b> <a href="fixparam_8f90_source.html#l00028">fixparam.f90:28</a></div></div>
<div class="ttc" id="anamespacextb__hessian_html"><div class="ttname"><a href="namespacextb__hessian.html">xtb_hessian</a></div><div class="ttdef"><b>Definition:</b> <a href="hessian_8F90_source.html#l00018">hessian.F90:18</a></div></div>
<div class="ttc" id="anamespacextb__lsrmsd_html"><div class="ttname"><a href="namespacextb__lsrmsd.html">xtb_lsrmsd</a></div><div class="ttdef"><b>Definition:</b> <a href="ls__rmsd_8f90_source.html#l00024">ls_rmsd.f90:24</a></div></div>
<div class="ttc" id="anamespacextb__lsrmsd_html_a7de6c8c9dfc5be748e05c80b2cb8b092"><div class="ttname"><a href="namespacextb__lsrmsd.html#a7de6c8c9dfc5be748e05c80b2cb8b092">xtb_lsrmsd::rmsd</a></div><div class="ttdeci">subroutine rmsd(n, coord1, coord2, option, U, x_center, y_center, error, calc_g, g)</div><div class="ttdef"><b>Definition:</b> <a href="ls__rmsd_8f90_source.html#l00033">ls_rmsd.f90:35</a></div></div>
<div class="ttc" id="anamespacextb__mctc__convert_html"><div class="ttname"><a href="namespacextb__mctc__convert.html">xtb_mctc_convert</a></div><div class="ttdef"><b>Definition:</b> <a href="convert_8f90_source.html#l00018">convert.f90:18</a></div></div>
<div class="ttc" id="anamespacextb__mctc__convert_html_a78b2b5f984829caf56f363adf0cd6319"><div class="ttname"><a href="namespacextb__mctc__convert.html#a78b2b5f984829caf56f363adf0cd6319">xtb_mctc_convert::autokcal</a></div><div class="ttdeci">real(wp), parameter, public autokcal</div><div class="ttdef"><b>Definition:</b> <a href="convert_8f90_source.html#l00030">convert.f90:30</a></div></div>
<div class="ttc" id="anamespacextb__mctc__convert_html_aaa00b5a4d1b35d5634b49708f43dd0a1"><div class="ttname"><a href="namespacextb__mctc__convert.html#aaa00b5a4d1b35d5634b49708f43dd0a1">xtb_mctc_convert::autokj</a></div><div class="ttdeci">real(wp), parameter, public autokj</div><div class="ttdef"><b>Definition:</b> <a href="convert_8f90_source.html#l00033">convert.f90:33</a></div></div>
<div class="ttc" id="anamespacextb__mctc__convert_html_ada4c2e75cba454ef480ef0cb3da373c7"><div class="ttname"><a href="namespacextb__mctc__convert.html#ada4c2e75cba454ef480ef0cb3da373c7">xtb_mctc_convert::autoaa</a></div><div class="ttdeci">real(wp), parameter, public autoaa</div><div class="ttdef"><b>Definition:</b> <a href="convert_8f90_source.html#l00024">convert.f90:24</a></div></div>
<div class="ttc" id="anamespacextb__mctc__la_html"><div class="ttname"><a href="namespacextb__mctc__la.html">xtb_mctc_la</a></div><div class="ttdef"><b>Definition:</b> <a href="linalg_8f90_source.html#l00018">linalg.f90:18</a></div></div>
<div class="ttc" id="anamespacextb__readin_html"><div class="ttname"><a href="namespacextb__readin.html">xtb_readin</a></div><div class="ttdef"><b>Definition:</b> <a href="readin_8f90_source.html#l00018">readin.f90:18</a></div></div>
<div class="ttc" id="anamespacextb__readin_html_a3f2a0a4ba8d18c910b3a058712e42867"><div class="ttname"><a href="namespacextb__readin.html#a3f2a0a4ba8d18c910b3a058712e42867">xtb_readin::bool2string</a></div><div class="ttdeci">pure character(len=:) function, allocatable bool2string(bool)</div><div class="ttdef"><b>Definition:</b> <a href="readin_8f90_source.html#l00263">readin.f90:264</a></div></div>
<div class="ttc" id="anamespacextb__setmod_html"><div class="ttname"><a href="namespacextb__setmod.html">xtb_setmod</a></div><div class="ttdef"><b>Definition:</b> <a href="set__module_8f90_source.html#l00074">set_module.f90:74</a></div></div>
<div class="ttc" id="anamespacextb__setmod_html_abb520d5a1aa4dab437dac11b5c3070c9"><div class="ttname"><a href="namespacextb__setmod.html#abb520d5a1aa4dab437dac11b5c3070c9">xtb_setmod::int2optlevel</a></div><div class="ttdeci">character(len=:) function, allocatable int2optlevel(ilvl)</div><div class="ttdef"><b>Definition:</b> <a href="set__module_8f90_source.html#l01563">set_module.f90:1564</a></div></div>
<div class="ttc" id="anamespacextb__setparam_html"><div class="ttname"><a href="namespacextb__setparam.html">xtb_setparam</a></div><div class="ttdef"><b>Definition:</b> <a href="setparam_8f90_source.html#l00022">setparam.f90:22</a></div></div>
<div class="ttc" id="anamespacextb__setparam_html_a258cf30bdaa01dbe3cfe70faaa962071"><div class="ttname"><a href="namespacextb__setparam.html#a258cf30bdaa01dbe3cfe70faaa962071">xtb_setparam::tsopt</a></div><div class="ttdeci">logical tsopt</div><div class="ttdef"><b>Definition:</b> <a href="setparam_8f90_source.html#l00407">setparam.f90:407</a></div></div>
<div class="ttc" id="anamespacextb__setparam_html_a4722ee08c0653964a42e6d1b73425431"><div class="ttname"><a href="namespacextb__setparam.html#a4722ee08c0653964a42e6d1b73425431">xtb_setparam::optset</a></div><div class="ttdeci">type(ancopt_setvar) optset</div><div class="ttdef"><b>Definition:</b> <a href="setparam_8f90_source.html#l00106">setparam.f90:106</a></div></div>
<div class="ttc" id="anamespacextb__setparam_html_a474ce1401632b916b72f30403fbea1bc"><div class="ttname"><a href="namespacextb__setparam.html#a474ce1401632b916b72f30403fbea1bc">xtb_setparam::mhset</a></div><div class="ttdeci">type(modhess_setvar) mhset</div><div class="ttdef"><b>Definition:</b> <a href="setparam_8f90_source.html#l00124">setparam.f90:124</a></div></div>
<div class="ttc" id="anamespacextb__setparam_html_ac07fd07721c7559a18ca5011bc2e1a9c"><div class="ttname"><a href="namespacextb__setparam.html#ac07fd07721c7559a18ca5011bc2e1a9c">xtb_setparam::p_modh_read</a></div><div class="ttdeci">integer, parameter p_modh_read</div><div class="ttdef"><b>Definition:</b> <a href="setparam_8f90_source.html#l00117">setparam.f90:117</a></div></div>
<div class="ttc" id="anamespacextb__single_html"><div class="ttname"><a href="namespacextb__single.html">xtb_single</a></div><div class="ttdef"><b>Definition:</b> <a href="single_8f90_source.html#l00027">single.f90:27</a></div></div>
<div class="ttc" id="anamespacextb__type__anc_html"><div class="ttname"><a href="namespacextb__type__anc.html">xtb_type_anc</a></div><div class="ttdef"><b>Definition:</b> <a href="anc_8f90_source.html#l00018">anc.f90:18</a></div></div>
<div class="ttc" id="anamespacextb__type__calculator_html"><div class="ttname"><a href="namespacextb__type__calculator.html">xtb_type_calculator</a></div><div class="ttdoc">abstract calculator that hides implementation details from calling codes</div><div class="ttdef"><b>Definition:</b> <a href="type_2calculator_8f90_source.html#l00019">calculator.f90:19</a></div></div>
<div class="ttc" id="anamespacextb__type__data_html"><div class="ttname"><a href="namespacextb__type__data.html">xtb_type_data</a></div><div class="ttdef"><b>Definition:</b> <a href="type_2data_8f90_source.html#l00018">data.f90:18</a></div></div>
<div class="ttc" id="anamespacextb__type__dummycalc_html"><div class="ttname"><a href="namespacextb__type__dummycalc.html">xtb_type_dummycalc</a></div><div class="ttdoc">Mock interface for all methods that not yet have their own calculator.</div><div class="ttdef"><b>Definition:</b> <a href="dummycalc_8f90_source.html#l00019">dummycalc.f90:19</a></div></div>
<div class="ttc" id="anamespacextb__type__molecule_html"><div class="ttname"><a href="namespacextb__type__molecule.html">xtb_type_molecule</a></div><div class="ttdoc">molecular structure information</div><div class="ttdef"><b>Definition:</b> <a href="type_2molecule_8f90_source.html#l00034">molecule.f90:34</a></div></div>
<div class="ttc" id="anamespacextb__type__restart_html"><div class="ttname"><a href="namespacextb__type__restart.html">xtb_type_restart</a></div><div class="ttdoc">This data types wraps common restart data for calculator, the main purpose.</div><div class="ttdef"><b>Definition:</b> <a href="type_2restart_8f90_source.html#l00021">restart.f90:21</a></div></div>
<div class="ttc" id="anamespacextb__type__timer_html"><div class="ttname"><a href="namespacextb__type__timer.html">xtb_type_timer</a></div><div class="ttdef"><b>Definition:</b> <a href="timer_8f90_source.html#l00018">timer.f90:18</a></div></div>
<div class="ttc" id="anamespacextb__type__timer_html_a1dcf014087e66f68529af68ba3ab41b0"><div class="ttname"><a href="namespacextb__type__timer.html#a1dcf014087e66f68529af68ba3ab41b0">xtb_type_timer::timer</a></div><div class="ttdeci">subroutine timer(self, i, inmsg)</div><div class="ttdef"><b>Definition:</b> <a href="timer_8f90_source.html#l00216">timer.f90:217</a></div></div>
<div class="ttc" id="aneighbor_8f90_html_a5df91039130b0032e4f6ce1853b1af8a"><div class="ttname"><a href="neighbor_8f90.html#a5df91039130b0032e4f6ce1853b1af8a">chk</a></div><div class="ttdeci">logical function chk(nn, n, c)</div><div class="ttdef"><b>Definition:</b> <a href="neighbor_8f90_source.html#l00120">neighbor.f90:121</a></div></div>
<div class="ttc" id="astructxtb__type__dummycalc_1_1tdummycalculator_html"><div class="ttname"><a href="structxtb__type__dummycalc_1_1tdummycalculator.html">xtb_type_dummycalc::tdummycalculator</a></div><div class="ttdoc">Base calculator.</div><div class="ttdef"><b>Definition:</b> <a href="dummycalc_8f90_source.html#l00054">dummycalc.f90:54</a></div></div>
<div class="ttc" id="asymmetry__i_8c_html_aa77c823a9fc018ae1d437369708d8727"><div class="ttname"><a href="symmetry__i_8c.html#aa77c823a9fc018ae1d437369708d8727">true</a></div><div class="ttdeci">int true(void)</div><div class="ttdef"><b>Definition:</b> <a href="symmetry__i_8c_source.html#l00132">symmetry_i.c:132</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="convert_8f90_source.html#l00024">xtb_mctc_convert::autoaa</a>, <a class="el" href="convert_8f90_source.html#l00030">xtb_mctc_convert::autokcal</a>, <a class="el" href="convert_8f90_source.html#l00033">xtb_mctc_convert::autokj</a>, <a class="el" href="axis__trafo_8f90_source.html#l00116">xtb_axis::axis2()</a>, <a class="el" href="readin_8f90_source.html#l00264">xtb_readin::bool2string()</a>, <a class="el" href="filetools_8F90_source.html#l00084">close_file()</a>, <a class="el" href="fixparam_8f90_source.html#l00028">xtb_fixparam::fixset</a>, <a class="el" href="optimizer_8f90_source.html#l00045">get_optthr()</a>, <a class="el" href="set__module_8f90_source.html#l01564">xtb_setmod::int2optlevel()</a>, <a class="el" href="optimizer_8f90_source.html#l01194">load_turbomole_log()</a>, <a class="el" href="setparam_8f90_source.html#l00124">xtb_setparam::mhset</a>, <a class="el" href="optimizer_8f90_source.html#l00991">modhes()</a>, <a class="el" href="filetools_8F90_source.html#l00048">open_binary()</a>, <a class="el" href="filetools_8F90_source.html#l00066">open_file()</a>, <a class="el" href="setparam_8f90_source.html#l00106">xtb_setparam::optset</a>, <a class="el" href="setparam_8f90_source.html#l00117">xtb_setparam::p_modh_read</a>, <a class="el" href="optimizer_8f90_source.html#l00027">profile</a>, <a class="el" href="optimizer_8f90_source.html#l01117">read_hessian()</a>, <a class="el" href="optimizer_8f90_source.html#l00458">relax()</a>, <a class="el" href="ls__rmsd_8f90_source.html#l00035">xtb_lsrmsd::rmsd()</a>, <a class="el" href="symmetry__i_8c_source.html#l00132">true()</a>, and <a class="el" href="setparam_8f90_source.html#l00407">xtb_setparam::tsopt</a>.</p>

<p class="reference">Referenced by <a class="el" href="bias__path_8f90_source.html#l00031">xtb_biaspath::bias_path()</a>, and <a class="el" href="geoopt__driver_8f90_source.html#l00024">xtb_geoopt::geometry_optimization()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacextb__optimizer_a1743159550358c92fb2761af80e15285_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacextb__optimizer_a1743159550358c92fb2761af80e15285_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="aac5e0b67e6d0738befcb2a7b5b3a232e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aac5e0b67e6d0738befcb2a7b5b3a232e">&#9670;&nbsp;</a></span>findlroot()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine xtb_optimizer::findlroot </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>i0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp), dimension(n), intent(in)&#160;</td>
          <td class="paramname"><em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp), intent(out)&#160;</td>
          <td class="paramname"><em>el</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="optimizer_8f90_source.html#l00800">800</a> of file <a class="el" href="optimizer_8f90_source.html">optimizer.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;   <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: i0</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: n</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(in)</span>  :: e(n)</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(out)</span> :: el</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;   <span class="keywordtype">integer</span> :: i</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160; </div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;   el=1.d+42</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;   <span class="keywordflow">do</span> i=1,n</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;      <span class="keywordflow">if</span>(i.eq.i0.and.i0.gt.0) cycle</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;      <span class="keywordflow">if</span>(abs(e(i)) .gt. 1.d-10 .and. e(i) .lt. el ) el = e(i)</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160; </div>
</div><!-- fragment -->
</div>
</div>
<a id="a4e5edb3c372707d7fc17738f8e563088"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4e5edb3c372707d7fc17738f8e563088">&#9670;&nbsp;</a></span>geoconvav()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine xtb_optimizer::geoconvav </td>
          <td>(</td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>nc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8, dimension(*)&#160;</td>
          <td class="paramname"><em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8, dimension(*)&#160;</td>
          <td class="paramname"><em>g</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8&#160;</td>
          <td class="paramname"><em>val</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8&#160;</td>
          <td class="paramname"><em>deriv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">nc</td><td>total number of E/G points</td></tr>
    <tr><td class="paramname">e</td><td>total energy in Eh</td></tr>
    <tr><td class="paramname">g</td><td>norm of Cartesian gradient (in TM: |dE/dxyz|)</td></tr>
    <tr><td class="paramname">val</td><td>av. energy in Eh to be used further</td></tr>
    <tr><td class="paramname">deriv</td><td>av. gradient </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="optimizer_8f90_source.html#l01136">1136</a> of file <a class="el" href="optimizer_8f90_source.html">optimizer.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;   <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;   <span class="keywordtype">integer</span> nc</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;   real*8  e(*)</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;   real*8  g(*)</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;   real*8  val</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;   real*8  deriv</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160; </div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;   <span class="keywordtype">integer</span> nav, low</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;   <span class="keywordtype">integer</span> i, j</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;   parameter(nav=5)    <span class="comment">! average over last nav</span></div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;   real*8 eav,gav</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160; </div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;   <span class="comment">! only apply it if sufficient number of points i.e. a &quot;tail&quot; can exist</span></div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;   <span class="comment">! with the censo blockl = 8 default, this can first be effective in the second</span></div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;   <span class="keywordflow">if</span>(nc.lt.3*nav)<span class="keywordflow">then</span></div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;      val = e(nc)</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;      deriv = g(nc)</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;      <span class="keywordflow">return</span></div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160; </div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;   low = max(1,nc-nav+1)</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;   j = 0</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;   eav = 0</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;   <span class="keywordflow">do</span> i=nc,low,-1</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;      j = j + 1</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;      eav = eav + e(i)</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;      gav = gav + g(i)</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;   val = eav / float(j)</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160; </div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;   low = max(1,nc-nav+1)</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;   j = 0</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;   gav = 0</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;   <span class="keywordflow">do</span> i=nc,low,-1</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;      j = j + 1</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;      gav = gav + g(i)</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;   <span class="comment">! adjust the gradient norm to xtb &quot;conventions&quot; because e.g. a noisy</span></div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;   <span class="comment">! DCOSMO-RS gradient for large cases can never (even on average)</span></div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;   <span class="comment">! become lower than the &quot;-opt normal&quot; thresholds</span></div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;   deriv=gav / float(j) / 2.d0</div>
</div><!-- fragment -->
</div>
</div>
<a id="ac917d2cb3a3dc7ed9dcda048740f7605"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac917d2cb3a3dc7ed9dcda048740f7605">&#9670;&nbsp;</a></span>get_averaged_energy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pure real(wp) function xtb_optimizer::get_averaged_energy </td>
          <td>(</td>
          <td class="paramtype">class(<a class="el" href="structxtb__optimizer_1_1convergence__log.html">convergence_log</a>), intent(in)&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="optimizer_8f90_source.html#l01244">1244</a> of file <a class="el" href="optimizer_8f90_source.html">optimizer.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;   <span class="keywordtype">class</span>(convergence_log), <span class="keywordtype">intent(in)</span> :: self</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;<span class="keywordtype">   real</span>(wp) :: eav, val</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;   <span class="keywordtype">integer</span> :: i, j, low</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: nav = 5</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160; </div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;   <span class="comment">! only apply it if sufficient number of points i.e. a &quot;tail&quot; can exist</span></div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;   <span class="comment">! with the censo blockl = 8 default, this can first be effective in the second</span></div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;   <span class="keywordflow">if</span>(self%nlog.lt.3*nav)<span class="keywordflow">then</span></div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;      val = self%elog(self%nlog)</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;      low = max(1, self%nlog-nav+1)</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;      j = 0</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;      eav = 0</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;      <span class="keywordflow">do</span> i = self%nlog, low, -1</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;         j = j + 1</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;         eav = eav + self%elog(i)</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;      val = eav / float(j)</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;<span class="keywordflow">   end if</span></div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160; </div>
</div><!-- fragment -->
</div>
</div>
<a id="a80671364fb57d114f191e1477b4bcfaf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a80671364fb57d114f191e1477b4bcfaf">&#9670;&nbsp;</a></span>get_averaged_gradient()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pure real(wp) function xtb_optimizer::get_averaged_gradient </td>
          <td>(</td>
          <td class="paramtype">class(<a class="el" href="structxtb__optimizer_1_1convergence__log.html">convergence_log</a>), intent(in)&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="optimizer_8f90_source.html#l01267">1267</a> of file <a class="el" href="optimizer_8f90_source.html">optimizer.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;   <span class="keywordtype">class</span>(convergence_log), <span class="keywordtype">intent(in)</span> :: self</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;<span class="keywordtype">   real</span>(wp) :: gav, deriv</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;   <span class="keywordtype">integer</span> :: i, j, low</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: nav = 5</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160; </div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;   <span class="comment">! only apply it if sufficient number of points i.e. a &quot;tail&quot; can exist</span></div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;   <span class="comment">! with the censo blockl = 8 default, this can first be effective in the second</span></div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;   <span class="keywordflow">if</span>(self%nlog.lt.3*nav) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;      deriv = self%glog(self%nlog)</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;      low = max(1, self%nlog-nav+1)</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;      j = 0</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;      gav = 0</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;      <span class="keywordflow">do</span> i = self%nlog, low, -1</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;         j = j + 1</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;         gav = gav + self%glog(i)</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;      <span class="comment">! adjust the gradient norm to xtb &quot;conventions&quot; because e.g. a noisy</span></div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;      <span class="comment">! DCOSMO-RS gradient for large cases can never (even on average)</span></div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;      <span class="comment">! become lower than the &quot;-opt normal&quot; thresholds</span></div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;      deriv = gav / float(j) / 2.d0</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;<span class="keywordflow">   end if</span></div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160; </div>
</div><!-- fragment -->
</div>
</div>
<a id="ab081e2736bbf00fa907a142b49fbac44"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab081e2736bbf00fa907a142b49fbac44">&#9670;&nbsp;</a></span>get_optthr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine xtb_optimizer::get_optthr </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>olev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp), intent(out)&#160;</td>
          <td class="paramname"><em>ethr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp), intent(out)&#160;</td>
          <td class="paramname"><em>gthr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(out)&#160;</td>
          <td class="paramname"><em>maxcycle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp), intent(out)&#160;</td>
          <td class="paramname"><em>acc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="optimizer_8f90_source.html#l00044">44</a> of file <a class="el" href="optimizer_8f90_source.html">optimizer.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__setparam.html">xtb_setparam</a></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;   <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: n</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: olev</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(out)</span> :: ethr</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(out)</span> :: gthr</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(out)</span> :: maxcycle</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(out)</span> :: acc</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;   <span class="keywordflow">select case</span>(olev)</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">! very approximate = crude</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;   <span class="keywordflow">case</span>(<a class="code" href="namespacextb__setparam.html#afffbd45467080c5acd25faf49dceec96">p_olev_crude</a>)</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;      ethr   = 5.d-4</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;      gthr   = 1.d-2</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;      maxcycle=n</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;      acc=3.00d0</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">! approximate = sloopy</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;   <span class="keywordflow">case</span>(<a class="code" href="namespacextb__setparam.html#a671cf5ee99c2dd03c9d4d5d119fff994">p_olev_sloppy</a>)</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;      ethr   = 1.d-4</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;      gthr   = 6.d-3</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;      maxcycle=n</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;      acc=3.00d0</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">! loose</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;   <span class="keywordflow">case</span>(<a class="code" href="namespacextb__setparam.html#acfe66cc9a87d43efd2bc5fccbb8ad471">p_olev_loose</a>)</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      ethr   = 5.d-5</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;      gthr   = 4.d-3</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;      maxcycle=n*2</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;      acc=2.00d0</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">!  for DCOSMO-RS opts with TM i.e. between loose and normal, keyword &quot;lax&quot;</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;   <span class="keywordflow">case</span>(<a class="code" href="namespacextb__setparam.html#a8d5a28a7273b90979700870cb2ebe4a4">p_olev_lax</a>)</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      ethr   = 2.d-5</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;      gthr   = 2.5d-3</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;      maxcycle=n*2</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;      acc=2.00d0</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">!  normal</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="keywordflow">   case default</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      ethr  = 5.d-6</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;      gthr  = 1.d-3</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;      maxcycle=n*3</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;      acc=1.0d0</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">! tight</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;   <span class="keywordflow">case</span>(<a class="code" href="namespacextb__setparam.html#a67cd8dc12e742c351a55b7142489b9ba">p_olev_tight</a>)</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;      ethr   = 1.d-6</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;      gthr   = 8.d-4</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;      maxcycle=n*5</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      acc=0.20d0</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">! very tight</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;   <span class="keywordflow">case</span>(<a class="code" href="namespacextb__setparam.html#acf9ab0ba919747414b78cd528575a1ab">p_olev_vtight</a>)</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      ethr   = 1.d-7</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      gthr   = 2.d-4</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;      maxcycle=n*20</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;      acc=0.05d0</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">! extreme</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;   <span class="keywordflow">case</span>(<a class="code" href="namespacextb__setparam.html#a61a597ac531816a98a04dd9c1ed2c7de">p_olev_extreme</a>)</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      ethr   = 5.d-8</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;      gthr   = 5.d-5</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      maxcycle=n*20</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;      acc=0.01d0</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="keywordflow">   end select</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;   maxcycle=min(maxcycle,10000)</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;   maxcycle=max(maxcycle,200)</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160; </div>
<div class="ttc" id="anamespacextb__setparam_html_a61a597ac531816a98a04dd9c1ed2c7de"><div class="ttname"><a href="namespacextb__setparam.html#a61a597ac531816a98a04dd9c1ed2c7de">xtb_setparam::p_olev_extreme</a></div><div class="ttdeci">integer, parameter p_olev_extreme</div><div class="ttdef"><b>Definition:</b> <a href="setparam_8f90_source.html#l00100">setparam.f90:100</a></div></div>
<div class="ttc" id="anamespacextb__setparam_html_a671cf5ee99c2dd03c9d4d5d119fff994"><div class="ttname"><a href="namespacextb__setparam.html#a671cf5ee99c2dd03c9d4d5d119fff994">xtb_setparam::p_olev_sloppy</a></div><div class="ttdeci">integer, parameter p_olev_sloppy</div><div class="ttdef"><b>Definition:</b> <a href="setparam_8f90_source.html#l00094">setparam.f90:94</a></div></div>
<div class="ttc" id="anamespacextb__setparam_html_a67cd8dc12e742c351a55b7142489b9ba"><div class="ttname"><a href="namespacextb__setparam.html#a67cd8dc12e742c351a55b7142489b9ba">xtb_setparam::p_olev_tight</a></div><div class="ttdeci">integer, parameter p_olev_tight</div><div class="ttdef"><b>Definition:</b> <a href="setparam_8f90_source.html#l00098">setparam.f90:98</a></div></div>
<div class="ttc" id="anamespacextb__setparam_html_a8d5a28a7273b90979700870cb2ebe4a4"><div class="ttname"><a href="namespacextb__setparam.html#a8d5a28a7273b90979700870cb2ebe4a4">xtb_setparam::p_olev_lax</a></div><div class="ttdeci">integer, parameter p_olev_lax</div><div class="ttdef"><b>Definition:</b> <a href="setparam_8f90_source.html#l00096">setparam.f90:96</a></div></div>
<div class="ttc" id="anamespacextb__setparam_html_acf9ab0ba919747414b78cd528575a1ab"><div class="ttname"><a href="namespacextb__setparam.html#acf9ab0ba919747414b78cd528575a1ab">xtb_setparam::p_olev_vtight</a></div><div class="ttdeci">integer, parameter p_olev_vtight</div><div class="ttdef"><b>Definition:</b> <a href="setparam_8f90_source.html#l00099">setparam.f90:99</a></div></div>
<div class="ttc" id="anamespacextb__setparam_html_acfe66cc9a87d43efd2bc5fccbb8ad471"><div class="ttname"><a href="namespacextb__setparam.html#acfe66cc9a87d43efd2bc5fccbb8ad471">xtb_setparam::p_olev_loose</a></div><div class="ttdeci">integer, parameter p_olev_loose</div><div class="ttdef"><b>Definition:</b> <a href="setparam_8f90_source.html#l00095">setparam.f90:95</a></div></div>
<div class="ttc" id="anamespacextb__setparam_html_afffbd45467080c5acd25faf49dceec96"><div class="ttname"><a href="namespacextb__setparam.html#afffbd45467080c5acd25faf49dceec96">xtb_setparam::p_olev_crude</a></div><div class="ttdeci">integer, parameter p_olev_crude</div><div class="ttdef"><b>Definition:</b> <a href="setparam_8f90_source.html#l00093">setparam.f90:93</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="setparam_8f90_source.html#l00093">xtb_setparam::p_olev_crude</a>, <a class="el" href="setparam_8f90_source.html#l00100">xtb_setparam::p_olev_extreme</a>, <a class="el" href="setparam_8f90_source.html#l00096">xtb_setparam::p_olev_lax</a>, <a class="el" href="setparam_8f90_source.html#l00095">xtb_setparam::p_olev_loose</a>, <a class="el" href="setparam_8f90_source.html#l00094">xtb_setparam::p_olev_sloppy</a>, <a class="el" href="setparam_8f90_source.html#l00098">xtb_setparam::p_olev_tight</a>, and <a class="el" href="setparam_8f90_source.html#l00099">xtb_setparam::p_olev_vtight</a>.</p>

<p class="reference">Referenced by <a class="el" href="optimizer_8f90_source.html#l00110">ancopt()</a>, <a class="el" href="src_2relaxation__engine_8f90_source.html#l00134">xtb_relaxation_engine::fire()</a>, and <a class="el" href="src_2relaxation__engine_8f90_source.html#l00384">xtb_relaxation_engine::l_ancopt()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacextb__optimizer_ab081e2736bbf00fa907a142b49fbac44_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a7b94fa2f1fead1036c5fcf11605a23a1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7b94fa2f1fead1036c5fcf11605a23a1">&#9670;&nbsp;</a></span>itochess()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine xtb_optimizer::itochess </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nvar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nat3</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp), dimension(nat3,nat3), intent(in)&#160;</td>
          <td class="paramname"><em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp), dimension(nvar*(nvar+1)/2), intent(in)&#160;</td>
          <td class="paramname"><em>hess</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp), dimension(nat3*(nat3+1)/2), intent(out)&#160;</td>
          <td class="paramname"><em>fc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="optimizer_8f90_source.html#l01072">1072</a> of file <a class="el" href="optimizer_8f90_source.html">optimizer.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__mctc__blas.html">xtb_mctc_blas</a>, <span class="keywordtype">only</span> : blas_gemm</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;   <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: nvar</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: nat3</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(in)</span>  :: b(nat3,nat3)</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(in)</span>  :: hess(nvar*(nvar+1)/2)</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(out)</span> :: fc(nat3*(nat3+1)/2)</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160; </div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;   <span class="keywordtype">integer</span> :: i,j,k</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">allocatable</span> :: h(:,:)</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">allocatable</span> :: hb(:,:)</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">allocatable</span> :: chess(:,:)</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160; </div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;   <span class="keyword">allocate</span>(h(nvar,nvar),hb(nvar,nat3),chess(nat3,nat3))</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160; </div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;<span class="comment">!  BLAS implementation of the transformation to cartesians</span></div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;<span class="comment">!  unpack BFGS hess</span></div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;   k=0</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;   <span class="keywordflow">do</span> i=1, nvar</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;      <span class="keywordflow">do</span> j=1,i</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;         k=k+1</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;         h(i,j)=hess(k)</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;         h(j,i)=h(i,j)</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160; </div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;<span class="comment">!  calculate H*B (note: B is saved as Bt)</span></div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;   <span class="keyword">call </span>blas_gemm (<span class="stringliteral">&#39;n&#39;</span>,<span class="stringliteral">&#39;t&#39;</span>,nvar,nat3,nvar,1.0d0,h,nvar,b,nat3,0.0d0,hb,nvar)</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160; </div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;<span class="comment">!  calculate Bt*HB</span></div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;   <span class="keyword">call </span>blas_gemm (<span class="stringliteral">&#39;n&#39;</span>,<span class="stringliteral">&#39;n&#39;</span>,nat3,nat3,nvar,1.0d0,b,nat3,hb,nvar,0.0d0,chess,nat3)</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160; </div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;<span class="comment">!  pack</span></div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;   k=0</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;   <span class="keywordflow">do</span> i=1,nat3</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;      <span class="keywordflow">do</span> j=1,i</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;         k=k+1</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;         fc(k)=chess(j,i)</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160; </div>
<div class="ttc" id="anamespacextb__mctc__blas_html"><div class="ttname"><a href="namespacextb__mctc__blas.html">xtb_mctc_blas</a></div><div class="ttdoc">Interfaces to BLAS.</div><div class="ttdef"><b>Definition:</b> <a href="blas_8f90_source.html#l00019">blas.f90:19</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7c5a5499961d823aba5503ed3aed9716"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7c5a5499961d823aba5503ed3aed9716">&#9670;&nbsp;</a></span>load_turbomole_log()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">type(<a class="el" href="structxtb__optimizer_1_1convergence__log.html">convergence_log</a>) function xtb_optimizer::load_turbomole_log </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nmax</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="optimizer_8f90_source.html#l01193">1193</a> of file <a class="el" href="optimizer_8f90_source.html">optimizer.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__mctc__resize.html">xtb_mctc_resize</a>, <span class="keywordtype">only</span> : <a class="code" href="interfacextb__mctc__resize_1_1resize.html">resize</a></div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__mctc__systools.html">xtb_mctc_systools</a>, <span class="keywordtype">only</span> : <a class="code" href="namespacextb__mctc__systools.html#a7b18e6c9bb5206d8fe0fbba49da3fbdb">getline</a></div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: nmax</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;   <span class="keywordtype">type</span>(convergence_log) :: self</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;   <span class="keywordtype">integer</span> :: nlog, ilog</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;<span class="keywordtype">   real</span>(wp) :: etmp, gtmp</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;<span class="keywordtype">   real</span>(wp), <span class="keywordtype">allocatable</span> :: elog(:), glog(:)</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;   <span class="keywordtype">character(len=:)</span>, <span class="keywordtype">allocatable</span> :: line</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;   <span class="keywordtype">logical</span> :: exist</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: initial_size = 50</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;   <span class="keywordtype">integer</span> :: unit, stat</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;   nlog = 0</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;   <span class="keyword">inquire</span>(file=<span class="stringliteral">&quot;gradient&quot;</span>, exist=exist)</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;   <span class="keywordflow">if</span> (exist) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;      <span class="keyword">open</span>(file=<span class="stringliteral">&quot;gradient&quot;</span>, newunit=unit)</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;      <span class="keyword">allocate</span>(elog(initial_size), glog(initial_size))</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacextb__mctc__systools.html#a7b18e6c9bb5206d8fe0fbba49da3fbdb">getline</a>(unit, line, stat)</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;      <span class="keywordflow">do</span> <span class="keywordflow">while</span>(stat == 0)</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;         <span class="keywordflow">if</span> (index(line, <span class="stringliteral">&quot;cycle&quot;</span>) &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;            <span class="keywordflow">if</span> (tokenize_cycle(line, etmp, gtmp)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;               <span class="keywordflow">if</span> (nlog &gt;= <span class="keyword">size</span>(elog)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;                  <span class="keyword">call </span><a class="code" href="interfacextb__mctc__resize_1_1resize.html">resize</a>(elog, <span class="keyword">size</span>(elog)+<span class="keyword">size</span>(elog)/2+1)</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;                  <span class="keyword">call </span><a class="code" href="interfacextb__mctc__resize_1_1resize.html">resize</a>(glog, <span class="keyword">size</span>(glog)+<span class="keyword">size</span>(glog)/2+1)</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;<span class="keywordflow">               end if</span></div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;               nlog = nlog + 1</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;               elog(nlog) = etmp</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;               glog(nlog) = gtmp</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;<span class="keywordflow">            end if</span></div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;<span class="keywordflow">         end if</span></div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;         <span class="keyword">call </span><a class="code" href="namespacextb__mctc__systools.html#a7b18e6c9bb5206d8fe0fbba49da3fbdb">getline</a>(unit, line, stat)</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;      <span class="keyword">close</span>(unit)</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;<span class="keywordflow">   end if</span></div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;   self = convergence_log(nmax + nlog)</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;   <span class="keywordflow">do</span> ilog = 1, nlog</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;      <span class="keyword">call </span>self%set_eg_log(elog(ilog), glog(ilog))</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;<span class="keywordflow">   end do</span></div>
<div class="ttc" id="ainterfacextb__mctc__resize_1_1resize_html"><div class="ttname"><a href="interfacextb__mctc__resize_1_1resize.html">xtb_mctc_resize::resize</a></div><div class="ttdoc">Overloaded resize interface.</div><div class="ttdef"><b>Definition:</b> <a href="resize_8f90_source.html#l00028">resize.f90:28</a></div></div>
<div class="ttc" id="anamespacextb__mctc__resize_html"><div class="ttname"><a href="namespacextb__mctc__resize.html">xtb_mctc_resize</a></div><div class="ttdoc">Reallocation implementation for resizing arrays.</div><div class="ttdef"><b>Definition:</b> <a href="resize_8f90_source.html#l00019">resize.f90:19</a></div></div>
<div class="ttc" id="anamespacextb__mctc__systools_html"><div class="ttname"><a href="namespacextb__mctc__systools.html">xtb_mctc_systools</a></div><div class="ttdef"><b>Definition:</b> <a href="systools_8F90_source.html#l00018">systools.F90:18</a></div></div>
<div class="ttc" id="anamespacextb__mctc__systools_html_a7b18e6c9bb5206d8fe0fbba49da3fbdb"><div class="ttname"><a href="namespacextb__mctc__systools.html#a7b18e6c9bb5206d8fe0fbba49da3fbdb">xtb_mctc_systools::getline</a></div><div class="ttdeci">subroutine getline(unit, line, iostat)</div><div class="ttdef"><b>Definition:</b> <a href="systools_8F90_source.html#l00032">systools.F90:33</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="systools_8F90_source.html#l00033">xtb_mctc_systools::getline()</a>, and <a class="el" href="optimizer_8f90_source.html#l01234">tokenize_cycle()</a>.</p>

<p class="reference">Referenced by <a class="el" href="optimizer_8f90_source.html#l00110">ancopt()</a>, and <a class="el" href="src_2relaxation__engine_8f90_source.html#l00384">xtb_relaxation_engine::l_ancopt()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacextb__optimizer_a7c5a5499961d823aba5503ed3aed9716_cgraph.svg" width="339" height="118"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacextb__optimizer_a7c5a5499961d823aba5503ed3aed9716_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a9fc9ad9955c0a2ef4872d25495d02901"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9fc9ad9955c0a2ef4872d25495d02901">&#9670;&nbsp;</a></span>modhes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine xtb_optimizer::modhes </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structxtb__type__environment_1_1tenvironment.html">tenvironment</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">class(<a class="el" href="structxtb__type__calculator_1_1tcalculator.html">tcalculator</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>calc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structxtb__type__setvar_1_1modhess__setvar.html">modhess_setvar</a>), intent(in)&#160;</td>
          <td class="paramname"><em>modh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>natoms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp), dimension(3,natoms), intent(in)&#160;</td>
          <td class="paramname"><em>xyz</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(natoms), intent(in)&#160;</td>
          <td class="paramname"><em>chg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp), dimension((natoms*3)*((natoms*3)+1)/2), intent(out)&#160;</td>
          <td class="paramname"><em>Hess</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>pr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">env</td><td>Calculation environment</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">calc</td><td>Calculator </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="optimizer_8f90_source.html#l00990">990</a> of file <a class="el" href="optimizer_8f90_source.html">optimizer.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__type__setvar.html">xtb_type_setvar</a></div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__modelhessian.html">xtb_modelhessian</a></div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__setparam.html">xtb_setparam</a></div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__type__calculator.html">xtb_type_calculator</a></div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__gfnff__calculator.html">xtb_gfnff_calculator</a></div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;<span class="comment">!</span></div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;<span class="comment">!       generates a Lindh Model Hessian</span></div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;<span class="comment">!       Chem. Phys. Let. 241(1995) 423-428</span></div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;<span class="comment">!       with personal permission from R.L.</span></div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;<span class="comment">!</span></div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;   <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160; </div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;   <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">parameter</span> :: source = <span class="stringliteral">&quot;optimizer_modhes&quot;</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160; </div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;   <span class="keywordtype">type</span>(TEnvironment), <span class="keywordtype">intent(inout)</span> :: env</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160; </div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;   <span class="keywordtype">class</span>(TCalculator), <span class="keywordtype">intent(inout)</span> :: calc</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160; </div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;   <span class="keywordtype">type</span>(modhess_setvar),<span class="keywordtype">intent(in)</span> :: modh</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;   <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span>  :: pr</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160; </div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;<span class="comment">!  Other variables</span></div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;   <span class="keywordtype">integer</span>  :: i</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;   <span class="keywordtype">integer</span>  :: nhess</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: natoms</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(in)</span>  :: xyz(3,natoms)</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(out)</span> :: hess((natoms*3)*((natoms*3)+1)/2)</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: chg(natoms)</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160; </div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;<span class="comment">!  initialize</span></div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;   nhess=3*natoms</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;   hess=0.d0</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160; </div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;   <span class="keywordflow">select type</span>(calc)</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="keywordflow">   class default</span></div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;      <span class="keywordflow">select case</span>(modh%model)</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;<span class="keywordflow">      case default</span></div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;         <span class="keyword">call </span>env%error(<span class="stringliteral">&quot;internal error in model hessian!&quot;</span>, source)</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;      <span class="keywordflow">case</span>(<a class="code" href="namespacextb__setparam.html#aea8903c8e8ddf38c4176b14c0c90f979">p_modh_old</a>)</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;        <span class="keywordflow">if</span> (pr) <span class="keyword">write</span>(env%unit,<span class="stringliteral">&#39;(a)&#39;</span>) <span class="stringliteral">&quot;Using Lindh-Hessian (1995)&quot;</span></div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;        <span class="keyword">call </span><a class="code" href="model__hessian_8f90.html#a8ddb2f654ea22dd5995a2eae4e7fefea">ddvopt</a>(xyz, natoms, hess, chg, modh%s6)</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;      <span class="keywordflow">case</span>(<a class="code" href="namespacextb__setparam.html#a7c9a589191e6026e6ba03f49250ce037">p_modh_lindh_d2</a>)</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;        <span class="keywordflow">if</span> (pr) <span class="keyword">write</span>(env%unit,<span class="stringliteral">&#39;(a)&#39;</span>) <span class="stringliteral">&quot;Using Lindh-Hessian&quot;</span></div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;        <span class="keyword">call </span><a class="code" href="namespacextb__modelhessian.html#aeac126ed2b182b5b9b95cc656eeebdd8">mh_lindh_d2</a>(xyz, natoms, hess, chg, modh)</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;      <span class="keywordflow">case</span>(<a class="code" href="namespacextb__setparam.html#aebc3423c2bd9406449b1195523122c37">p_modh_lindh</a>)</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;        <span class="keywordflow">if</span> (pr) <span class="keyword">write</span>(env%unit,<span class="stringliteral">&#39;(a)&#39;</span>) <span class="stringliteral">&quot;Using Lindh-Hessian (2007)&quot;</span></div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;        <span class="keyword">call </span><a class="code" href="namespacextb__modelhessian.html#a6bc2a8d29739cdd126d59aafcd2dee6d">mh_lindh</a>(xyz, natoms, hess, chg, modh)</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;      <span class="keywordflow">case</span>(<a class="code" href="namespacextb__setparam.html#a016950a4297ef5d520faafdb6468a851">p_modh_swart</a>)</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;        <span class="keywordflow">if</span> (pr) <span class="keyword">write</span>(env%unit,<span class="stringliteral">&#39;(a)&#39;</span>) <span class="stringliteral">&quot;Using Swart-Hessian&quot;</span></div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;        <span class="keyword">call </span><a class="code" href="namespacextb__modelhessian.html#af0b957655663d37ee8995ae61bfbc37d">mh_swart</a>(xyz, natoms, hess, chg, modh)</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;<span class="keywordflow">      end select</span></div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;<span class="keywordflow">   type is</span>(<a class="code" href="structxtb__gfnff__calculator_1_1tgffcalculator.html">tgffcalculator</a>)</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;      <span class="keywordflow">select case</span>(modh%model)</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;<span class="keywordflow">      case default</span></div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;         <span class="keywordflow">if</span> (pr) <span class="keyword">write</span>(env%unit,<span class="stringliteral">&#39;(a)&#39;</span>) <span class="stringliteral">&quot;Using GFN-FF Lindh-Hessian&quot;</span></div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;         <span class="keyword">call </span><a class="code" href="model__hessian_8f90.html#abccf38239d3064bd92ed3de4ec0eefad">gff_ddvopt</a>(xyz, natoms, hess, chg, modh%s6, calc%param, calc%topo)</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;      <span class="keywordflow">case</span>(<a class="code" href="namespacextb__setparam.html#a7c9a589191e6026e6ba03f49250ce037">p_modh_lindh_d2</a>)</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;        <span class="keywordflow">if</span> (pr) <span class="keyword">write</span>(env%unit,<span class="stringliteral">&#39;(a)&#39;</span>) <span class="stringliteral">&quot;Using Lindh-Hessian&quot;</span></div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;        <span class="keyword">call </span><a class="code" href="namespacextb__modelhessian.html#aeac126ed2b182b5b9b95cc656eeebdd8">mh_lindh_d2</a>(xyz, natoms, hess, chg, modh)</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;      <span class="keywordflow">case</span>(<a class="code" href="namespacextb__setparam.html#aebc3423c2bd9406449b1195523122c37">p_modh_lindh</a>)</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;        <span class="keywordflow">if</span> (pr) <span class="keyword">write</span>(env%unit,<span class="stringliteral">&#39;(a)&#39;</span>) <span class="stringliteral">&quot;Using Lindh-Hessian (2007)&quot;</span></div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;        <span class="keyword">call </span><a class="code" href="namespacextb__modelhessian.html#a6bc2a8d29739cdd126d59aafcd2dee6d">mh_lindh</a>(xyz, natoms, hess, chg, modh)</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;      <span class="keywordflow">case</span>(<a class="code" href="namespacextb__setparam.html#a016950a4297ef5d520faafdb6468a851">p_modh_swart</a>)</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;        <span class="keywordflow">if</span> (pr) <span class="keyword">write</span>(env%unit,<span class="stringliteral">&#39;(a)&#39;</span>) <span class="stringliteral">&quot;Using Swart-Hessian&quot;</span></div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;        <span class="keyword">call </span><a class="code" href="namespacextb__modelhessian.html#af0b957655663d37ee8995ae61bfbc37d">mh_swart</a>(xyz, natoms, hess, chg, modh)</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;<span class="keywordflow">      end select</span></div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;<span class="keywordflow">   end select</span></div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160; </div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;<span class="comment">!  constraints</span></div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;   <span class="keyword">call </span><a class="code" href="constr_8f90.html#a32820f74383b0f93c743faceb8385214">constrhess</a>(natoms,chg,xyz,hess)</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160; </div>
<div class="ttc" id="aconstr_8f90_html_a32820f74383b0f93c743faceb8385214"><div class="ttname"><a href="constr_8f90.html#a32820f74383b0f93c743faceb8385214">constrhess</a></div><div class="ttdeci">subroutine constrhess(nat, at, xyz0, Hess)</div><div class="ttdef"><b>Definition:</b> <a href="constr_8f90_source.html#l00337">constr.f90:338</a></div></div>
<div class="ttc" id="amodel__hessian_8f90_html_a8ddb2f654ea22dd5995a2eae4e7fefea"><div class="ttname"><a href="model__hessian_8f90.html#a8ddb2f654ea22dd5995a2eae4e7fefea">ddvopt</a></div><div class="ttdeci">subroutine ddvopt(Cart, nAtoms, Hess, iANr, s6)</div><div class="ttdef"><b>Definition:</b> <a href="model__hessian_8f90_source.html#l02084">model_hessian.f90:2085</a></div></div>
<div class="ttc" id="amodel__hessian_8f90_html_abccf38239d3064bd92ed3de4ec0eefad"><div class="ttname"><a href="model__hessian_8f90.html#abccf38239d3064bd92ed3de4ec0eefad">gff_ddvopt</a></div><div class="ttdeci">subroutine gff_ddvopt(Cart, nAtoms, Hess, at, s6, param, topo)</div><div class="ttdef"><b>Definition:</b> <a href="model__hessian_8f90_source.html#l02655">model_hessian.f90:2656</a></div></div>
<div class="ttc" id="anamespacextb__gfnff__calculator_html"><div class="ttname"><a href="namespacextb__gfnff__calculator.html">xtb_gfnff_calculator</a></div><div class="ttdoc">Force field calculator.</div><div class="ttdef"><b>Definition:</b> <a href="gfnff_2calculator_8f90_source.html#l00019">calculator.f90:19</a></div></div>
<div class="ttc" id="anamespacextb__modelhessian_html"><div class="ttname"><a href="namespacextb__modelhessian.html">xtb_modelhessian</a></div><div class="ttdef"><b>Definition:</b> <a href="model__hessian_8f90_source.html#l00026">model_hessian.f90:26</a></div></div>
<div class="ttc" id="anamespacextb__modelhessian_html_a6bc2a8d29739cdd126d59aafcd2dee6d"><div class="ttname"><a href="namespacextb__modelhessian.html#a6bc2a8d29739cdd126d59aafcd2dee6d">xtb_modelhessian::mh_lindh</a></div><div class="ttdeci">subroutine, public mh_lindh(xyz, n, hess, at, modh)</div><div class="ttdef"><b>Definition:</b> <a href="model__hessian_8f90_source.html#l00798">model_hessian.f90:799</a></div></div>
<div class="ttc" id="anamespacextb__modelhessian_html_aeac126ed2b182b5b9b95cc656eeebdd8"><div class="ttname"><a href="namespacextb__modelhessian.html#aeac126ed2b182b5b9b95cc656eeebdd8">xtb_modelhessian::mh_lindh_d2</a></div><div class="ttdeci">subroutine, public mh_lindh_d2(xyz, n, hess, at, modh)</div><div class="ttdef"><b>Definition:</b> <a href="model__hessian_8f90_source.html#l00717">model_hessian.f90:718</a></div></div>
<div class="ttc" id="anamespacextb__modelhessian_html_af0b957655663d37ee8995ae61bfbc37d"><div class="ttname"><a href="namespacextb__modelhessian.html#af0b957655663d37ee8995ae61bfbc37d">xtb_modelhessian::mh_swart</a></div><div class="ttdeci">subroutine, public mh_swart(xyz, n, hess, at, modh)</div><div class="ttdef"><b>Definition:</b> <a href="model__hessian_8f90_source.html#l00099">model_hessian.f90:100</a></div></div>
<div class="ttc" id="anamespacextb__setparam_html_a016950a4297ef5d520faafdb6468a851"><div class="ttname"><a href="namespacextb__setparam.html#a016950a4297ef5d520faafdb6468a851">xtb_setparam::p_modh_swart</a></div><div class="ttdeci">integer, parameter p_modh_swart</div><div class="ttdef"><b>Definition:</b> <a href="setparam_8f90_source.html#l00121">setparam.f90:121</a></div></div>
<div class="ttc" id="anamespacextb__setparam_html_a7c9a589191e6026e6ba03f49250ce037"><div class="ttname"><a href="namespacextb__setparam.html#a7c9a589191e6026e6ba03f49250ce037">xtb_setparam::p_modh_lindh_d2</a></div><div class="ttdeci">integer, parameter p_modh_lindh_d2</div><div class="ttdef"><b>Definition:</b> <a href="setparam_8f90_source.html#l00120">setparam.f90:120</a></div></div>
<div class="ttc" id="anamespacextb__setparam_html_aea8903c8e8ddf38c4176b14c0c90f979"><div class="ttname"><a href="namespacextb__setparam.html#aea8903c8e8ddf38c4176b14c0c90f979">xtb_setparam::p_modh_old</a></div><div class="ttdeci">integer, parameter p_modh_old</div><div class="ttdef"><b>Definition:</b> <a href="setparam_8f90_source.html#l00122">setparam.f90:122</a></div></div>
<div class="ttc" id="anamespacextb__setparam_html_aebc3423c2bd9406449b1195523122c37"><div class="ttname"><a href="namespacextb__setparam.html#aebc3423c2bd9406449b1195523122c37">xtb_setparam::p_modh_lindh</a></div><div class="ttdeci">integer, parameter p_modh_lindh</div><div class="ttdef"><b>Definition:</b> <a href="setparam_8f90_source.html#l00119">setparam.f90:119</a></div></div>
<div class="ttc" id="anamespacextb__type__setvar_html"><div class="ttname"><a href="namespacextb__type__setvar.html">xtb_type_setvar</a></div><div class="ttdef"><b>Definition:</b> <a href="setvar_8f90_source.html#l00018">setvar.f90:18</a></div></div>
<div class="ttc" id="astructxtb__gfnff__calculator_1_1tgffcalculator_html"><div class="ttname"><a href="structxtb__gfnff__calculator_1_1tgffcalculator.html">xtb_gfnff_calculator::tgffcalculator</a></div><div class="ttdoc">Calculator interface for xTB based methods.</div><div class="ttdef"><b>Definition:</b> <a href="gfnff_2calculator_8f90_source.html#l00057">calculator.f90:57</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="constr_8f90_source.html#l00338">constrhess()</a>, <a class="el" href="model__hessian_8f90_source.html#l02085">ddvopt()</a>, <a class="el" href="model__hessian_8f90_source.html#l02656">gff_ddvopt()</a>, <a class="el" href="model__hessian_8f90_source.html#l00799">xtb_modelhessian::mh_lindh()</a>, <a class="el" href="model__hessian_8f90_source.html#l00718">xtb_modelhessian::mh_lindh_d2()</a>, <a class="el" href="model__hessian_8f90_source.html#l00100">xtb_modelhessian::mh_swart()</a>, <a class="el" href="setparam_8f90_source.html#l00119">xtb_setparam::p_modh_lindh</a>, <a class="el" href="setparam_8f90_source.html#l00120">xtb_setparam::p_modh_lindh_d2</a>, <a class="el" href="setparam_8f90_source.html#l00122">xtb_setparam::p_modh_old</a>, and <a class="el" href="setparam_8f90_source.html#l00121">xtb_setparam::p_modh_swart</a>.</p>

<p class="reference">Referenced by <a class="el" href="optimizer_8f90_source.html#l00110">ancopt()</a>, <a class="el" href="src_2relaxation__engine_8f90_source.html#l00134">xtb_relaxation_engine::fire()</a>, and <a class="el" href="src_2relaxation__engine_8f90_source.html#l00384">xtb_relaxation_engine::l_ancopt()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacextb__optimizer_a9fc9ad9955c0a2ef4872d25495d02901_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacextb__optimizer_a9fc9ad9955c0a2ef4872d25495d02901_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a162008fd7928b139bb350d4f04973108"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a162008fd7928b139bb350d4f04973108">&#9670;&nbsp;</a></span>new_convergence_log()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pure type(<a class="el" href="structxtb__optimizer_1_1convergence__log.html">convergence_log</a>) function xtb_optimizer::new_convergence_log </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nmax</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="optimizer_8f90_source.html#l01185">1185</a> of file <a class="el" href="optimizer_8f90_source.html">optimizer.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: nmax</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;   <span class="keywordtype">type</span>(convergence_log) :: self</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;   self%nlog = 0</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;   <span class="keyword">allocate</span>(self%elog(nmax))</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;   <span class="keyword">allocate</span>(self%glog(nmax))</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="optimizer_8f90_source.html#l00036">xtb_optimizer::convergence_log::get_averaged_gradient()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacextb__optimizer_a162008fd7928b139bb350d4f04973108_icgraph.svg" width="370" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ad8b96d1bdf59374d1f9d98170739bbf6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad8b96d1bdf59374d1f9d98170739bbf6">&#9670;&nbsp;</a></span>prdechng()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine xtb_optimizer::prdechng </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nat3</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp), dimension(nat3), intent(in)&#160;</td>
          <td class="paramname"><em>grad</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp), dimension(nat3), intent(in)&#160;</td>
          <td class="paramname"><em>displ</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp), dimension(nat3*(nat3+1)/2), intent(in)&#160;</td>
          <td class="paramname"><em>hess</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp), intent(out)&#160;</td>
          <td class="paramname"><em>depred</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="optimizer_8f90_source.html#l00858">858</a> of file <a class="el" href="optimizer_8f90_source.html">optimizer.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;<span class="comment">!---------------------------------------------------------------------</span></div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;<span class="comment">! Purpose:</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;<span class="comment">! Calculates predicted energy change according to the second order</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;<span class="comment">! model.</span></div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;<span class="comment">!</span></div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;<span class="comment">! Input:</span></div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;<span class="comment">! nat3  - 3*natoms</span></div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;<span class="comment">! hess  - Hessian matrix stored as lower triangle</span></div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;<span class="comment">! grad  - Gradient vector</span></div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;<span class="comment">! displ - Displacement vector</span></div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;<span class="comment">!</span></div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;<span class="comment">! Output:</span></div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;<span class="comment">! depred - Predicted energy change</span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;<span class="comment">!---------------------------------------------------------------------</span></div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__mctc__blas.html">xtb_mctc_blas</a>, <span class="keywordtype">only</span> : blas_spmv</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;   <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160; </div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;<span class="comment">! Input:</span></div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: nat3</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(in)</span> :: grad(nat3)</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(in)</span> :: displ(nat3)</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(in)</span> :: hess(nat3*(nat3+1)/2)</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160; </div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;<span class="comment">! Output:</span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(out)</span> :: depred</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160; </div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;<span class="comment">! Local:</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;<span class="keywordtype">   real</span>(wp), <span class="keywordtype">allocatable</span> :: hdx(:)</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;<span class="keywordtype">   real</span>(wp) :: gtmp, htmp</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160; </div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;<span class="comment">! BLAS functions:</span></div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;<span class="keywordtype">   real</span>(wp), <span class="keywordtype">external</span> :: ddot</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;<span class="comment">!---------------------------------------------------------------------</span></div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;   <span class="keyword">allocate</span>( hdx(nat3), source = 0.0_wp )</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160; </div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;   <span class="keyword">call </span>blas_spmv(<span class="stringliteral">&#39;u&#39;</span>,nat3,0.5d0,hess,displ,1,0.0d0,hdx,1)</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160; </div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;   gtmp   = ddot(nat3,displ,1,grad,1)</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160; </div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;   htmp   = ddot(nat3,displ,1,hdx,1)</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160; </div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;   depred = htmp + gtmp</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="optimizer_8f90_source.html#l00458">relax()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacextb__optimizer_ad8b96d1bdf59374d1f9d98170739bbf6_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a0811d242ecca3d083b72ce4ffe706d6e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0811d242ecca3d083b72ce4ffe706d6e">&#9670;&nbsp;</a></span>prdispl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine xtb_optimizer::prdispl </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nvar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp), dimension(nvar), intent(in)&#160;</td>
          <td class="paramname"><em>displ</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="optimizer_8f90_source.html#l00951">951</a> of file <a class="el" href="optimizer_8f90_source.html">optimizer.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;   <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: nvar</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(in)</span>  :: displ(nvar)</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">allocatable</span> :: er(:)</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">allocatable</span> :: merk(:)</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;   <span class="keywordtype">integer</span>  :: i,j,ii,k</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;   <span class="keywordtype">integer</span>  :: ihilf</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;<span class="keywordtype">   real</span>(wp) :: pp</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;   <span class="keyword">allocate</span>( er(nvar), source = 0.0_wp )</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;   <span class="keyword">allocate</span>( merk(nvar), source = 0 )</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160; </div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;   er = abs(displ)</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160; </div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;   <span class="keywordflow">do</span> i=1,nvar</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;      merk(i)=i</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;   <span class="keywordflow">do</span> ii=2,nvar</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;      i =ii-1</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;      k =i</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;      pp=er(i)</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;      <span class="keywordflow">do</span> j=ii, nvar</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;         <span class="keywordflow">if</span>(er(j).le.pp) cycle</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;         k=j</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;         pp=er(j)</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;      <span class="keywordflow">if</span> (k.eq.i) cycle</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;      er(k)=er(i)</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;      er(i)=pp</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;      ihilf=merk(i)</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;      merk(i)=merk(k)</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;      merk(k)=ihilf</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160; </div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;   <span class="keyword">write</span>(*,<span class="stringliteral">&#39;(&#39;</span><span class="stringliteral">&#39;Largest |displ|/coords:&#39;</span><span class="stringliteral">&#39;,5(f8.4,&#39;</span><span class="stringliteral">&#39; (&#39;</span><span class="stringliteral">&#39;,i4,&#39;</span><span class="stringliteral">&#39;)&#39;</span><span class="stringliteral">&#39;))&#39;</span>) &amp;</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;      (er(i),merk(i),i=1,min(3,nvar))</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160; </div>
</div><!-- fragment -->
</div>
</div>
<a id="a883d1b09a784468979d989277b406a30"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a883d1b09a784468979d989277b406a30">&#9670;&nbsp;</a></span>read_hessian()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine xtb_optimizer::read_hessian </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>ihess</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>ndim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp), dimension(:, :), intent(out)&#160;</td>
          <td class="paramname"><em>hessian</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(out)&#160;</td>
          <td class="paramname"><em>error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="optimizer_8f90_source.html#l01116">1116</a> of file <a class="el" href="optimizer_8f90_source.html">optimizer.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__mctc__systools.html">xtb_mctc_systools</a></div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;   <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: ihess</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: ndim</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;<span class="keywordtype">   real</span>(wp), <span class="keywordtype">intent(out)</span> :: hessian(:, :)</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;   <span class="keywordtype">character(len=:)</span>, <span class="keywordtype">allocatable</span> :: line</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(out)</span> :: error</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;   <span class="keywordtype">integer</span> :: i, j</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;   error = 0</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;   <span class="keywordflow">do</span> <span class="keywordflow">while</span>(error == 0)</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacextb__mctc__systools.html#a7b18e6c9bb5206d8fe0fbba49da3fbdb">getline</a>(ihess, line, error)</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;      <span class="keywordflow">if</span> (index(line, <span class="stringliteral">&#39;$hessian&#39;</span>) == 1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;         <span class="keyword">read</span>(ihess, *, iostat=error) &amp;</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;            &amp; ((hessian(j, i), j = 1, ndim), i = 1, ndim)</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;         <span class="keywordflow">exit</span></div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;<span class="keywordflow">   enddo</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="systools_8F90_source.html#l00033">xtb_mctc_systools::getline()</a>.</p>

<p class="reference">Referenced by <a class="el" href="optimizer_8f90_source.html#l00110">ancopt()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacextb__optimizer_a883d1b09a784468979d989277b406a30_cgraph.svg" width="324" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacextb__optimizer_a883d1b09a784468979d989277b406a30_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a0ae8aa844914d8a5dfd34b5a91faaf32"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ae8aa844914d8a5dfd34b5a91faaf32">&#9670;&nbsp;</a></span>relax()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine xtb_optimizer::relax </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structxtb__type__environment_1_1tenvironment.html">tenvironment</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>iter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structxtb__type__molecule_1_1tmolecule.html">tmolecule</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>mol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structxtb__type__anc_1_1tb__anc.html">tb_anc</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>anc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical&#160;</td>
          <td class="paramname"><em>restart</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>maxcycle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp)&#160;</td>
          <td class="paramname"><em>maxdispl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp)&#160;</td>
          <td class="paramname"><em>ethr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp)&#160;</td>
          <td class="paramname"><em>gthr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>ii</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structxtb__type__restart_1_1trestart.html">trestart</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>chk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">class(<a class="el" href="structxtb__type__calculator_1_1tcalculator.html">tcalculator</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>calc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp), intent(inout)&#160;</td>
          <td class="paramname"><em>egap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp), intent(in)&#160;</td>
          <td class="paramname"><em>acc_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp), intent(in)&#160;</td>
          <td class="paramname"><em>et</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>maxiter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>iupdat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp), intent(inout)&#160;</td>
          <td class="paramname"><em>etot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp), dimension(3,mol%n), intent(inout)&#160;</td>
          <td class="paramname"><em>g</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp), dimension(3,3), intent(inout)&#160;</td>
          <td class="paramname"><em>sigma</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>ilog</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical&#160;</td>
          <td class="paramname"><em>pr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical&#160;</td>
          <td class="paramname"><em>fail</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(out)&#160;</td>
          <td class="paramname"><em>converged</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structxtb__type__timer_1_1tb__timer.html">tb_timer</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>timer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>exact</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structxtb__optimizer_1_1convergence__log.html">convergence_log</a>), intent(inout), optional&#160;</td>
          <td class="paramname"><em>avconv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>actual optimization procedure </p>
<p>note that this subroutines implements the main loop of the optimization procedure INSIDE the mirco iterator which is implemented by the calling routine, the only way to leave this subroutine is by an EARLY return, without going over the RESTART logical at the end of the subroutine. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">env</td><td>Calculation environment </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="optimizer_8f90_source.html#l00454">454</a> of file <a class="el" href="optimizer_8f90_source.html">optimizer.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160; </div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__mctc__blas.html">xtb_mctc_blas</a>, <span class="keywordtype">only</span> : blas_gemv</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__type__molecule.html">xtb_type_molecule</a></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__type__anc.html">xtb_type_anc</a></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__type__restart.html">xtb_type_restart</a></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__type__calculator.html">xtb_type_calculator</a></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__type__data.html">xtb_type_data</a></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__type__timer.html">xtb_type_timer</a></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160; </div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__single.html">xtb_single</a>, <span class="keywordtype">only</span> : <a class="code" href="interfacextb__type__calculator_1_1singlepoint.html">singlepoint</a></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160; </div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;   <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160; </div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;   <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">parameter</span> :: source = <span class="stringliteral">&quot;optimizer_relax&quot;</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160; </div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;   <span class="keywordtype">type</span>(TEnvironment), <span class="keywordtype">intent(inout)</span> :: env</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160; </div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;   <span class="keywordtype">type</span>(TMolecule),    <span class="keywordtype">intent(inout)</span> :: mol</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;   <span class="keywordtype">type</span>(tb_timer),       <span class="keywordtype">intent(inout)</span> :: timer</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;   <span class="keywordtype">type</span>(tb_anc),         <span class="keywordtype">intent(inout)</span> :: anc</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;   <span class="keywordtype">type</span>(TRestart),<span class="keywordtype">intent(inout)</span> :: chk</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;   <span class="keywordtype">class</span>(TCalculator), <span class="keywordtype">intent(inout)</span> :: calc</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>    :: maxiter</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>    :: iupdat</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>    :: ilog</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(in)</span>    :: et</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(inout)</span> :: etot</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(in)</span>    :: acc_in</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(inout)</span> :: g(3,mol%n)</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(inout)</span> :: sigma(3,3)</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(inout)</span> :: egap</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;   <span class="keywordtype">logical</span>, <span class="keywordtype">intent(out)</span>   :: converged</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;   <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span>    :: exact</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;   <span class="keywordtype">type</span>(convergence_log), <span class="keywordtype">intent(inout)</span>, <span class="keywordtype">optional</span> :: avconv</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160; </div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;   <span class="keywordtype">type</span>(scc_results) :: res</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;   <span class="keywordtype">integer</span>  :: nvar1,npvar,npvar1</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;   <span class="keywordtype">logical</span>  :: restart, first, pr, fail</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;   <span class="keywordtype">logical</span>  :: econverged</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;   <span class="keywordtype">logical</span>  :: gconverged</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;   <span class="keywordtype">logical</span>  :: lowered</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;   <span class="keywordtype">integer</span>  :: maxcycle, iter, prlevel</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;   <span class="keywordtype">integer</span>  :: i, j, ii, jj, k, lwork, info, m, idum, imax(3)</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="keywordtype">   real</span>(wp) :: energy,ethr,gthr,dsnrm,maxdispl,t0,w0,t1,w1</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="keywordtype">   real</span>(wp) :: lambda,gnorm,dnorm,ddot,eold,xdum,estart,acc,e_in</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="keywordtype">   real</span>(wp) :: depred,echng,dummy,maxd,alp,gchng,smallreal,gnold</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">allocatable</span> :: gold(:)</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">allocatable</span> :: displ(:), gint(:)</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="keywordtype">   real</span>(sp),<span class="keywordtype">allocatable</span> :: eaug(:)</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="keywordtype">   real</span>(sp),<span class="keywordtype">allocatable</span> :: Uaug(:,:)</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="keywordtype">   real</span>(sp),<span class="keywordtype">allocatable</span> :: Aaug(:)</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="keywordtype">   real</span>(sp) :: r4dum,sdot</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;   parameter(r4dum=1.e-8)</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;   parameter(smallreal=1.d-14)</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160; </div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;   <span class="keyword">allocate</span>( gold(anc%nvar), displ(anc%nvar), gint(anc%nvar), source = 0.0_wp )</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160; </div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;   prlevel=0</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;   <span class="keywordflow">if</span>(pr)prlevel=1</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;   gnorm  =0.0_wp</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;   depred =0.0_wp</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;   echng  =0.0_wp</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;   maxd   =maxdispl</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;   first  =.<a class="code" href="symmetry__i_8c.html#aa77c823a9fc018ae1d437369708d8727">true</a>.</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;   acc    =acc_in</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;   energy = etot</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;   e_in   = etot</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;   alp    =1.0_wp</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;   converged = .false.</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160; </div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;   nvar1  = anc%nvar+1         <span class="comment">! dimension of RF calculation</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;   npvar  = anc%nvar*(nvar1)/2 <span class="comment">! packed size of Hessian (note the abuse of nvar1!)</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;   npvar1 = nvar1*(nvar1+1)/2  <span class="comment">! packed size of augmented Hessian</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;   <span class="keyword">allocate</span>(uaug(nvar1,1),eaug(nvar1),aaug(npvar1))</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160; </div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="comment">!! ========================================================================</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;   main_loop: <span class="keywordflow">do</span> ii=1,maxcycle</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="comment">!! ========================================================================</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;   iter=iter+1</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;   <span class="keywordflow">if</span>(pr) &amp;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;   <span class="keyword">write</span>(env%unit,<span class="stringliteral">&#39;(/,72(&quot;.&quot;),/,30(&quot;.&quot;),&quot; CYCLE&quot;,i5,1x,30(&quot;.&quot;),/,72(&quot;.&quot;))&#39;</span>)iter</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160; </div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;   gold = gint</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;   gnold= gnorm</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;   eold = energy</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="comment">!  calc predicted energy change based on E = E0 + delta * G + delta^2 * H</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;   <span class="keywordflow">if</span> (ii &gt; 1) &amp;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;   <span class="keyword">call </span>prdechng(anc%nvar,gold,displ,anc%hess,depred)</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="comment">!  get gradient</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;   <span class="keywordflow">if</span> (profile) <span class="keyword">call </span><a class="code" href="namespacextb__type__timer.html#a1dcf014087e66f68529af68ba3ab41b0">timer</a>%measure(4,<span class="stringliteral">&#39;coordinate transformation&#39;</span>)</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;   <span class="keyword">call </span>anc%get_cartesian(mol%xyz)</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;   <span class="keywordflow">if</span> (profile) <span class="keyword">call </span><a class="code" href="namespacextb__type__timer.html#a1dcf014087e66f68529af68ba3ab41b0">timer</a>%measure(4)</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;   <span class="keywordflow">if</span> (profile) <span class="keyword">call </span><a class="code" href="namespacextb__type__timer.html#a1dcf014087e66f68529af68ba3ab41b0">timer</a>%measure(5,<span class="stringliteral">&#39;single point calculation&#39;</span>)</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;   g = 0.0_wp</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;   <span class="keyword">call </span><a class="code" href="interfacextb__type__calculator_1_1singlepoint.html">singlepoint</a> &amp;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;         (env,mol,<a class="code" href="neighbor_8f90.html#a5df91039130b0032e4f6ce1853b1af8a">chk</a>,calc, &amp;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;          egap,et,maxiter,prlevel,iter.eq.1,.<a class="code" href="symmetry__i_8c.html#aa77c823a9fc018ae1d437369708d8727">true</a>.,acc,energy,g,sigma,res)</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;   <span class="keywordflow">if</span> (profile) <span class="keyword">call </span><a class="code" href="namespacextb__type__timer.html#a1dcf014087e66f68529af68ba3ab41b0">timer</a>%measure(5)</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160; </div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;   <span class="comment">! something went wrong in SCC or diag</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;   <span class="keyword">call </span>env%check(fail)</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;   <span class="keywordflow">if</span> (fail) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;      <span class="keyword">call </span>env%error(<span class="stringliteral">&#39;SCF not converged, aborting...&#39;</span>, source)</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;      <span class="keywordflow">return</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;   <span class="keywordflow">if</span> (energy.gt.1.d42) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;      <span class="keyword">call </span>env%error(<span class="stringliteral">&#39;energy is bogus! aborting...&#39;</span>, source)</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;      fail=.<a class="code" href="symmetry__i_8c.html#aa77c823a9fc018ae1d437369708d8727">true</a>.</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;      <span class="keywordflow">return</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;   <span class="keywordflow">if</span> (profile) <span class="keyword">call </span><a class="code" href="namespacextb__type__timer.html#a1dcf014087e66f68529af68ba3ab41b0">timer</a>%measure(6,<span class="stringliteral">&#39;optimization log&#39;</span>)</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;   <span class="keyword">call </span>writemolecule(mol, ilog, format=filetype%xyz, energy=res%e_total, &amp;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;      &amp; gnorm=res%gnorm)</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;   <span class="keywordflow">if</span> (profile) <span class="keyword">call </span><a class="code" href="namespacextb__type__timer.html#a1dcf014087e66f68529af68ba3ab41b0">timer</a>%measure(6)</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="comment">! transform xyz to internal gradient</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;   <span class="keywordflow">if</span> (profile) <span class="keyword">call </span><a class="code" href="namespacextb__type__timer.html#a1dcf014087e66f68529af68ba3ab41b0">timer</a>%measure(4)</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;   <span class="keyword">call </span>dgemv(<span class="stringliteral">&#39;t&#39;</span>,anc%n3,anc%nvar,1.0_wp,anc%B,anc%n3,g,1,0.0_wp,gint,1)</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;   <span class="keywordflow">if</span> (profile) <span class="keyword">call </span><a class="code" href="namespacextb__type__timer.html#a1dcf014087e66f68529af68ba3ab41b0">timer</a>%measure(4)</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;   gnorm = norm2(gint)</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160; </div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;   <span class="keywordflow">if</span>(gnorm.gt.500.) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;      <span class="keyword">call </span>env%error(<span class="stringliteral">&#39;|grad| &gt; 500, something is totally wrong!&#39;</span>, source)</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;      fail=.<a class="code" href="symmetry__i_8c.html#aa77c823a9fc018ae1d437369708d8727">true</a>.</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;      <span class="keywordflow">return</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160; </div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;   <span class="keywordflow">if</span> (<span class="keyword">present</span>(avconv)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;      <span class="keyword">call </span>avconv%set_eg_log(energy, gnorm)</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;      energy = avconv%get_averaged_energy()</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;      gnorm = avconv%get_averaged_gradient()</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;      <span class="keywordflow">if</span> (pr) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;         <span class="keyword">write</span>(env%unit,<span class="stringliteral">&#39;(&quot;av. E:&quot;,1x,f14.7,1x,&quot;-&gt;&quot;,1x,f14.7)&#39;</span>) &amp;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;            avconv%elog(avconv%nlog), energy</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;         <span class="keyword">write</span>(env%unit,<span class="stringliteral">&#39;(&quot;av. G:&quot;,1x,f14.7,1x,&quot;-&gt;&quot;,1x,f14.7)&#39;</span>) &amp;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;            avconv%glog(avconv%nlog), gnorm</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="keywordflow">   end if</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160; </div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="comment">! adapt SCC acuracy</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;   <span class="keywordflow">if</span>(gnorm    .lt.0.004)<span class="keywordflow">then</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;      acc=acc_in</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;   <span class="keywordflow">elseif</span>(gnorm.lt.0.02)<span class="keywordflow">then</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;      acc=3.0d0*acc_in</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;   <span class="keywordflow">elseif</span>(gnorm.gt.0.02)<span class="keywordflow">then</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;      acc=6.0d0*acc_in</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160; </div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;   first =.false.</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160; </div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;   gchng = gnorm -gnold</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;   echng = energy-eold</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160; </div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;   <span class="comment">! check for convergence</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;   econverged = abs(echng).lt.ethr</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;   gconverged = gnorm.lt.gthr</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;   lowered    = echng.lt.0.0_wp</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160; </div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;   <span class="keywordflow">if</span>(pr) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;      <span class="comment">!write(env%unit,&#39;(&quot; E :&quot;,F16.8,2x,&quot;G :&quot;,F10.6,4x,&quot;pred/act E change:&quot;,2D11.3)&#39;)&amp;</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;      <span class="comment">!energy,gnorm,depred,echng</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      <span class="keyword">write</span>(env%unit,<span class="stringliteral">&#39;(&quot; * total energy  :&quot;,f14.7,1x,&quot;Eh&quot;)&#39;</span>,advance=<span class="stringliteral">&#39;no&#39;</span>)   energy</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;      <span class="keyword">write</span>(env%unit,<span class="stringliteral">&#39;(5x,&quot;change   &quot;,e18.7,1x,&quot;Eh&quot;)&#39;</span>)                      echng</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;      <span class="keyword">write</span>(env%unit,Î±<span class="stringliteral">&#39;(3x,&quot;gradient norm :&quot;,f14.7,1x,&quot;Eh/&quot;)&#39;</span>,advance=<span class="stringliteral">&#39;no&#39;</span>) gnorm</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;      <span class="keyword">write</span>(env%unit,<span class="stringliteral">&#39;(3x,&quot;predicted&quot;,e18.7)&#39;</span>,advance=<span class="stringliteral">&#39;no&#39;</span>)                 depred</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;      <span class="keyword">write</span>(env%unit,<span class="stringliteral">&#39;(1x,&quot;(&quot;f7.2&quot;%)&quot;)&#39;</span>)         (depred-echng)/echng*100</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;   <span class="keywordflow">if</span> ( energy .eq. 0 ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;      <span class="keyword">call </span>env%error(<span class="stringliteral">&#39;external program error&#39;</span>, source)</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;      <span class="keywordflow">return</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="keywordflow">   end if</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160; </div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;   <span class="keywordflow">if</span>(ii.eq.1) estart=energy</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160; </div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;   <span class="keywordflow">if</span>(gnorm.lt.0.002)<span class="keywordflow">then</span>  <span class="comment">! 0.002</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;      alp = 1.5d0       <span class="comment">! 1.5</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;   <span class="keywordflow">elseif</span>(gnorm.lt.0.0006)<span class="keywordflow">then</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;      alp = 2.0d0       <span class="comment">! 2</span></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;   <span class="keywordflow">elseif</span>(gnorm.lt.0.0003)<span class="keywordflow">then</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;      alp = 3.0d0       <span class="comment">! 3</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;      alp = 1.0d0</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160; </div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="comment">!! ------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;<span class="comment">!  Update the hessian</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="comment">!! ------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160; </div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;   <span class="keywordflow">if</span> (profile) <span class="keyword">call </span><a class="code" href="namespacextb__type__timer.html#a1dcf014087e66f68529af68ba3ab41b0">timer</a>%measure(7,<span class="stringliteral">&#39;hessian update&#39;</span>)</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;   <span class="keywordflow">if</span>(ii.gt.1)<span class="keywordflow">then</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="comment">! hessian update</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;      <span class="keywordflow">if</span>(iupdat.eq.0)<span class="keywordflow">then</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;      <span class="keyword">call </span>bfgs  (anc%nvar,gnorm,gint,gold,displ,anc%hess)</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;      <span class="keyword">call </span>powell(anc%nvar,gnorm,gint,gold,displ,anc%hess)</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;   <span class="keywordflow">if</span> (profile) <span class="keyword">call </span><a class="code" href="namespacextb__type__timer.html#a1dcf014087e66f68529af68ba3ab41b0">timer</a>%measure(7)</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160; </div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;<span class="comment">! ------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;<span class="comment">!  the following lines define the rational function (RF) method</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="comment">! ------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;   <span class="keywordflow">if</span> (profile) <span class="keyword">call </span><a class="code" href="namespacextb__type__timer.html#a1dcf014087e66f68529af68ba3ab41b0">timer</a>%measure(8,<span class="stringliteral">&quot;rational function&quot;</span>)</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="comment">!  funny that implementing a RF algorithm takes 5 lines when done right... SAW</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="comment">!  As it is now condensed down to a few lines, I feel the urge to explain</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="comment">!  how the calculation is actually done. We solve this:</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="comment">!   â H  g â â dx â     â dx â</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="comment">!   â g  0 â  â  1 â  = Î» â  1 â </span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="comment">!  first augment hessian by gradient, we keep everything nicely packed, no blowup</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;   aaug(1:npvar)          = anc%hess</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;   aaug(npvar+1:npvar1-1) = gint</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;   aaug(npvar1)           = 0.0_sp</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="comment">!  chose your favourite solver</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;   <span class="keywordflow">if</span> (exact .or. nvar1.lt.50) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;      <span class="keyword">call </span>solver_sspevx(nvar1,r4dum,aaug,uaug,eaug,fail)</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;      <span class="comment">! steepest decent guess for displacement</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;      <span class="keywordflow">if</span> (ii.eq.1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;         uaug(:,1)=[-real(gint(1:anc%nvar),sp),1.0_sp]</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;         dsnrm = sqrt(sdot(nvar1,uaug,1,uaug,1))</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;         uaug  = uaug/dsnrm</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;      <span class="keyword">call </span>solver_sdavidson(nvar1,r4dum,aaug,uaug,eaug,fail,.false.)</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;      <span class="keywordflow">if</span> (fail) &amp; <span class="comment">! retry with better solver</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;      <span class="keyword">call </span>solver_sspevx(nvar1,r4dum,aaug,uaug,eaug,fail)</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;<span class="comment">!  divide by last element to get the displacement vector</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;   <span class="keywordflow">if</span> (fail .or. abs(uaug(nvar1,1)).lt.1.e-10) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;      <span class="keyword">call </span>env%error(<span class="stringliteral">&quot;internal rational function error&quot;</span>, source)</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;      <span class="keywordflow">return</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;<span class="keywordflow">   end if</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;   displ(1:anc%nvar) = uaug(1:anc%nvar,1)/uaug(nvar1,1)</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;<span class="comment">!  check if step is too large, just cut off everything thats to large</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;   <span class="keywordflow">do</span> j=1,anc%nvar</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;      <span class="keywordflow">if</span>(abs(displ(j)).gt.maxd) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;         <span class="keywordflow">if</span>(displ(j) &lt; 0) displ(j)=-maxd</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;         <span class="keywordflow">if</span>(displ(j) &gt; 0) displ(j)= maxd</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;<span class="comment">!  now some output</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;   dsnrm=sqrt(ddot(anc%nvar,displ,1,displ,1))</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;   <span class="keywordflow">if</span>(pr)<span class="keywordflow">then</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;      <span class="comment">! this array is currently not used and will be overwritten in next step</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;      gold = abs(displ)</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;      imax(1) = maxloc(gold,1); gold(imax(1)) = 0.0_wp</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;      imax(2) = maxloc(gold,1); gold(imax(2)) = 0.0_wp</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;      imax(3) = maxloc(gold,1)</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;      <span class="keyword">write</span>(env%unit,Î±<span class="stringliteral">&#39;(3x,&quot;displ. norm   :&quot;,f14.7,1x,&quot;&quot;)&#39;</span>,advance=<span class="stringliteral">&#39;no&#39;</span>) &amp;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;         dsnrm*alp</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;      <span class="keyword">write</span>(env%unit,<span class="stringliteral">&#39;(6x,&quot;lambda   &quot;,e18.7)&#39;</span>) eaug(1)</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;      <span class="keyword">write</span>(env%unit,Î±<span class="stringliteral">&#39;(3x,&quot;maximum displ.:&quot;,f14.7,1x,&quot;&quot;)&#39;</span>,advance=<span class="stringliteral">&#39;no&#39;</span>) &amp;</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;         abs(displ(imax(1)))*alp</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;      <span class="keyword">write</span>(env%unit,<span class="stringliteral">&#39;(6x,&quot;in ANC&#39;</span><span class="stringliteral">&#39;s &quot;,3(&quot;#&quot;,i0,&quot;, &quot;),&quot;...&quot;)&#39;</span>) imax</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;      <span class="comment">!call prdispl(anc%nvar,displ)</span></div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;   <span class="keywordflow">if</span> (profile) <span class="keyword">call </span><a class="code" href="namespacextb__type__timer.html#a1dcf014087e66f68529af68ba3ab41b0">timer</a>%measure(8)</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;<span class="comment">! ------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160; </div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;<span class="comment">!  2nd: exit and redo hessian (internal restart)</span></div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;   <span class="keywordflow">if</span>(ii.gt.2.and.dsnrm.gt.2.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;      <span class="keywordflow">if</span> (pr) <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;exit because of too large step&#39;</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;      <span class="keywordflow">exit</span> main_loop</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160; </div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;<span class="comment">!  new coordinates</span></div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;   anc%coord = anc%coord + displ * alp</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160; </div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="comment">! conv ?</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;   <span class="keywordflow">if</span>(abs(echng).lt.ethr.and.gnorm.lt.gthr.and.echng.lt.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;      restart=.false.</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;      converged = .<a class="code" href="symmetry__i_8c.html#aa77c823a9fc018ae1d437369708d8727">true</a>.</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;      etot=energy</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      <span class="keywordflow">return</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160; </div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;<span class="comment">!! ========================================================================</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="keywordflow">   enddo</span> main_loop</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;<span class="comment">!! ========================================================================</span></div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(uaug))  <span class="keyword">deallocate</span>(uaug)</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(eaug))  <span class="keyword">deallocate</span>(eaug)</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(aaug))  <span class="keyword">deallocate</span>(aaug)</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160; </div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;   restart=.<a class="code" href="symmetry__i_8c.html#aa77c823a9fc018ae1d437369708d8727">true</a>.</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;   etot=energy</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;   <span class="keyword">call </span>anc%get_cartesian(mol%xyz)</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="bfgs_8f90_source.html#l00021">xtb_bfgs::bfgs()</a>, <a class="el" href="filetypes_8f90_source.html#l00065">xtb_mctc_filetypes::filetype</a>, <a class="el" href="bfgs_8f90_source.html#l00106">xtb_bfgs::powell()</a>, <a class="el" href="optimizer_8f90_source.html#l00859">prdechng()</a>, <a class="el" href="optimizer_8f90_source.html#l00027">profile</a>, <a class="el" href="david2_8f90_source.html#l00222">xtb_david2::solver_sdavidson()</a>, <a class="el" href="optimizer_8f90_source.html#l00775">solver_sspevx()</a>, <a class="el" href="symmetry__i_8c_source.html#l00132">true()</a>, and <a class="el" href="writer_8f90_source.html#l00041">xtb_io_writer::writemolecule()</a>.</p>

<p class="reference">Referenced by <a class="el" href="optimizer_8f90_source.html#l00110">ancopt()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacextb__optimizer_a0ae8aa844914d8a5dfd34b5a91faaf32_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacextb__optimizer_a0ae8aa844914d8a5dfd34b5a91faaf32_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a5867ec28107670e95b06ff7b4baaf300"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5867ec28107670e95b06ff7b4baaf300">&#9670;&nbsp;</a></span>set_eg_log()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pure subroutine xtb_optimizer::set_eg_log </td>
          <td>(</td>
          <td class="paramtype">class(<a class="el" href="structxtb__optimizer_1_1convergence__log.html">convergence_log</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp), intent(in)&#160;</td>
          <td class="paramname"><em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp), intent(in)&#160;</td>
          <td class="paramname"><em>g</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="optimizer_8f90_source.html#l01293">1293</a> of file <a class="el" href="optimizer_8f90_source.html">optimizer.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__mctc__resize.html">xtb_mctc_resize</a>, <span class="keywordtype">only</span> : <a class="code" href="interfacextb__mctc__resize_1_1resize.html">resize</a></div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;   <span class="keywordtype">class</span>(convergence_log), <span class="keywordtype">intent(inout)</span> :: self</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;<span class="keywordtype">   real</span>(wp), <span class="keywordtype">intent(in)</span> :: e, g</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;   <span class="keywordflow">if</span> (self%nlog &gt;= <span class="keyword">size</span>(self%elog)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;      <span class="keyword">call </span><a class="code" href="interfacextb__mctc__resize_1_1resize.html">resize</a>(self%elog, <span class="keyword">size</span>(self%elog)+<span class="keyword">size</span>(self%elog)/2+1)</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;      <span class="keyword">call </span><a class="code" href="interfacextb__mctc__resize_1_1resize.html">resize</a>(self%glog, <span class="keyword">size</span>(self%glog)+<span class="keyword">size</span>(self%glog)/2+1)</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;<span class="keywordflow">   end if</span></div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;   self%nlog = self%nlog + 1</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;   self%elog(self%nlog) = e</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;   self%glog(self%nlog) = g</div>
</div><!-- fragment -->
</div>
</div>
<a id="ac6dbeb7fcdaa9630e9042c20479010d9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac6dbeb7fcdaa9630e9042c20479010d9">&#9670;&nbsp;</a></span>solver_sspevx()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pure subroutine xtb_optimizer::solver_sspevx </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(sp), intent(in)&#160;</td>
          <td class="paramname"><em>thr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(sp), dimension(:), intent(inout)&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(sp), dimension(:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>U</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(sp), dimension(:), intent(inout)&#160;</td>
          <td class="paramname"><em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(out)&#160;</td>
          <td class="paramname"><em>fail</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="optimizer_8f90_source.html#l00774">774</a> of file <a class="el" href="optimizer_8f90_source.html">optimizer.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__mctc__lapack.html">xtb_mctc_lapack</a>, <span class="keywordtype">only</span> : lapack_spevx</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;   <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>    :: n</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;<span class="keywordtype">   real</span>(sp),<span class="keywordtype">intent(in)</span>    :: thr</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;<span class="keywordtype">   real</span>(sp),<span class="keywordtype">intent(inout)</span> :: A(:)</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;<span class="keywordtype">   real</span>(sp),<span class="keywordtype">intent(inout)</span> :: U(:,:)</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;<span class="keywordtype">   real</span>(sp),<span class="keywordtype">intent(inout)</span> :: e(:)</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;   <span class="keywordtype">logical</span>, <span class="keywordtype">intent(out)</span>   :: fail</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160; </div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;   <span class="keywordtype">integer</span> :: i,j,k</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;   <span class="keywordtype">integer</span> :: info</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;<span class="keywordtype">   real</span>(sp),<span class="keywordtype">allocatable</span> :: work(:)</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">allocatable</span> :: iwork(:)</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">allocatable</span> :: ifail(:)</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;<span class="keywordtype">   real</span>(sp) :: dum</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160; </div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;   <span class="keyword">allocate</span>(iwork(5*n),work(8*n),ifail(n))</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160; </div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;   j=1</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;   <span class="keyword">call </span>lapack_spevx(<span class="stringliteral">&#39;V&#39;</span>,<span class="stringliteral">&#39;I&#39;</span>,<span class="stringliteral">&#39;U&#39;</span>,n,a,dum,dum,j,j,thr,i,e,u,n,work,iwork,ifail,info)</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;   <span class="keywordflow">if</span> (info.ne.0) fail = .<a class="code" href="symmetry__i_8c.html#aa77c823a9fc018ae1d437369708d8727">true</a>.</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160; </div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;   <span class="keyword">deallocate</span>(iwork,work,ifail)</div>
<div class="ttc" id="anamespacextb__mctc__lapack_html"><div class="ttname"><a href="namespacextb__mctc__lapack.html">xtb_mctc_lapack</a></div><div class="ttdoc">Interfaces to LAPACK.</div><div class="ttdef"><b>Definition:</b> <a href="lapack_8f90_source.html#l00019">lapack.f90:19</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="symmetry__i_8c_source.html#l00132">true()</a>.</p>

<p class="reference">Referenced by <a class="el" href="optimizer_8f90_source.html#l00458">relax()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacextb__optimizer_ac6dbeb7fcdaa9630e9042c20479010d9_cgraph.svg" width="242" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacextb__optimizer_ac6dbeb7fcdaa9630e9042c20479010d9_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a2ac82175dfc1e58dcde2f5ae0cf4ed2d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2ac82175dfc1e58dcde2f5ae0cf4ed2d">&#9670;&nbsp;</a></span>solver_ssyevx()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pure subroutine xtb_optimizer::solver_ssyevx </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(sp), intent(in)&#160;</td>
          <td class="paramname"><em>thr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(sp), dimension(:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(sp), dimension(:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>U</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(sp), dimension(:), intent(inout)&#160;</td>
          <td class="paramname"><em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(out)&#160;</td>
          <td class="paramname"><em>fail</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="optimizer_8f90_source.html#l00746">746</a> of file <a class="el" href="optimizer_8f90_source.html">optimizer.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__mctc__lapack.html">xtb_mctc_lapack</a>, <span class="keywordtype">only</span> : lapack_syevx</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;   <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>    :: n</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;<span class="keywordtype">   real</span>(sp),<span class="keywordtype">intent(in)</span>    :: thr</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;<span class="keywordtype">   real</span>(sp),<span class="keywordtype">intent(inout)</span> :: A(:,:)</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;<span class="keywordtype">   real</span>(sp),<span class="keywordtype">intent(inout)</span> :: U(:,:)</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;<span class="keywordtype">   real</span>(sp),<span class="keywordtype">intent(inout)</span> :: e(:)</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;   <span class="keywordtype">logical</span>, <span class="keywordtype">intent(out)</span>   :: fail</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160; </div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;   <span class="keywordtype">integer</span> :: i,j,k</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;   <span class="keywordtype">integer</span> :: lwork,info</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;<span class="keywordtype">   real</span>(sp),<span class="keywordtype">allocatable</span> :: work(:)</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">allocatable</span> :: iwork(:)</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">allocatable</span> :: ifail(:)</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="keywordtype">   real</span>(sp) :: dum</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160; </div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;   lwork = 1+8*n+n**2</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;   <span class="keyword">allocate</span>(iwork(5*n),work(lwork),ifail(n))</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160; </div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;   j=1</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;   <span class="keyword">call </span>lapack_syevx(<span class="stringliteral">&#39;V&#39;</span>,<span class="stringliteral">&#39;I&#39;</span>,<span class="stringliteral">&#39;U&#39;</span>,n,a,n,dum,dum,j,j,thr, &amp;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;   &amp;           i,e,u,n,work,lwork,iwork,ifail,info)</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;   <span class="keywordflow">if</span> (info.ne.0) fail = .<a class="code" href="symmetry__i_8c.html#aa77c823a9fc018ae1d437369708d8727">true</a>.</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160; </div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;   <span class="keyword">deallocate</span>(iwork,work,ifail)</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="symmetry__i_8c_source.html#l00132">true()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacextb__optimizer_a2ac82175dfc1e58dcde2f5ae0cf4ed2d_cgraph.svg" width="242" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="aa550726c73111ebcaad1877c07586771"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa550726c73111ebcaad1877c07586771">&#9670;&nbsp;</a></span>sort()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine xtb_optimizer::sort </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nat3</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nvar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp), dimension(nvar*(nvar+1)/2), intent(inout)&#160;</td>
          <td class="paramname"><em>hess</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp), dimension(nat3,nat3), intent(inout)&#160;</td>
          <td class="paramname"><em>b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="optimizer_8f90_source.html#l00818">818</a> of file <a class="el" href="optimizer_8f90_source.html">optimizer.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;   <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: nat3</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: nvar</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(inout)</span> :: hess(nvar*(nvar+1)/2)</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(inout)</span> :: b(nat3,nat3)</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">allocatable</span> :: edum(:)</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;<span class="keywordtype">   real</span>(wp) :: pp,sc1</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;   <span class="keywordtype">integer</span>  :: ii,k,j,m,i</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;   <span class="keyword">allocate</span>( edum(nvar), source = 0.0_wp )</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160; </div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;   <span class="keywordflow">do</span> k=1,nvar</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;      edum(k)=hess(k+k*(k-1)/2)</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;<span class="comment">! sort</span></div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;   <span class="keywordflow">do</span> ii = 2, nvar</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;      i = ii - 1</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;      k = i</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;      pp= edum(i)</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;      <span class="keywordflow">do</span> j = ii, nvar</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;         <span class="keywordflow">if</span> (edum(j) .gt. pp) cycle</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;         k = j</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;         pp= edum(j)</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;      <span class="keywordflow">if</span> (k .eq. i) cycle</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;      edum(k) = edum(i)</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;      edum(i) = pp</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;      <span class="keywordflow">do</span> m=1,nat3</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;         sc1=b(m,i)</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;         b(m,i)=b(m,k)</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;         b(m,k)=sc1</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160; </div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;   <span class="keywordflow">do</span> k=1,nvar</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;      hess(k+k*(k-1)/2)=edum(k)</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="src_2relaxation__engine_8f90_source.html#l00384">xtb_relaxation_engine::l_ancopt()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacextb__optimizer_aa550726c73111ebcaad1877c07586771_icgraph.svg" width="100%" height="568"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a18c51670400f13cceb6241536779318b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a18c51670400f13cceb6241536779318b">&#9670;&nbsp;</a></span>tokenize_cycle()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">logical function xtb_optimizer::tokenize_cycle </td>
          <td>(</td>
          <td class="paramtype">character(<a class="el" href="interfacextb__type__buffer_1_1len.html">len</a>=*), intent(in)&#160;</td>
          <td class="paramname"><em>line</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp), intent(out)&#160;</td>
          <td class="paramname"><em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp), intent(out)&#160;</td>
          <td class="paramname"><em>g</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="optimizer_8f90_source.html#l01233">1233</a> of file <a class="el" href="optimizer_8f90_source.html">optimizer.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;   <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(in)</span> :: line</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;<span class="keywordtype">   real</span>(wp), <span class="keywordtype">intent(out)</span> :: e</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;<span class="keywordtype">   real</span>(wp), <span class="keywordtype">intent(out)</span> :: g</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;   <span class="keywordtype">logical</span> :: stat</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;   <span class="keywordtype">integer</span> :: stat1, stat2</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;   <span class="keyword">read</span>(line(33:51), *, iostat=stat1) e</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;   <span class="keyword">read</span>(line(66:), *, iostat=stat2) g</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;   stat = stat1 == 0 .and. stat2 == 0</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="optimizer_8f90_source.html#l01194">load_turbomole_log()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacextb__optimizer_a18c51670400f13cceb6241536779318b_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a9e82f5562bec14f4a2b3dbd9bb5c804d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9e82f5562bec14f4a2b3dbd9bb5c804d">&#9670;&nbsp;</a></span>trfp2xyz()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine xtb_optimizer::trfp2xyz </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nvar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nat3</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp), dimension(nvar), intent(in)&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp), dimension(3,nat3/3), intent(in)&#160;</td>
          <td class="paramname"><em>xyz0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp), dimension(nat3,nat3), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(wp), dimension(3,nat3/3), intent(out)&#160;</td>
          <td class="paramname"><em>dspl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="optimizer_8f90_source.html#l00906">906</a> of file <a class="el" href="optimizer_8f90_source.html">optimizer.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__symparam.html">xtb_symparam</a></div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;   <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: nat3</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: nvar</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;   <span class="keywordtype">integer</span> :: nat,icount,i,j,k</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(in)</span>  :: xyz0(3,nat3/3)</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(out)</span> :: dspl(3,nat3/3)</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(in)</span>  :: h(nat3,nat3)</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(in)</span>  :: p(nvar)</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;<span class="keywordtype">   real</span>(wp) :: dum</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160; </div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;   dspl = 0.0d0</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;   nat=nat3/3</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160; </div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;<span class="comment">! generate cartesian displacement vector</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;   <span class="keywordflow">do</span> i=1,nvar</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;      icount=0</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;      <span class="keywordflow">do</span> j=1,nat</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;         <span class="keywordflow">do</span> k=1,3</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;            icount=icount+1</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;            dum=h(icount,i)*p(i)</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;            dspl(k,j)=dspl(k,j)+dum</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="keywordflow">         enddo</span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160; </div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;<span class="comment">!     do i=1,nat</span></div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;<span class="comment">!        write(*,*) dspl(1:3,i)</span></div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;<span class="comment">!     enddo</span></div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160; </div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;<span class="comment">! symmetrize displ</span></div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;   <span class="keywordflow">if</span>(<a class="code" href="namespacextb__symparam.html#af10f1578755ebdd6a2c86a02e54f20d5">ntrans</a>.gt.1) <span class="keyword">call </span><a class="code" href="symtranslib_8f90.html#a635f67c83397bde7a72cb29543f6c9ef">grdsym</a>(dspl,nat)</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160; </div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;<span class="comment">!     write(*,*) ntrans</span></div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;<span class="comment">!     do i=1,nat</span></div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;<span class="comment">!        write(*,*) dspl(1:3,i)</span></div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;<span class="comment">!     enddo</span></div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160; </div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;   dspl=dspl + xyz0</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160; </div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;   <span class="keywordflow">return</span></div>
<div class="ttc" id="anamespacextb__symparam_html"><div class="ttname"><a href="namespacextb__symparam.html">xtb_symparam</a></div><div class="ttdef"><b>Definition:</b> <a href="symparam_8f90_source.html#l00018">symparam.f90:18</a></div></div>
<div class="ttc" id="anamespacextb__symparam_html_af10f1578755ebdd6a2c86a02e54f20d5"><div class="ttname"><a href="namespacextb__symparam.html#af10f1578755ebdd6a2c86a02e54f20d5">xtb_symparam::ntrans</a></div><div class="ttdeci">integer ntrans</div><div class="ttdef"><b>Definition:</b> <a href="symparam_8f90_source.html#l00024">symparam.f90:24</a></div></div>
<div class="ttc" id="asymtranslib_8f90_html_a635f67c83397bde7a72cb29543f6c9ef"><div class="ttname"><a href="symtranslib_8f90.html#a635f67c83397bde7a72cb29543f6c9ef">grdsym</a></div><div class="ttdeci">subroutine grdsym(grd, natoms)</div><div class="ttdef"><b>Definition:</b> <a href="symtranslib_8f90_source.html#l00660">symtranslib.f90:661</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="symtranslib_8f90_source.html#l00661">grdsym()</a>, and <a class="el" href="symparam_8f90_source.html#l00024">xtb_symparam::ntrans</a>.</p>

<p class="reference">Referenced by <a class="el" href="src_2relaxation__engine_8f90_source.html#l00840">xtb_relaxation_engine::lbfgs_relax()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacextb__optimizer_a9e82f5562bec14f4a2b3dbd9bb5c804d_cgraph.svg" width="374" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacextb__optimizer_a9e82f5562bec14f4a2b3dbd9bb5c804d_icgraph.svg" width="100%" height="568"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="af6d551356c63a70e8a29e322174fe053"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af6d551356c63a70e8a29e322174fe053">&#9670;&nbsp;</a></span>profile</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">logical, parameter, private xtb_optimizer::profile = .true.</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="optimizer_8f90_source.html#l00027">27</a> of file <a class="el" href="optimizer_8f90_source.html">optimizer.f90</a>.</p>
<div class="fragment"><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;   <span class="keywordtype">logical</span>,<span class="keywordtype">private</span>,<span class="keywordtype">parameter</span> :: profile = .<a class="code" href="symmetry__i_8c.html#aa77c823a9fc018ae1d437369708d8727">true</a>.</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="optimizer_8f90_source.html#l00110">ancopt()</a>, <a class="el" href="src_2relaxation__engine_8f90_source.html#l00134">xtb_relaxation_engine::fire()</a>, <a class="el" href="src_2relaxation__engine_8f90_source.html#l00384">xtb_relaxation_engine::l_ancopt()</a>, <a class="el" href="src_2relaxation__engine_8f90_source.html#l00840">xtb_relaxation_engine::lbfgs_relax()</a>, and <a class="el" href="optimizer_8f90_source.html#l00458">relax()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Feb 7 2021 16:34:46 for My Project by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
