<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: src/scc_core.f90 Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Types&#160;List</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">scc_core.f90</div>  </div>
</div><!--header-->
<div class="contents">
<a href="scc__core_8f90.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">! This file is part of xtb.</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">!</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">! Copyright (C) 2017-2020 Stefan Grimme</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">!</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">! xtb is free software: you can redistribute it and/or modify it under</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">! the terms of the GNU Lesser General Public License as published by</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">! the Free Software Foundation, either version 3 of the License, or</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">! (at your option) any later version.</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">!</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">! xtb is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">! but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">! MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">! GNU Lesser General Public License for more details.</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">!</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">! You should have received a copy of the GNU Lesser General Public License</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">! along with xtb.  If not, see &lt;https://www.gnu.org/licenses/&gt;.</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160; </div>
<div class="line"><a name="l00019"></a><span class="lineno"><a class="line" href="namespacextb__scc__core.html">   19</a></span>&#160;<span class="keyword">module</span> <a class="code" href="namespacextb__scc__core.html">xtb_scc_core</a></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__mctc__accuracy.html">xtb_mctc_accuracy</a>, <span class="keywordtype">only</span> : <a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__mctc__la.html">xtb_mctc_la</a>, <span class="keywordtype">only</span> : contract</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__mctc__lapack.html">xtb_mctc_lapack</a>, <span class="keywordtype">only</span> : lapack_sygvd</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__mctc__blas.html">xtb_mctc_blas</a>, <span class="keywordtype">only</span> : blas_gemm, mctc_symv, mctc_gemm</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__mctc__lapack__eigensolve.html">xtb_mctc_lapack_eigensolve</a>, <span class="keywordtype">only</span> : <a class="code" href="structxtb__mctc__lapack__eigensolve_1_1teigensolver.html">teigensolver</a></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__type__environment.html">xtb_type_environment</a>, <span class="keywordtype">only</span> : <a class="code" href="structxtb__type__environment_1_1tenvironment.html">tenvironment</a></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__type__solvation.html">xtb_type_solvation</a>, <span class="keywordtype">only</span> : <a class="code" href="structxtb__type__solvation_1_1tsolvation.html">tsolvation</a></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__xtb__data.html">xtb_xtb_data</a></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__xtb__coulomb.html">xtb_xtb_coulomb</a></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__xtb__dispersion.html">xtb_xtb_dispersion</a></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__xtb__multipole.html">xtb_xtb_multipole</a></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__broyden.html">xtb_broyden</a></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;   <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;   <span class="keywordtype">private</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160; </div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;   <span class="keywordtype">public</span> :: <a class="code" href="namespacextb__scc__core.html#a283a0b5552f059cc1b825cf6f29bc47b">build_h0</a>, <a class="code" href="namespacextb__scc__core.html#a3e0e142b640924088ca8b0ab266dd5e0">scc</a>, <a class="code" href="namespacextb__scc__core.html#a242df5f670f054274ad6af4fc5b68a7c">electro</a>, <a class="code" href="namespacextb__scc__core.html#a3a50c09ff46dca0182ee74b31c3d2980">solve</a>, <a class="code" href="namespacextb__scc__core.html#ac01c578b81a798d30846c16f0f35d699">solve4</a></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;   <span class="keywordtype">public</span> :: <a class="code" href="namespacextb__scc__core.html#a6464c6f815b95933767e307bbe7b34d1">fermismear</a>, <a class="code" href="namespacextb__scc__core.html#a3226bc1823e27aac5c97598c51086ea4">occ</a>, <a class="code" href="namespacextb__scc__core.html#aac06c643c8cf37ba0337ace78508ab19">occu</a>, <a class="code" href="namespacextb__scc__core.html#af5c3cd803d403c23fc0ae9c2eb1229c6">dmat</a></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;   <span class="keywordtype">public</span> :: <a class="code" href="namespacextb__scc__core.html#a2cc45bad34d8ad8fc414f3a2929c4d54">get_wiberg</a>, <a class="code" href="namespacextb__scc__core.html#a965fd5bf899e797e7b4cf266748f6701">mpopall</a>, <a class="code" href="namespacextb__scc__core.html#a134b152bc9c2f94b1260a248e8fb4a1f">mpop0</a>, <a class="code" href="namespacextb__scc__core.html#a321910253246c2a7505f7e1fcaeaa5bf">mpopao</a>, <a class="code" href="namespacextb__scc__core.html#a7b41a4ff7431082309e438ba754461f3">mpop</a>, <a class="code" href="namespacextb__scc__core.html#aef6343e2d48902c11b8a14602aec2971">mpopsh</a>, <a class="code" href="namespacextb__scc__core.html#a59b1e6be65cf0c0bf82cae50bf40000c">qsh2qat</a>, <a class="code" href="namespacextb__scc__core.html#af6e7712a4d49d56302e167ba6034da6f">lpop</a></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;   <span class="keywordtype">public</span> :: <a class="code" href="namespacextb__scc__core.html#ae6c9babc8cddf9d13539ebbab3a46d1c">iniqshell</a>, <a class="code" href="namespacextb__scc__core.html#a83c6524ce5e445bf77857b79c238a8ff">setzshell</a></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;   <span class="keywordtype">public</span> :: <a class="code" href="namespacextb__scc__core.html#ab589fe59f0960d1e9adf8ef9d48a6e45">shellpoly</a>, <a class="code" href="namespacextb__scc__core.html#a136cd39a28befead4338400b448fddc3">h0scal</a></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160; </div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160; </div>
<div class="line"><a name="l00042"></a><span class="lineno"><a class="line" href="namespacextb__scc__core.html#af36b4f9c033f8f02df6cf7ae6c4b4513">   42</a></span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">private</span>, <span class="keywordtype">parameter</span> :: <a class="code" href="namespacextb__scc__core.html#af36b4f9c033f8f02df6cf7ae6c4b4513">mmm</a>(20)=(/1,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4/)</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160; </div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160; </div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="keyword">contains</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160; </div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">!! ========================================================================</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">!  build GFN2 core Hamiltonian</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">!! ========================================================================</span></div>
<div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="namespacextb__scc__core.html#a283a0b5552f059cc1b825cf6f29bc47b">   50</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacextb__scc__core.html#a283a0b5552f059cc1b825cf6f29bc47b">build_h0</a>(hData,H0,n,at,ndim,nmat,matlist, &amp;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;   &amp;                xyz,selfEnergy,S,aoat2,lao2,valao2,aoexp,ao2sh)</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;   <span class="keywordtype">type</span>(<a class="code" href="structxtb__xtb__data_1_1thamiltoniandata.html">thamiltoniandata</a>), <span class="keywordtype">intent(in)</span> :: hdata</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(out)</span> :: h0(ndim*(ndim+1)/2)</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: n</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: at(n)</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: ndim</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: nmat</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: matlist(2,nmat)</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(in)</span>  :: xyz(3,n)</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(in)</span>  :: selfenergy(:)</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(in)</span>  :: s(ndim,ndim)</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: aoat2(ndim)</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: lao2(ndim)</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: valao2(ndim)</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: ao2sh(ndim)</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(in)</span>  :: aoexp(ndim)</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160; </div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;   <span class="keywordtype">integer</span>  :: i,j,k,m</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;   <span class="keywordtype">integer</span>  :: iat,jat,ish,jsh,il,jl,izp,jzp</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>) :: hdii,hdjj,hav</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>) :: km</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160; </div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;   h0=0.0_wp</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160; </div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;   <span class="keywordflow">do</span> m = 1, nmat</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;      i = matlist(1,m)</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;      j = matlist(2,m)</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;      k = j+i*(i-1)/2</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;      iat = aoat2(i)</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      jat = aoat2(j)</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;      ish = ao2sh(i)</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;      jsh = ao2sh(j)</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;      izp = at(iat)</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;      jzp = at(jat)</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;      il = <a class="code" href="namespacextb__scc__core.html#af36b4f9c033f8f02df6cf7ae6c4b4513">mmm</a>(lao2(i))</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;      jl = <a class="code" href="namespacextb__scc__core.html#af36b4f9c033f8f02df6cf7ae6c4b4513">mmm</a>(lao2(j))</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;      hdii = selfenergy(ish)</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;      hdjj = selfenergy(jsh)</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacextb__scc__core.html#a136cd39a28befead4338400b448fddc3">h0scal</a>(hdata,il,jl,izp,jzp,valao2(i).ne.0,valao2(j).ne.0, &amp;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;      &amp;           km)</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;      km = km*(2*sqrt(aoexp(i)*aoexp(j))/(aoexp(i)+aoexp(j)))**hdata%wExp</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      hav = 0.5d0*(hdii+hdjj)* &amp;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      &amp;      <a class="code" href="namespacextb__scc__core.html#ab589fe59f0960d1e9adf8ef9d48a6e45">shellpoly</a>(hdata%shellPoly(il, izp), hdata%shellPoly(jl, jzp), &amp;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;      &amp;                hdata%atomicRad(izp), hdata%atomicRad(jzp),xyz(:,iat),xyz(:,jat))</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;      h0(k) = s(j,i)*km*hav</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">!  diagonal</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;   k=0</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;   <span class="keywordflow">do</span> i=1,ndim</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      k=k+i</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;      iat = aoat2(i)</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;      ish = ao2sh(i)</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;      il = <a class="code" href="namespacextb__scc__core.html#af36b4f9c033f8f02df6cf7ae6c4b4513">mmm</a>(lao2(i))</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      h0(k) = selfenergy(ish)</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160; </div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacextb__scc__core.html#a283a0b5552f059cc1b825cf6f29bc47b">build_h0</a></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160; </div>
<div class="line"><a name="l00110"></a><span class="lineno"><a class="line" href="namespacextb__scc__core.html#a1214bb696e4b74ce8080805213d13adb">  110</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacextb__scc__core.html#a1214bb696e4b74ce8080805213d13adb">buildisotropich1</a>(n, at, ndim, nshell, nmat, matlist, H, &amp;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;      &amp; H0, S, shellShift, aoat2, ao2sh)</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__mctc__convert.html">xtb_mctc_convert</a>, <span class="keywordtype">only</span> : <a class="code" href="namespacextb__mctc__convert.html#a251a6230289b71aefe9a11d7df95213a">autoev</a>,<a class="code" href="namespacextb__mctc__convert.html#acdf2e027ee943efa9cc9a6b4701e3810">evtoau</a></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: n</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: at(n)</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: ndim</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: nshell</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: nmat</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: matlist(2,nmat)</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(in)</span>  :: H0(ndim*(1+ndim)/2)</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(in)</span>  :: S(ndim,ndim)</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(in)</span>  :: shellShift(nshell)</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: aoat2(ndim)</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: ao2sh(ndim)</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(out)</span> :: H(ndim,ndim)</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160; </div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;   <span class="keywordtype">integer</span>  :: m,i,j,k</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;   <span class="keywordtype">integer</span>  :: ishell,jshell</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;   <span class="keywordtype">integer</span>  :: ii,jj,kk</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="keywordtype">   real</span>(wp) :: dum</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="keywordtype">   real</span>(wp) :: eh1,t8,t9,tgb,h1</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160; </div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;   h = 0.0_wp</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160; </div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;   <span class="keywordflow">do</span> m = 1, nmat</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      i = matlist(1,m)</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      j = matlist(2,m)</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;      k = j+i*(i-1)/2</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      ishell = ao2sh(i)</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;      jshell = ao2sh(j)</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;      <span class="comment">! SCC terms</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;      eh1 = <a class="code" href="namespacextb__mctc__convert.html#a251a6230289b71aefe9a11d7df95213a">autoev</a>*(shellshift(ishell) + shellshift(jshell))</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;      h1 = -s(j,i)*eh1*0.5_wp</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;      h(j,i) = h0(k) + h1</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;      h(i,j) = h(j,i)</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160; </div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacextb__scc__core.html#a1214bb696e4b74ce8080805213d13adb">buildisotropich1</a></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160; </div>
<div class="line"><a name="l00150"></a><span class="lineno"><a class="line" href="namespacextb__scc__core.html#aa0ad51cc910549eaec45c7a3374b9661">  150</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacextb__scc__core.html#aa0ad51cc910549eaec45c7a3374b9661">addanisotropich1</a>(n,at,ndim,nshell,nmat,ndp,nqp,matlist,mdlst,mqlst,&amp;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                         H,S,dpint,qpint,vs,vd,vq,aoat2,ao2sh)</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__mctc__convert.html">xtb_mctc_convert</a>, <span class="keywordtype">only</span> : <a class="code" href="namespacextb__mctc__convert.html#a251a6230289b71aefe9a11d7df95213a">autoev</a>,<a class="code" href="namespacextb__mctc__convert.html#acdf2e027ee943efa9cc9a6b4701e3810">evtoau</a></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: n</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: at(n)</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: ndim</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: nshell</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: nmat</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: ndp</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: nqp</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: matlist(2,nmat)</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: mdlst(2,ndp)</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: mqlst(2,nqp)</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(in)</span>  :: S(ndim,ndim)</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(in)</span>  :: dpint(3,ndim,ndim)</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(in)</span>  :: qpint(6,ndim,ndim)</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(in)</span>  :: vs(n)</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(in)</span>  :: vd(3,n)</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(in)</span>  :: vq(6,n)</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: aoat2(ndim)</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: ao2sh(ndim)</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(inout)</span> :: H(ndim,ndim)</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160; </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">external</span> :: lin</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;   <span class="keywordtype">integer</span>  :: m,i,j,k,l</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;   <span class="keywordtype">integer</span>  :: ii,jj,kk</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;   <span class="keywordtype">integer</span>  :: ishell,jshell</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="keywordtype">   real</span>(wp) :: dum,eh1,t8,t9,tgb</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160; </div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;   <span class="keywordflow">do</span> m=1,nmat</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;      i=matlist(1,m)</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      j=matlist(2,m)</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;      k=j+i*(i-1)/2</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      ii=aoat2(i)</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;      jj=aoat2(j)</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      dum=s(j,i)</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;      <span class="comment">! CAMM potential</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      eh1=0.50d0*dum*(vs(ii)+vs(jj))*<a class="code" href="namespacextb__mctc__convert.html#a251a6230289b71aefe9a11d7df95213a">autoev</a></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      h(j,i)=h(j,i)+eh1</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      h(i,j)=h(j,i)</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;   <span class="keywordflow">do</span> m=1,ndp</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      i=mdlst(1,m)</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      j=mdlst(2,m)</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      k=<a class="code" href="constrain__pot_8f90.html#ac62613d43f31c7bfa652ee80083b400b">lin</a>(j,i)</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      ii=aoat2(i)</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      jj=aoat2(j)</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      eh1=0.0d0</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      <span class="keywordflow">do</span> l=1,3</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;         eh1=eh1+dpint(l,i,j)*(vd(l,ii)+vd(l,jj))</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      eh1=0.50d0*eh1*<a class="code" href="namespacextb__mctc__convert.html#a251a6230289b71aefe9a11d7df95213a">autoev</a></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      h(i,j)=h(i,j)+eh1</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      h(j,i)=h(i,j)</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;   <span class="keywordflow">do</span> m=1,nqp</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      i=mqlst(1,m)</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      j=mqlst(2,m)</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      ii=aoat2(i)</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      jj=aoat2(j)</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;      k=<a class="code" href="constrain__pot_8f90.html#ac62613d43f31c7bfa652ee80083b400b">lin</a>(j,i)</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      eh1=0.0d0</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      <span class="comment">! note: these come in the following order</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      <span class="comment">! xx, yy, zz, xy, xz, yz</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      <span class="keywordflow">do</span> l=1,6</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;         eh1=eh1+qpint(l,i,j)*(vq(l,ii)+vq(l,jj))</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      eh1=0.50d0*eh1*<a class="code" href="namespacextb__mctc__convert.html#a251a6230289b71aefe9a11d7df95213a">autoev</a></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      h(i,j)=h(i,j)+eh1</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      h(j,i)=h(i,j)</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160; </div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacextb__scc__core.html#aa0ad51cc910549eaec45c7a3374b9661">addanisotropich1</a></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160; </div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160; </div>
<div class="line"><a name="l00229"></a><span class="lineno"><a class="line" href="namespacextb__scc__core.html#a3e0e142b640924088ca8b0ab266dd5e0">  229</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacextb__scc__core.html#a3e0e142b640924088ca8b0ab266dd5e0">scc</a>(env,xtbData,solver,n,nel,nopen,ndim,ndp,nqp,nmat,nshell, &amp;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      &amp;        at,matlist,mdlst,mqlst,aoat2,ao2sh,ash, &amp;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;      &amp;        q,dipm,qp,qq,qlmom,qsh,zsh, &amp;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      &amp;        xyz,aes, &amp;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      &amp;        cm5,cm5a,gborn,solvation, &amp;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      &amp;        scD4, &amp;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      &amp;        broy,broydamp,damp0, &amp;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;      &amp;        pcem,shellShift,externShift, &amp;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      &amp;        et,focc,focca,foccb,efa,efb, &amp;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;      &amp;        eel,ees,eaes,epol,ed,epcem,egap,emo,ihomo,ihomoa,ihomob, &amp;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;      &amp;        H0,H,S,dpint,qpint,X,P,ies, &amp;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      &amp;        maxiter,startpdiag,scfconv,qconv, &amp;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      &amp;        minpr,pr, &amp;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      &amp;        fail,jter)</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__mctc__convert.html">xtb_mctc_convert</a>, <span class="keywordtype">only</span> : <a class="code" href="namespacextb__mctc__convert.html#a251a6230289b71aefe9a11d7df95213a">autoev</a>,<a class="code" href="namespacextb__mctc__convert.html#acdf2e027ee943efa9cc9a6b4701e3810">evtoau</a></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160; </div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__disp__dftd4.html">xtb_disp_dftd4</a>,  <span class="keywordtype">only</span>: <a class="code" href="namespacextb__disp__dftd4.html#ab5c7be6d2c0d30018b8fc446f517b527">disppot</a>,<a class="code" href="namespacextb__disp__dftd4.html#a885a7392a062b6c1231b6f6d5cc14bb7">edisp_scc</a></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__aespot.html">xtb_aespot</a>, <span class="keywordtype">only</span> : <a class="code" href="namespacextb__aespot.html#a7cea975ae11fb0b0b9ae8e0b61495d47">gfn2broyden_diff</a>,<a class="code" href="namespacextb__aespot.html#a10a8771cd9a6db96511bdd5f84c360d1">gfn2broyden_out</a>,<a class="code" href="namespacextb__aespot.html#a05bf1200d30dce1fb402ae1ef8609d3a">gfn2broyden_save</a>, &amp;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;   &amp;                  <a class="code" href="namespacextb__aespot.html#ac7317133fd3c2f90fe508fb06e7acc7a">mmompop</a>,<a class="code" href="namespacextb__aespot.html#ab85dc8fda19d2fc49468e845966e72a4">aniso_electro</a>,<a class="code" href="namespacextb__aespot.html#a49b3c4b26cb3479c91a54e16ca8dc168">setvsdq</a></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__embedding.html">xtb_embedding</a>, <span class="keywordtype">only</span> : <a class="code" href="namespacextb__embedding.html#ac848381f507e87559fb4910371564751">electro_pcem</a></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160; </div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;   <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">parameter</span> :: source = <span class="stringliteral">&#39;scc_core&#39;</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160; </div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;   <span class="keywordtype">type</span>(<a class="code" href="structxtb__type__environment_1_1tenvironment.html">tenvironment</a>), <span class="keywordtype">intent(inout)</span> :: env</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160; </div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;   <span class="keywordtype">type</span>(<a class="code" href="structxtb__xtb__data_1_1txtbdata.html">txtbdata</a>), <span class="keywordtype">intent(in)</span> :: xtbdata</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;   <span class="keywordtype">type</span>(<a class="code" href="structxtb__mctc__lapack__eigensolve_1_1teigensolver.html">teigensolver</a>), <span class="keywordtype">intent(inout)</span> :: solver</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160; </div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: n</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: nel</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: nopen</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: ndim</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: ndp</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: nqp</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: nmat</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: nshell</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">!! ------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">!  general options for the iterator</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: maxiter</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: startpdiag</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(in)</span>  :: scfconv</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(in)</span>  :: qconv</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;   <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span>  :: minpr</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;   <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span>  :: pr</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;   <span class="keywordtype">logical</span>, <span class="keywordtype">intent(out)</span> :: fail</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment">!! ------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: at(n)</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment">!! ------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: matlist(2,nmat)</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: mdlst(2,ndp)</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: mqlst(2,nqp)</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: aoat2(ndim)</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: ao2sh(ndim)</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: ash(:)</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment">!! ------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment">!  a bunch of charges and CAMMs</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(inout)</span> :: q(n)</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(inout)</span> :: dipm(3,n)</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(inout)</span> :: qp(6,n)</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(inout)</span> :: qq(n)</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(inout)</span> :: qlmom(3,n)</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(inout)</span> :: qsh(nshell)</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(in)</span>    :: zsh(nshell)</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="comment">!! ------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment">!  anisotropic electrostatic</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;   <span class="keywordtype">type</span>(<a class="code" href="structxtb__xtb__multipole_1_1txtbmultipole.html">txtbmultipole</a>), <span class="keywordtype">intent(in)</span>, <span class="keywordtype">optional</span> :: aes</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(in)</span>    :: xyz(3,n)</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>), <span class="keywordtype">allocatable</span> :: vs(:)</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>), <span class="keywordtype">allocatable</span> :: vd(:, :)</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>), <span class="keywordtype">allocatable</span> :: vq(:, :)</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment">!! ------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">!  continuum solvation model GBSA</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;   <span class="keywordtype">class</span>(<a class="code" href="structxtb__type__solvation_1_1tsolvation.html">tsolvation</a>), <span class="keywordtype">allocatable</span>, <span class="keywordtype">intent(inout)</span> :: solvation</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(in)</span>    :: cm5a(n)</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(inout)</span> :: cm5(n)</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(inout)</span> :: gborn</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">!! ------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">!  selfconsistent DFT-D4 dispersion correction</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;   <span class="keywordtype">type</span>(<a class="code" href="structxtb__xtb__dispersion_1_1txtbdispersion.html">txtbdispersion</a>), <span class="keywordtype">intent(inout)</span>, <span class="keywordtype">optional</span> :: scd4</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">!! ------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">!  point charge embedding potentials</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;   <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span>    :: pcem</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(inout)</span> :: shellshift(nshell)</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(inout)</span> :: externshift(nshell)</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>), <span class="keywordtype">allocatable</span> :: atomicshift(:)</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment">!! ------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment">!  Fermi-smearing</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(in)</span>    :: et</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(inout)</span> :: focc(ndim)</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(inout)</span> :: foccb(ndim),focca(ndim)</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(inout)</span> :: efa,efb</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">!! ------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment">!  Convergence accelerators, a simple damping as well as a Broyden mixing</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment">!  are available. The Broyden mixing is used by default seems reliable.</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(in)</span>    :: damp0</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>)               :: damp</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment">!  Broyden</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;   <span class="keywordtype">integer</span>                :: nbr</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;   <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span>    :: broy</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(inout)</span> :: broydamp</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>)               :: omegap</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">allocatable</span>   :: df(:,:)</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">allocatable</span>   :: u(:,:)</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">allocatable</span>   :: a(:,:)</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">allocatable</span>   :: q_in(:)</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">allocatable</span>   :: dq(:)</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">allocatable</span>   :: qlast_in(:)</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">allocatable</span>   :: dqlast(:)</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">allocatable</span>   :: <a class="code" href="constr_8f90.html#ae82fbacd108d547258e599e6ee56178b">omega</a>(:)</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment">!! ------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment">!  results of the SCC iterator</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(out)</span>   :: eel</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(out)</span>   :: epcem</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(out)</span>   :: ees</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(out)</span>   :: eaes</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(out)</span>   :: epol</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(out)</span>   :: ed</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(out)</span>   :: egap</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(out)</span>   :: emo(ndim)</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(inout)</span> :: ihomo</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(inout)</span> :: ihomoa</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(inout)</span> :: ihomob</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment">!! ------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(in)</span>    :: h0(ndim*(ndim+1)/2)</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(out)</span>   :: h(ndim,ndim)</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(inout)</span> :: p(ndim,ndim)</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(inout)</span> :: x(ndim,ndim)</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(in)</span>    :: s(ndim,ndim)</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(in)</span>    :: dpint(3,ndim,ndim)</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(in)</span>    :: qpint(6,ndim,ndim)</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;   <span class="keywordtype">type</span>(<a class="code" href="structxtb__xtb__coulomb_1_1txtbcoulomb.html">txtbcoulomb</a>), <span class="keywordtype">intent(inout)</span> :: ies</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160; </div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(inout)</span> :: jter</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment">!! ------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment">!  local variables</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;   <span class="keywordtype">integer</span>,<span class="keywordtype">external</span> :: <a class="code" href="constrain__pot_8f90.html#ac62613d43f31c7bfa652ee80083b400b">lin</a></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;   <span class="keywordtype">integer</span>  :: i,ii,j,jj,k,kk,l,m</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;   <span class="keywordtype">integer</span>  :: ishell,jshell</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>) :: t8,t9</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>) :: eh1,dum,tgb</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>) :: eold</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>) :: ga,gb</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>) :: rmsq</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>) :: nfoda,nfodb</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;   <span class="keywordtype">logical</span>  :: fulldiag</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;   <span class="keywordtype">logical</span>  :: lastdiag</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;   <span class="keywordtype">integer</span>  :: iter</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;   <span class="keywordtype">integer</span>  :: thisiter</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;   <span class="keywordtype">logical</span>  :: converged</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;   <span class="keywordtype">logical</span>  :: econverged</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;   <span class="keywordtype">logical</span>  :: qconverged</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160; </div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;   converged = .false.</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;   lastdiag = .false.</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;   <span class="comment">! number of iterations for this iterator</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;   thisiter = maxiter - jter</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160; </div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;   damp = damp0</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;   <span class="keywordflow">if</span> (<span class="keyword">present</span>(aes)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;      nbr = nshell + 9*n</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      <span class="keyword">allocate</span>(vs(n), vd(3, n), vq(6, n))</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;      nbr = nshell</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="keywordflow">   end if</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="comment">!  broyden data storage and init</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;   <span class="keyword">allocate</span>( df(thisiter,nbr),u(thisiter,nbr),a(thisiter,thisiter), &amp;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;   &amp;         dq(nbr),dqlast(nbr),qlast_in(nbr),<a class="code" href="constr_8f90.html#ae82fbacd108d547258e599e6ee56178b">omega</a>(thisiter), &amp;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;   &amp;         q_in(nbr),atomicshift(n), source = 0.0_wp )</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160; </div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="comment">!! ------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="comment">!  Iteration entry point</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;   scc_iterator: <span class="keywordflow">do</span> iter = 1, thisiter</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160; </div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;   <span class="comment">! set up ES potential</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;   atomicshift(:) = 0.0_wp</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;   shellshift(:) = externshift</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;   <span class="keyword">call </span>ies%addShift(q, qsh, atomicshift, shellshift)</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;   <span class="comment">! compute potential intermediates</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;   <span class="keywordflow">if</span> (<span class="keyword">present</span>(aes)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacextb__aespot.html#a49b3c4b26cb3479c91a54e16ca8dc168">setvsdq</a>(aes,n,at,xyz,q,dipm,qp,aes%gab3,aes%gab5,vs,vd,vq)</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="keywordflow">   end if</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;   <span class="comment">! Solvation contributions</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;   <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(solvation)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;      cm5(:) = q + cm5a</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;      <span class="keyword">call </span>solvation%addShift(env, cm5, qsh, atomicshift, shellshift)</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="keywordflow">   end if</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;   <span class="comment">! self consistent dispersion contributions</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;   <span class="keywordflow">if</span> (<span class="keyword">present</span>(scd4)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;      <span class="keyword">call </span>scd4%addShift(at, q, atomicshift)</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="keywordflow">   end if</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;   <span class="comment">! expand all atomic potentials to shell resolved potentials</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;   <span class="keyword">call </span><a class="code" href="namespacextb__scc__core.html#acd449c8351fbbaacd8b4a82d211faffd">addtoshellshift</a>(ash, atomicshift, shellshift)</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160; </div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;   <span class="comment">! build the charge dependent Hamiltonian</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;   <span class="keyword">call </span><a class="code" href="namespacextb__scc__core.html#a1214bb696e4b74ce8080805213d13adb">buildisotropich1</a>(n,at,ndim,nshell,nmat,matlist,h,h0,s, &amp;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;      &amp; shellshift,aoat2,ao2sh)</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;   <span class="keywordflow">if</span> (<span class="keyword">present</span>(aes)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacextb__scc__core.html#aa0ad51cc910549eaec45c7a3374b9661">addanisotropich1</a>(n,at,ndim,nshell,nmat,ndp,nqp,matlist,mdlst,mqlst,&amp;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;         &amp; h,s,dpint,qpint,vs,vd,vq,aoat2,ao2sh)</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="keywordflow">   end if</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160; </div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;   <span class="comment">! ------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;   <span class="comment">! solve HC=SCemo(X,P are scratch/store)</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;   <span class="comment">! solution is in H(=C)/emo</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;   <span class="comment">! ------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;   fulldiag=.false.</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;   <span class="keywordflow">if</span>(iter.lt.startpdiag) fulldiag=.<a class="code" href="symmetry__i_8c.html#aa77c823a9fc018ae1d437369708d8727">true</a>.</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;   <span class="keywordflow">if</span>(lastdiag )          fulldiag=.<a class="code" href="symmetry__i_8c.html#aa77c823a9fc018ae1d437369708d8727">true</a>.</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160; </div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;   <span class="comment">!call solve(fulldiag,ndim,ihomo,scfconv,H,S,X,P,emo,fail)</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160; </div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;   <span class="keyword">call </span>solver%solve(env, h, s, emo)</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;   <span class="keyword">call </span>env%check(fail)</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;   <span class="keywordflow">if</span>(fail)<span class="keywordflow">then</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;      <span class="keyword">call </span>env%error(<span class="stringliteral">&quot;Diagonalization of Hamiltonian failed&quot;</span>, source)</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;      <span class="keywordflow">return</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160; </div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;   <span class="keywordflow">if</span>(ihomo+1.le.ndim.and.ihomo.ge.1)egap=emo(ihomo+1)-emo(ihomo)</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;   <span class="comment">! automatic reset to small value</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;   <span class="keywordflow">if</span>(egap.lt.0.1.and.iter.eq.0) broydamp=0.03</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160; </div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;   <span class="comment">! Fermi smearing</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;   <span class="keywordflow">if</span>(et.gt.0.1)<span class="keywordflow">then</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;      <span class="comment">! convert restricted occ first to alpha/beta</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      <span class="keywordflow">if</span>(nel.gt.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;         <span class="keyword">call </span><a class="code" href="namespacextb__scc__core.html#aac06c643c8cf37ba0337ace78508ab19">occu</a>(ndim,nel,nopen,ihomoa,ihomob,focca,foccb)</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;         focca=0.0d0</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;         foccb=0.0d0</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;         ihomoa=0</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;         ihomob=0</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;      <span class="keywordflow">if</span> (ihomoa+1.le.ndim) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;         <span class="keyword">call </span><a class="code" href="namespacextb__scc__core.html#a6464c6f815b95933767e307bbe7b34d1">fermismear</a>(.false.,ndim,ihomoa,et,emo,focca,nfoda,efa,ga)</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;      <span class="keywordflow">if</span> (ihomob+1.le.ndim) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;         <span class="keyword">call </span><a class="code" href="namespacextb__scc__core.html#a6464c6f815b95933767e307bbe7b34d1">fermismear</a>(.false.,ndim,ihomob,et,emo,foccb,nfodb,efb,gb)</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;      focc = focca + foccb</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;      ga = 0.0_wp</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;      gb = 0.0_wp</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160; </div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;   <span class="comment">! save q</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;   q_in(1:nshell)=qsh(1:nshell)</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;   <span class="keywordflow">if</span> (<span class="keyword">present</span>(aes)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;      k=nshell</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacextb__aespot.html#a05bf1200d30dce1fb402ae1ef8609d3a">gfn2broyden_save</a>(n,k,nbr,dipm,qp,q_in)</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="keywordflow">   end if</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160; </div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;   <span class="comment">! density matrix</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;   <span class="keyword">call </span><a class="code" href="namespacextb__scc__core.html#af5c3cd803d403c23fc0ae9c2eb1229c6">dmat</a>(ndim,focc,h,p)</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160; </div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;   <span class="comment">! new q</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;   <span class="keyword">call </span><a class="code" href="namespacextb__scc__core.html#aef6343e2d48902c11b8a14602aec2971">mpopsh</a>(n,ndim,nshell,ao2sh,s,p,qsh)</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;   qsh = zsh - qsh</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160; </div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;   <span class="comment">! qat from qsh</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;   <span class="keyword">call </span><a class="code" href="namespacextb__scc__core.html#a59b1e6be65cf0c0bf82cae50bf40000c">qsh2qat</a>(ash,qsh,q)</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160; </div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;   eold=eel</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;   <span class="keyword">call </span><a class="code" href="namespacextb__scc__core.html#a242df5f670f054274ad6af4fc5b68a7c">electro</a>(n,at,ndim,nshell,ies,h0,p,q,qsh,ees,eel)</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;   <span class="comment">! multipole electrostatic</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;   <span class="keywordflow">if</span> (<span class="keyword">present</span>(aes)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacextb__aespot.html#ac7317133fd3c2f90fe508fb06e7acc7a">mmompop</a>(n,ndim,aoat2,xyz,p,s,dpint,qpint,dipm,qp)</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;      <span class="comment">! evaluate energy</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacextb__aespot.html#ab85dc8fda19d2fc49468e845966e72a4">aniso_electro</a>(aes,n,at,xyz,q,dipm,qp,aes%gab3,aes%gab5,eaes,epol)</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      eel=eel+eaes+epol</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="keywordflow">   end if</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160; </div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;   <span class="comment">! Self consistent dispersion</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;   <span class="keywordflow">if</span> (<span class="keyword">present</span>(scd4)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;      <span class="keyword">call </span>scd4%getEnergy(at, q, ed)</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;      eel = eel + ed</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160; </div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;   <span class="comment">! point charge contribution</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;   <span class="keywordflow">if</span>(pcem) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacextb__embedding.html#ac848381f507e87559fb4910371564751">electro_pcem</a>(nshell,qsh,externshift,epcem,eel)</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="keywordflow">   end if</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160; </div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;   <span class="comment">! new cm5 charges and gborn energy</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;   <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(solvation)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;      cm5=q+cm5a</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;      <span class="keyword">call </span>solvation%getEnergy(env, cm5, qsh, gborn)</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;      eel = eel + gborn</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="keywordflow">   end if</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160; </div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;   <span class="comment">! add el. entropies*T</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;   eel=eel+ga+gb</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160; </div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;   <span class="comment">! ------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;   <span class="comment">! check for energy convergence</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;   econverged = abs(eel - eold) &lt; scfconv</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;   <span class="comment">! ------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160; </div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;   dq(1:nshell)=qsh(1:nshell)-q_in(1:nshell)</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;   <span class="keywordflow">if</span> (<span class="keyword">present</span>(aes)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;      k=nshell</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacextb__aespot.html#a7cea975ae11fb0b0b9ae8e0b61495d47">gfn2broyden_diff</a>(n,k,nbr,dipm,qp,q_in,dq) <span class="comment">! CAMM case</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="keywordflow">   end if</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;   rmsq=sum(dq(1:nbr)**2)/dble(n)</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;   rmsq=sqrt(rmsq)</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160; </div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;   <span class="comment">! ------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;   <span class="comment">! end of SCC convergence part</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;   qconverged = rmsq &lt; qconv</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;   <span class="comment">! ------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160; </div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;   <span class="comment">! SCC convergence acceleration</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;   <span class="keywordflow">if</span>(.not.broy)<span class="keywordflow">then</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160; </div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      <span class="comment">! simple damp</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;      <span class="keywordflow">if</span>(iter.gt.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;         omegap=egap</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;         <span class="comment">! monopoles only</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;         <span class="keywordflow">do</span> i=1,nshell</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;            qsh(i)=damp*qsh(i)+(1.0d0-damp)*q_in(i)</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="keywordflow">         enddo</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;         <span class="keywordflow">if</span> (<span class="keyword">present</span>(aes)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;            <span class="comment">! CAMM</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;            k=nshell</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;            <span class="keywordflow">do</span> i=1,n</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;               <span class="keywordflow">do</span> j=1,3</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                  k=k+1</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                  dipm(j,i)=damp*dipm(j,i)+(1.0d0-damp)*q_in(k)</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="keywordflow">               enddo</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;               <span class="keywordflow">do</span> j=1,6</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                  k=k+1</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                  qp(j,i)=damp*qp(j,i)+(1.0d0-damp)*q_in(k)</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="keywordflow">               enddo</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="keywordflow">            enddo</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="keywordflow">         end if</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;         <span class="keywordflow">if</span>(eel-eold.lt.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;            damp=damp*1.15</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;         <span class="keywordflow">else</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;            damp=damp0</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;         damp=min(damp,1.0)</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;         <span class="keywordflow">if</span>(egap.lt.1.0)damp=min(damp,0.5)</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160; </div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160; </div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      <span class="comment">! Broyden mixing</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;      omegap=0.0d0</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacextb__broyden.html#ab8ea7338631bb6e5be77f76b32e5467c">broyden</a>(nbr,q_in,qlast_in,dq,dqlast,iter,thisiter,broydamp,<a class="code" href="constr_8f90.html#ae82fbacd108d547258e599e6ee56178b">omega</a>,df,u,a)</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;      qsh(1:nshell)=q_in(1:nshell)</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">present</span>(aes)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;         k=nshell</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;         <span class="keyword">call </span><a class="code" href="namespacextb__aespot.html#a10a8771cd9a6db96511bdd5f84c360d1">gfn2broyden_out</a>(n,k,nbr,q_in,dipm,qp) <span class="comment">! CAMM case</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;      <span class="keywordflow">if</span>(iter.gt.1) omegap=<a class="code" href="constr_8f90.html#ae82fbacd108d547258e599e6ee56178b">omega</a>(iter-1)</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="keywordflow">   endif</span> <span class="comment">! Broyden?</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160; </div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;   <span class="keyword">call </span><a class="code" href="namespacextb__scc__core.html#a59b1e6be65cf0c0bf82cae50bf40000c">qsh2qat</a>(ash, qsh, q) <span class="comment">!new qat</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160; </div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;   <span class="keywordflow">if</span>(<span class="keyword">allocated</span>(solvation)) cm5 = q+cm5a</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160; </div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;   <span class="keywordflow">if</span>(minpr)<span class="keyword">write</span>(env%unit,<span class="stringliteral">&#39;(i4,F15.7,E14.6,E11.3,f8.2,2x,f8.1,l3)&#39;</span>) &amp;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;   &amp;  iter+jter,eel,eel-eold,rmsq,egap,omegap,fulldiag</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;   qq=q</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160; </div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="comment">!  end of SCC convergence part</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160; </div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="comment">!! ------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;   <span class="keywordflow">if</span> (econverged.and.qconverged) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;      converged = .<a class="code" href="symmetry__i_8c.html#aa77c823a9fc018ae1d437369708d8727">true</a>.</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;      <span class="keywordflow">if</span> (lastdiag) <span class="keywordflow">exit</span> scc_iterator</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;      lastdiag = .<a class="code" href="symmetry__i_8c.html#aa77c823a9fc018ae1d437369708d8727">true</a>.</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="comment">!! ------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160; </div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="keywordflow">   enddo</span> scc_iterator</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160; </div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;   jter = jter + min(iter,thisiter)</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;   fail = .not.converged</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160; </div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacextb__scc__core.html#a3e0e142b640924088ca8b0ab266dd5e0">scc</a></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160; </div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160; </div>
<div class="line"><a name="l00613"></a><span class="lineno"><a class="line" href="namespacextb__scc__core.html#a136cd39a28befead4338400b448fddc3">  613</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacextb__scc__core.html#a136cd39a28befead4338400b448fddc3">h0scal</a>(hData,il,jl,izp,jzp,valaoi,valaoj,km)</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  <span class="comment">!$acc routine seq</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;   <span class="keywordtype">type</span>(<a class="code" href="structxtb__xtb__data_1_1thamiltoniandata.html">thamiltoniandata</a>), <span class="keywordtype">intent(in)</span> :: hdata</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: il</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: jl</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: izp</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: jzp</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;   <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span>  :: valaoi</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;   <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span>  :: valaoj</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(out)</span> :: km</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>) :: den, enpoly</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160; </div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;   km = 0.0_wp</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160; </div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="comment">!  valence</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;   <span class="keywordflow">if</span>(valaoi.and.valaoj) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;      den=(hdata%electronegativity(izp)-hdata%electronegativity(jzp))**2</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      enpoly = (1.0_wp+hdata%enScale(jl-1,il-1)*den*(1.0_wp+hdata%enScale4*den))</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;      km=hdata%kScale(jl-1,il-1)*enpoly*hdata%pairParam(izp,jzp)</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;      <span class="keywordflow">return</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160; </div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="comment">!  &quot;DZ&quot; functions (on H for GFN or 3S for EA calc on all atoms)</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;   <span class="keywordflow">if</span>((.not.valaoi).and.(.not.valaoj)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;      km=hdata%kDiff</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;      <span class="keywordflow">return</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;   <span class="keywordflow">if</span>(.not.valaoi.and.valaoj) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;      km=0.5*(hdata%kScale(jl-1,jl-1)+hdata%kDiff)</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;      <span class="keywordflow">return</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;   <span class="keywordflow">if</span>(.not.valaoj.and.valaoi) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;      km=0.5*(hdata%kScale(il-1,il-1)+hdata%kDiff)</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160; </div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160; </div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacextb__scc__core.html#a136cd39a28befead4338400b448fddc3">h0scal</a></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160; </div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160; </div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;<span class="comment">!! ========================================================================</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;<span class="comment">!  total energy for GFN1</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="comment">!! ========================================================================</span></div>
<div class="line"><a name="l00655"></a><span class="lineno"><a class="line" href="namespacextb__scc__core.html#a242df5f670f054274ad6af4fc5b68a7c">  655</a></span>&#160;<span class="keywordtype">pure</span> <span class="keyword">subroutine </span><a class="code" href="namespacextb__scc__core.html#a242df5f670f054274ad6af4fc5b68a7c">electro</a>(n,at,nbf,nshell,ies,H0,P,dq,dqsh,es,scc)</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__mctc__convert.html">xtb_mctc_convert</a>, <span class="keywordtype">only</span> : <a class="code" href="namespacextb__mctc__convert.html#acdf2e027ee943efa9cc9a6b4701e3810">evtoau</a></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: n</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: at(n)</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: nbf</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: nshell</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(in)</span>  :: h0(nbf*(nbf+1)/2)</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(in)</span>  :: p (nbf,nbf)</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;   <span class="keywordtype">type</span>(<a class="code" href="structxtb__xtb__coulomb_1_1txtbcoulomb.html">txtbcoulomb</a>), <span class="keywordtype">intent(inout)</span> :: ies</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(in)</span>  :: dq(n)</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(in)</span>  :: dqsh(nshell)</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(out)</span> :: es</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(out)</span> :: <a class="code" href="namespacextb__scc__core.html#a3e0e142b640924088ca8b0ab266dd5e0">scc</a></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>) :: ehb <span class="comment">! not used</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160; </div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;   <span class="keywordtype">integer</span>  :: i,j,k</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>) :: h,t</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160; </div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;   <span class="comment">! ES energy in Eh</span></div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;   <span class="keyword">call </span>ies%getEnergy(dq, dqsh, es)</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160; </div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;<span class="comment">!  H0 part</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;   k=0</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;   h=0.0_wp</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;   <span class="keywordflow">do</span> i=1,nbf</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      <span class="keywordflow">do</span> j=1,i-1</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;         k=k+1</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;         h=h+p(j,i)*h0(k)</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;      k=k+1</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;      h=h+p(i,i)*h0(k)*0.5_wp</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160; </div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="comment">!  Etotal in Eh</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;   <a class="code" href="namespacextb__scc__core.html#a3e0e142b640924088ca8b0ab266dd5e0">scc</a> = es + 2.0_wp*h*<a class="code" href="namespacextb__mctc__convert.html#acdf2e027ee943efa9cc9a6b4701e3810">evtoau</a></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160; </div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacextb__scc__core.html#a242df5f670f054274ad6af4fc5b68a7c">electro</a></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160; </div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160; </div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;<span class="comment">!! ========================================================================</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;<span class="comment">!  S(R) enhancement factor</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;<span class="comment">!! ========================================================================</span></div>
<div class="line"><a name="l00697"></a><span class="lineno"><a class="line" href="namespacextb__scc__core.html#ab589fe59f0960d1e9adf8ef9d48a6e45">  697</a></span>&#160;<span class="keywordtype">pure</span> <span class="keyword">function </span><a class="code" href="namespacextb__scc__core.html#ab589fe59f0960d1e9adf8ef9d48a6e45">shellpoly</a>(iPoly,jPoly,iRad,jRad,xyz1,xyz2)</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__mctc__convert.html">xtb_mctc_convert</a>, <span class="keywordtype">only</span> : <a class="code" href="namespacextb__mctc__convert.html#a4b0d1ae04bd4514d581a066cd7c26993">aatoau</a></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;   <span class="comment">!$acc routine seq</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>), <span class="keywordtype">intent(in)</span> :: ipoly,jpoly</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>), <span class="keywordtype">intent(in)</span> :: irad,jrad</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>), <span class="keywordtype">intent(in)</span> :: xyz1(3),xyz2(3)</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>) :: <a class="code" href="namespacextb__scc__core.html#ab589fe59f0960d1e9adf8ef9d48a6e45">shellpoly</a></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>) :: rab,k1,rr,r,rf1,rf2,dx,dy,dz,a</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160; </div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;   a=0.5           <span class="comment">! R^a dependence 0.5 in GFN1</span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160; </div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;   dx=xyz1(1)-xyz2(1)</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;   dy=xyz1(2)-xyz2(2)</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;   dz=xyz1(3)-xyz2(3)</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160; </div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;   rab=sqrt(dx**2+dy**2+dz**2)</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160; </div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;   <span class="comment">! this sloppy conv. factor has been used in development, keep it</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;   rr=jrad+irad</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160; </div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;   r=rab/rr</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160; </div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;   rf1=1.0d0+0.01*ipoly*r**a</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;   rf2=1.0d0+0.01*jpoly*r**a</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160; </div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;   <a class="code" href="namespacextb__scc__core.html#ab589fe59f0960d1e9adf8ef9d48a6e45">shellpoly</a>= rf1*rf2</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160; </div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<span class="keyword">end function </span><a class="code" href="namespacextb__scc__core.html#ab589fe59f0960d1e9adf8ef9d48a6e45">shellpoly</a></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160; </div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="comment">!! ========================================================================</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;<span class="comment">!  set up Coulomb potential due to 2nd order fluctuation</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;<span class="comment">!! ========================================================================</span></div>
<div class="line"><a name="l00729"></a><span class="lineno"><a class="line" href="namespacextb__scc__core.html#a49f0c6e6ceb820a75cb334ab646d92ed">  729</a></span>&#160;<span class="keywordtype">pure</span> <span class="keyword">subroutine </span><a class="code" href="namespacextb__scc__core.html#a49f0c6e6ceb820a75cb334ab646d92ed">setespot</a>(nshell, qsh, jmat, shellShift)</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160; </div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: nshell</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160; </div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(in)</span> :: qsh(:)</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160; </div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(in)</span> :: jmat(:, :)</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160; </div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(inout)</span> :: shellshift(:)</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160; </div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;   <span class="comment">!call blas_symv(&#39;l&#39;, nshell, 1.0_wp, jmat, nshell, qsh, 1, 1.0_wp, shellShift, 1)</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;   <span class="keyword">call </span>mctc_symv(jmat, qsh, shellshift, beta=1.0_wp)</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160; </div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacextb__scc__core.html#a49f0c6e6ceb820a75cb334ab646d92ed">setespot</a></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160; </div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160; </div>
<div class="line"><a name="l00749"></a><span class="lineno"><a class="line" href="namespacextb__scc__core.html#acd449c8351fbbaacd8b4a82d211faffd">  749</a></span>&#160;<span class="keywordtype">pure</span> <span class="keyword">subroutine </span><a class="code" href="namespacextb__scc__core.html#acd449c8351fbbaacd8b4a82d211faffd">addtoshellshift</a>(shellAtom, atomicShift, shellShift)</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160; </div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: shellatom(:)</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160; </div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>), <span class="keywordtype">intent(in)</span> :: atomicshift(:)</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160; </div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>), <span class="keywordtype">intent(inout)</span> :: shellshift(:)</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160; </div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;   <span class="keywordtype">integer</span> :: ii</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160; </div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;   <span class="keywordflow">do</span> ii = 1, <span class="keyword">size</span>(shellshift, dim=1)</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;      shellshift(ii) = shellshift(ii) + atomicshift(shellatom(ii))</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;<span class="keywordflow">   end do</span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160; </div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacextb__scc__core.html#acd449c8351fbbaacd8b4a82d211faffd">addtoshellshift</a></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160; </div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160; </div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;<span class="comment">!! ========================================================================</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;<span class="comment">!  eigenvalue solver single-precision</span></div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;<span class="comment">!! ========================================================================</span></div>
<div class="line"><a name="l00772"></a><span class="lineno"><a class="line" href="namespacextb__scc__core.html#ac01c578b81a798d30846c16f0f35d699">  772</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacextb__scc__core.html#ac01c578b81a798d30846c16f0f35d699">solve4</a>(full,ndim,ihomo,acc,H,S,X,P,e,fail)</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__mctc__accuracy.html">xtb_mctc_accuracy</a>, <span class="keywordtype">only</span> : <a class="code" href="namespacextb__mctc__accuracy.html#af8a3da98f40445db18ce006622ae46ca">sp</a></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>   :: ndim</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;   <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span>   :: full</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>   :: ihomo</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(inout)</span>:: h(ndim,ndim)</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(in)</span>   :: s(ndim,ndim)</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(out)</span>  :: x(ndim,ndim)</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(out)</span>  :: p(ndim,ndim)</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(out)</span>  :: e(ndim)</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">intent(in)</span>   :: acc</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;   <span class="keywordtype">logical</span>, <span class="keywordtype">intent(out)</span>  :: fail</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160; </div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;   <span class="keywordtype">integer</span> i,j,info,lwork,liwork,nfound,iu,nbf</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">allocatable</span> :: iwork(:),ifail(:)</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;<span class="keywordtype">   real</span>(wp),<span class="keywordtype">allocatable</span> :: aux  (:)</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;<span class="keywordtype">   real</span>(wp) w0,w1,t0,t1</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160; </div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#af8a3da98f40445db18ce006622ae46ca">sp</a>),<span class="keywordtype">allocatable</span> :: h4(:,:)</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#af8a3da98f40445db18ce006622ae46ca">sp</a>),<span class="keywordtype">allocatable</span> :: s4(:,:)</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#af8a3da98f40445db18ce006622ae46ca">sp</a>),<span class="keywordtype">allocatable</span> :: x4(:,:)</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#af8a3da98f40445db18ce006622ae46ca">sp</a>),<span class="keywordtype">allocatable</span> :: p4(:,:)</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#af8a3da98f40445db18ce006622ae46ca">sp</a>),<span class="keywordtype">allocatable</span> :: e4(:)</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#af8a3da98f40445db18ce006622ae46ca">sp</a>),<span class="keywordtype">allocatable</span> :: aux4(:)</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160; </div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160; </div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;   <span class="keyword">allocate</span>(h4(ndim,ndim),s4(ndim,ndim))</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;   <span class="keyword">allocate</span>(x4(ndim,ndim),p4(ndim,ndim),e4(ndim))</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160; </div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;   h4 = h</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;   s4 = s</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160; </div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;   fail =.false.</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;<span class="comment">!  standard first full diag call</span></div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;   <span class="keywordflow">if</span>(full) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;<span class="comment">!                                                     call timing(t0,w0)</span></div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;<span class="comment">!     if(ndim.gt.0)then</span></div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;<span class="comment">!     USE DIAG IN NON-ORTHORGONAL BASIS</span></div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;      <span class="keyword">allocate</span> (aux4(1),iwork(1),ifail(ndim))</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;      p4 = s4</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;      <span class="keyword">call </span>lapack_sygvd(1,<span class="stringliteral">&#39;v&#39;</span>,<span class="stringliteral">&#39;u&#39;</span>,ndim,h4,ndim,p4,ndim,e4,aux4, &amp;<span class="comment">!workspace query</span></div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;     &amp;           -1,iwork,liwork,info)</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;      lwork=int(aux4(1))</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;      liwork=iwork(1)</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;      <span class="keyword">deallocate</span>(aux4,iwork)</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;      <span class="keyword">allocate</span> (aux4(lwork),iwork(liwork))              <span class="comment">!do it</span></div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;      <span class="keyword">call </span>lapack_sygvd(1,<span class="stringliteral">&#39;v&#39;</span>,<span class="stringliteral">&#39;u&#39;</span>,ndim,h4,ndim,p4,ndim,e4,aux4, &amp;</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;     &amp;           lwork,iwork,liwork,info)</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;      <span class="keywordflow">if</span>(info.ne.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;         fail=.<a class="code" href="symmetry__i_8c.html#aa77c823a9fc018ae1d437369708d8727">true</a>.</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;      x4 = h4 <span class="comment">! save</span></div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;      <span class="keyword">deallocate</span>(aux4,iwork,ifail)</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160; </div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;<span class="comment">!     else</span></div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;<span class="comment">!        USE DIAG IN ORTHOGONAL BASIS WITH X=S^-1/2 TRAFO</span></div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;<span class="comment">!        nbf = ndim</span></div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;<span class="comment">!        lwork  = 1 + 6*nbf + 2*nbf**2</span></div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;<span class="comment">!        allocate (aux(lwork))</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;<span class="comment">!        call blas_gemm(&#39;N&#39;,&#39;N&#39;,nbf,nbf,nbf,1.0d0,H,nbf,X,nbf,0.0d0,P,nbf)</span></div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;<span class="comment">!        call blas_gemm(&#39;T&#39;,&#39;N&#39;,nbf,nbf,nbf,1.0d0,X,nbf,P,nbf,0.0d0,H,nbf)</span></div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;<span class="comment">!        call SYEV(&#39;V&#39;,&#39;U&#39;,nbf,H,nbf,e,aux,lwork,info)</span></div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;<span class="comment">!        if(info.ne.0) error stop &#39;diag error&#39;</span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;<span class="comment">!        call blas_gemm(&#39;N&#39;,&#39;N&#39;,nbf,nbf,nbf,1.0d0,X,nbf,H,nbf,0.0d0,P,nbf)</span></div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;<span class="comment">!        H = P</span></div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="comment">!        deallocate(aux)</span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<span class="comment">!     endif</span></div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="comment">!                                                     call timing(t1,w1)</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="comment">!                                    call prtime(6,t1-t0,w1-w0,&#39;dsygvd&#39;)</span></div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160; </div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;<span class="comment">!                                                     call timing(t0,w0)</span></div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="comment">!     go to MO basis using trafo(X) from first iteration (=full diag)</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;<span class="comment">!      call blas_gemm(&#39;N&#39;,&#39;N&#39;,ndim,ndim,ndim,1.d0,H4,ndim,X4,ndim,0.d0,P4,ndim)</span></div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;<span class="comment">!      call blas_gemm(&#39;T&#39;,&#39;N&#39;,ndim,ndim,ndim,1.d0,X4,ndim,P4,ndim,0.d0,H4,ndim)</span></div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;<span class="comment">!                                                     call timing(t1,w1)</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;<span class="comment">!                       call prtime(6,1.5*(t1-t0),1.5*(w1-w0),&#39;3xdgemm&#39;)</span></div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;<span class="comment">!                                                     call timing(t0,w0)</span></div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;<span class="comment">!      call pseudodiag(ndim,ihomo,H4,e4)</span></div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;<span class="comment">!                                                     call timing(t1,w1)</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;<span class="comment">!                                call prtime(6,t1-t0,w1-w0,&#39;pseudodiag&#39;)</span></div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160; </div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;<span class="comment">!     C = X C&#39;, P=scratch</span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;<span class="comment">!      call blas_gemm(&#39;N&#39;,&#39;N&#39;,ndim,ndim,ndim,1.d0,X4,ndim,H4,ndim,0.d0,P4,ndim)</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;<span class="comment">!     save and output MO matrix in AO basis</span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;<span class="comment">!      H4 = P4</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160; </div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;   h = h4</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;   p = p4</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;   x = x4</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;   e = e4</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160; </div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;   <span class="keyword">deallocate</span>(e4,p4,x4,s4,h4)</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160; </div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacextb__scc__core.html#ac01c578b81a798d30846c16f0f35d699">solve4</a></div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160; </div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160; </div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;<span class="comment">!! ========================================================================</span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;<span class="comment">!  eigenvalue solver</span></div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;<span class="comment">!! ========================================================================</span></div>
<div class="line"><a name="l00874"></a><span class="lineno"><a class="line" href="namespacextb__scc__core.html#a3a50c09ff46dca0182ee74b31c3d2980">  874</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacextb__scc__core.html#a3a50c09ff46dca0182ee74b31c3d2980">solve</a>(full,ndim,ihomo,acc,H,S,X,P,e,fail)</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>   :: ndim</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;   <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span>   :: full</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>   :: ihomo</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(inout)</span>:: h(ndim,ndim)</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(in)</span>   :: s(ndim,ndim)</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(out)</span>  :: x(ndim,ndim)</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(out)</span>  :: p(ndim,ndim)</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(out)</span>  :: e(ndim)</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(in)</span>   :: acc</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;   <span class="keywordtype">logical</span>, <span class="keywordtype">intent(out)</span>  :: fail</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160; </div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;   <span class="keywordtype">integer</span> i,j,info,lwork,liwork,nfound,iu,nbf</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">allocatable</span> :: iwork(:),ifail(:)</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">allocatable</span> :: aux  (:)</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>) w0,w1,t0,t1</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160; </div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;   fail =.false.</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160; </div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;<span class="comment">!  standard first full diag call</span></div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;   <span class="keywordflow">if</span>(full) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;<span class="comment">!                                                     call timing(t0,w0)</span></div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;<span class="comment">!     if(ndim.gt.0)then</span></div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;<span class="comment">!     USE DIAG IN NON-ORTHORGONAL BASIS</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;      <span class="keyword">allocate</span> (aux(1),iwork(1),ifail(ndim))</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;      p = s</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      <span class="keyword">call </span>lapack_sygvd(1,<span class="stringliteral">&#39;v&#39;</span>,<span class="stringliteral">&#39;u&#39;</span>,ndim,h,ndim,p,ndim,e,aux, &amp;<span class="comment">!workspace query</span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;     &amp;           -1,iwork,liwork,info)</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;      lwork=int(aux(1))</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;      liwork=iwork(1)</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;      <span class="keyword">deallocate</span>(aux,iwork)</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;      <span class="keyword">allocate</span> (aux(lwork),iwork(liwork))              <span class="comment">!do it</span></div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;      <span class="keyword">call </span>lapack_sygvd(1,<span class="stringliteral">&#39;v&#39;</span>,<span class="stringliteral">&#39;u&#39;</span>,ndim,h,ndim,p,ndim,e,aux, &amp;</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;     &amp;           lwork,iwork,liwork,info)</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;      <span class="comment">!write(*,*)&#39;SYGVD INFO&#39;, info</span></div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;      <span class="keywordflow">if</span>(info.ne.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;         fail=.<a class="code" href="symmetry__i_8c.html#aa77c823a9fc018ae1d437369708d8727">true</a>.</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;      x = h <span class="comment">! save</span></div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;      <span class="keyword">deallocate</span>(aux,iwork,ifail)</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160; </div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;<span class="comment">!     else</span></div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;<span class="comment">!        USE DIAG IN ORTHOGONAL BASIS WITH X=S^-1/2 TRAFO</span></div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;<span class="comment">!        nbf = ndim</span></div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;<span class="comment">!        lwork  = 1 + 6*nbf + 2*nbf**2</span></div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;<span class="comment">!        allocate (aux(lwork))</span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;<span class="comment">!        call blas_gemm(&#39;N&#39;,&#39;N&#39;,nbf,nbf,nbf,1.0d0,H,nbf,X,nbf,0.0d0,P,nbf)</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;<span class="comment">!        call blas_gemm(&#39;T&#39;,&#39;N&#39;,nbf,nbf,nbf,1.0d0,X,nbf,P,nbf,0.0d0,H,nbf)</span></div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;<span class="comment">!        call SYEV(&#39;V&#39;,&#39;U&#39;,nbf,H,nbf,e,aux,lwork,info)</span></div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;<span class="comment">!        if(info.ne.0) error stop &#39;diag error&#39;</span></div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;<span class="comment">!        call blas_gemm(&#39;N&#39;,&#39;N&#39;,nbf,nbf,nbf,1.0d0,X,nbf,H,nbf,0.0d0,P,nbf)</span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;<span class="comment">!        H = P</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;<span class="comment">!        deallocate(aux)</span></div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;<span class="comment">!     endif</span></div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="comment">!                                                     call timing(t1,w1)</span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<span class="comment">!                                    call prtime(6,t1-t0,w1-w0,&#39;dsygvd&#39;)</span></div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160; </div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;<span class="comment">!                                                     call timing(t0,w0)</span></div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;<span class="comment">!     go to MO basis using trafo(X) from first iteration (=full diag)</span></div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;      <span class="keyword">call </span>blas_gemm(<span class="stringliteral">&#39;N&#39;</span>,<span class="stringliteral">&#39;N&#39;</span>,ndim,ndim,ndim,1.d0,h,ndim,x,ndim,0.d0,p,ndim)</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;      <span class="keyword">call </span>blas_gemm(<span class="stringliteral">&#39;T&#39;</span>,<span class="stringliteral">&#39;N&#39;</span>,ndim,ndim,ndim,1.d0,x,ndim,p,ndim,0.d0,h,ndim)</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;<span class="comment">!                                                     call timing(t1,w1)</span></div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;<span class="comment">!                       call prtime(6,1.5*(t1-t0),1.5*(w1-w0),&#39;3xdgemm&#39;)</span></div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="comment">!                                                     call timing(t0,w0)</span></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;      <span class="keyword">call </span><a class="code" href="pseudodiag_8f90.html#afdad9eb3e146467bf9b609606bad29fa">pseudodiag</a>(ndim,ihomo,h,e)</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;<span class="comment">!                                                     call timing(t1,w1)</span></div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;<span class="comment">!                                call prtime(6,t1-t0,w1-w0,&#39;pseudodiag&#39;)</span></div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160; </div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;<span class="comment">!     C = X C&#39;, P=scratch</span></div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;      <span class="keyword">call </span>blas_gemm(<span class="stringliteral">&#39;N&#39;</span>,<span class="stringliteral">&#39;N&#39;</span>,ndim,ndim,ndim,1.d0,x,ndim,h,ndim,0.d0,p,ndim)</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;<span class="comment">!     save and output MO matrix in AO basis</span></div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;      h = p</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160; </div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacextb__scc__core.html#a3a50c09ff46dca0182ee74b31c3d2980">solve</a></div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160; </div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160; </div>
<div class="line"><a name="l00953"></a><span class="lineno"><a class="line" href="namespacextb__scc__core.html#a6464c6f815b95933767e307bbe7b34d1">  953</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacextb__scc__core.html#a6464c6f815b95933767e307bbe7b34d1">fermismear</a>(prt,norbs,nel,t,eig,occ,fod,e_fermi,s)</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__mctc__convert.html">xtb_mctc_convert</a>, <span class="keywordtype">only</span> : <a class="code" href="namespacextb__mctc__convert.html#a251a6230289b71aefe9a11d7df95213a">autoev</a></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;   <span class="keywordtype">use </span><a class="code" href="namespacextb__mctc__constants.html">xtb_mctc_constants</a>, <span class="keywordtype">only</span> : <a class="code" href="namespacextb__mctc__constants.html#a7ca103006dbf0afc6107ab58d3abfac2">kb</a></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: norbs</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: nel</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(in)</span>  :: eig(norbs)</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(out)</span> :: <a class="code" href="namespacextb__scc__core.html#a3226bc1823e27aac5c97598c51086ea4">occ</a>(norbs)</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(in)</span>  :: t</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(out)</span> :: fod</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(out)</span> :: e_fermi</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;   <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span>  :: prt</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160; </div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>) :: boltz,bkt,occt,total_number,thr</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>) :: total_dfermi,dfermifunct,fermifunct,s,change_fermi</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160; </div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;   parameter(boltz = <a class="code" href="namespacextb__mctc__constants.html#a7ca103006dbf0afc6107ab58d3abfac2">kb</a>*<a class="code" href="namespacextb__mctc__convert.html#a251a6230289b71aefe9a11d7df95213a">autoev</a>)</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;   parameter(thr   = 1.d-9)</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;   <span class="keywordtype">integer</span> :: ncycle,i,j,m,k,i1,i2</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160; </div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;   bkt = boltz*t</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160; </div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;   e_fermi = 0.5*(eig(nel)+eig(nel+1))</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;   occt=nel</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160; </div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;   <span class="keywordflow">do</span> ncycle = 1, 200  <span class="comment">! this loop would be possible instead of gotos</span></div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;      total_number = 0.0</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;      total_dfermi = 0.0</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;      <span class="keywordflow">do</span> i = 1, norbs</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;         fermifunct = 0.0</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;         <span class="keywordflow">if</span>((eig(i)-e_fermi)/bkt.lt.50) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;            fermifunct = 1.0/(exp((eig(i)-e_fermi)/bkt)+1.0)</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;            dfermifunct = exp((eig(i)-e_fermi)/bkt) / &amp;</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;            &amp;       (bkt*(exp((eig(i)-e_fermi)/bkt)+1.0)**2)</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;         <span class="keywordflow">else</span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;            dfermifunct = 0.0</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;<span class="keywordflow">         end if</span></div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;         <a class="code" href="namespacextb__scc__core.html#a3226bc1823e27aac5c97598c51086ea4">occ</a>(i) = fermifunct</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;         total_number = total_number + fermifunct</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;         total_dfermi = total_dfermi + dfermifunct</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;      change_fermi = (occt-total_number)/total_dfermi</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;      e_fermi = e_fermi+change_fermi</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;      <span class="keywordflow">if</span> (abs(occt-total_number).le.thr) <span class="keywordflow">exit</span></div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160; </div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;   fod=0</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;   s  =0</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;   <span class="keywordflow">do</span> i=1,norbs</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="namespacextb__scc__core.html#a3226bc1823e27aac5c97598c51086ea4">occ</a>(i).gt.thr.and.1.0d00-<a class="code" href="namespacextb__scc__core.html#a3226bc1823e27aac5c97598c51086ea4">occ</a>(i).gt.thr) &amp;</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;      &amp;   s=s+<a class="code" href="namespacextb__scc__core.html#a3226bc1823e27aac5c97598c51086ea4">occ</a>(i)*log(<a class="code" href="namespacextb__scc__core.html#a3226bc1823e27aac5c97598c51086ea4">occ</a>(i))+(1.0d0-<a class="code" href="namespacextb__scc__core.html#a3226bc1823e27aac5c97598c51086ea4">occ</a>(i))*log(1.0d00-<a class="code" href="namespacextb__scc__core.html#a3226bc1823e27aac5c97598c51086ea4">occ</a>(i))</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;      <span class="keywordflow">if</span> (eig(i).lt.e_fermi) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;         fod=fod+1.0d0-<a class="code" href="namespacextb__scc__core.html#a3226bc1823e27aac5c97598c51086ea4">occ</a>(i)</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;         fod=fod+      <a class="code" href="namespacextb__scc__core.html#a3226bc1823e27aac5c97598c51086ea4">occ</a>(i)</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;   s=s*<a class="code" href="namespacextb__mctc__constants.html#a7ca103006dbf0afc6107ab58d3abfac2">kb</a>*t</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160; </div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;   <span class="keywordflow">if</span> (prt) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;      <span class="keyword">write</span>(*,<span class="stringliteral">&#39;(&#39;</span><span class="stringliteral">&#39; t,e(fermi),nfod : &#39;</span><span class="stringliteral">&#39;,2f10.3,f10.6)&#39;</span>) t,e_fermi,fod</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160; </div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacextb__scc__core.html#a6464c6f815b95933767e307bbe7b34d1">fermismear</a></div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160; </div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160; </div>
<div class="line"><a name="l01018"></a><span class="lineno"><a class="line" href="namespacextb__scc__core.html#a3226bc1823e27aac5c97598c51086ea4"> 1018</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacextb__scc__core.html#a3226bc1823e27aac5c97598c51086ea4">occ</a>(ndim,nel,nopen,ihomo,focc)</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;   <span class="keywordtype">integer</span>  :: nel</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;   <span class="keywordtype">integer</span>  :: nopen</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;   <span class="keywordtype">integer</span>  :: ndim</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;   <span class="keywordtype">integer</span>  :: ihomo</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>) :: focc(ndim)</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;   <span class="keywordtype">integer</span>  :: i,na,nb</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160; </div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;   focc=0</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;<span class="comment">!  even nel</span></div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;   <span class="keywordflow">if</span>(mod(nel,2).eq.0)<span class="keywordflow">then</span></div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;      ihomo=nel/2</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;      <span class="keywordflow">do</span> i=1,ihomo</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;         focc(i)=2.0d0</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;      <span class="keywordflow">if</span>(2*ihomo.ne.nel) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;         ihomo=ihomo+1</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;         focc(ihomo)=1.0d0</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;         <span class="keywordflow">if</span>(nopen.eq.0)nopen=1</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;      <span class="keywordflow">if</span>(nopen.gt.1)<span class="keywordflow">then</span></div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;         <span class="keywordflow">do</span> i=1,nopen/2</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;            focc(ihomo-i+1)=focc(ihomo-i+1)-1.0</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;            focc(ihomo+i)=focc(ihomo+i)+1.0</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;<span class="keywordflow">         enddo</span></div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;<span class="comment">!  odd nel</span></div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;      na=nel/2+(nopen-1)/2+1</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;      nb=nel/2-(nopen-1)/2</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;      <span class="keywordflow">do</span> i=1,na</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;         focc(i)=focc(i)+1.</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;      <span class="keywordflow">do</span> i=1,nb</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;         focc(i)=focc(i)+1.</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160; </div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;   <span class="keywordflow">do</span> i=1,ndim</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;      <span class="keywordflow">if</span>(focc(i).gt.0.99) ihomo=i</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160; </div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacextb__scc__core.html#a3226bc1823e27aac5c97598c51086ea4">occ</a></div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160; </div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160; </div>
<div class="line"><a name="l01063"></a><span class="lineno"><a class="line" href="namespacextb__scc__core.html#aac06c643c8cf37ba0337ace78508ab19"> 1063</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacextb__scc__core.html#aac06c643c8cf37ba0337ace78508ab19">occu</a>(ndim,nel,nopen,ihomoa,ihomob,focca,foccb)</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;   <span class="keywordtype">integer</span>  :: nel</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;   <span class="keywordtype">integer</span>  :: nopen</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;   <span class="keywordtype">integer</span>  :: ndim</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;   <span class="keywordtype">integer</span>  :: ihomoa</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;   <span class="keywordtype">integer</span>  :: ihomob</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>) :: focca(ndim)</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>) :: foccb(ndim)</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;   <span class="keywordtype">integer</span>  :: focc(ndim)</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;   <span class="keywordtype">integer</span>  :: i,na,nb,ihomo</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160; </div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;   focc=0</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;   focca=0</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;   foccb=0</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;<span class="comment">!  even nel</span></div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;   <span class="keywordflow">if</span>(mod(nel,2).eq.0)<span class="keywordflow">then</span></div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;      ihomo=nel/2</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;      <span class="keywordflow">do</span> i=1,ihomo</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;         focc(i)=2</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;      <span class="keywordflow">if</span>(2*ihomo.ne.nel) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;         ihomo=ihomo+1</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;         focc(ihomo)=1</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;         <span class="keywordflow">if</span>(nopen.eq.0)nopen=1</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;      <span class="keywordflow">if</span>(nopen.gt.1)<span class="keywordflow">then</span></div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;         <span class="keywordflow">do</span> i=1,nopen/2</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;            focc(ihomo-i+1)=focc(ihomo-i+1)-1</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;            focc(ihomo+i)=focc(ihomo+i)+1</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;<span class="keywordflow">         enddo</span></div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;<span class="comment">!  odd nel</span></div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;      na=nel/2+(nopen-1)/2+1</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;      nb=nel/2-(nopen-1)/2</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;      <span class="keywordflow">do</span> i=1,na</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;         focc(i)=focc(i)+1</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;      <span class="keywordflow">do</span> i=1,nb</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;         focc(i)=focc(i)+1</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160; </div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;   <span class="keywordflow">do</span> i=1,ndim</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;      <span class="keywordflow">if</span>(focc(i).eq.2)<span class="keywordflow">then</span></div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;         focca(i)=1.0d0</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;         foccb(i)=1.0d0</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;      <span class="keywordflow">if</span>(focc(i).eq.1)focca(i)=1.0d0</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160; </div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;   ihomoa=0</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;   ihomob=0</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;   <span class="keywordflow">do</span> i=1,ndim</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;      <span class="keywordflow">if</span>(focca(i).gt.0.99) ihomoa=i</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;      <span class="keywordflow">if</span>(foccb(i).gt.0.99) ihomob=i</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160; </div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacextb__scc__core.html#aac06c643c8cf37ba0337ace78508ab19">occu</a></div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160; </div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160; </div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;<span class="comment">! C: MO coefficient</span></div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;<span class="comment">! X: scratch</span></div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;<span class="comment">! P  dmat</span></div>
<div class="line"><a name="l01128"></a><span class="lineno"><a class="line" href="namespacextb__scc__core.html#af5c3cd803d403c23fc0ae9c2eb1229c6"> 1128</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacextb__scc__core.html#af5c3cd803d403c23fc0ae9c2eb1229c6">dmat</a>(ndim,focc,C,P)</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: ndim</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(in)</span>  :: focc(:)</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(in)</span>  :: c(:,:)</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(out)</span> :: p(:,:)</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;   <span class="keywordtype">integer</span> :: i,m</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">allocatable</span> :: ptmp(:,:)</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160; </div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;   <span class="keyword">allocate</span>(ptmp(ndim,ndim))</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;   <span class="comment">! acc enter data create(Ptmp(:,:)) copyin(C(:, :), focc(:), P(:, :))</span></div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;   <span class="comment">! acc kernels default(present)</span></div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;   ptmp = 0.0_wp</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;   <span class="comment">! acc end kernels</span></div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160; </div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;   <span class="comment">! acc parallel</span></div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;   <span class="comment">! acc loop gang collapse(2)</span></div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;   <span class="keywordflow">do</span> m=1,ndim</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;      <span class="keywordflow">do</span> i=1,ndim</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;         ptmp(i,m)=c(i,m)*focc(m)</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;   <span class="comment">! acc end parallel</span></div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;   <span class="comment">! acc update host(Ptmp)</span></div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;   <span class="keyword">call </span>mctc_gemm(c, ptmp, p, transb=<span class="stringliteral">&#39;t&#39;</span>)</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;   <span class="comment">! acc exit data copyout(P(:,:)) delete(C(:,:), focc(:), Ptmp(:, :))</span></div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160; </div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;   <span class="keyword">deallocate</span>(ptmp)</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160; </div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacextb__scc__core.html#af5c3cd803d403c23fc0ae9c2eb1229c6">dmat</a></div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160; </div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160; </div>
<div class="line"><a name="l01159"></a><span class="lineno"><a class="line" href="namespacextb__scc__core.html#a2cc45bad34d8ad8fc414f3a2929c4d54"> 1159</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacextb__scc__core.html#a2cc45bad34d8ad8fc414f3a2929c4d54">get_wiberg</a>(n,ndim,at,xyz,P,S,wb,fila2)</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: n,ndim,at(n)</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(in)</span>  :: xyz(3,n)</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(in)</span>  :: p(ndim,ndim)</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(in)</span>  :: s(ndim,ndim)</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(out)</span> :: wb (n,n)</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: fila2(:,:)</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160; </div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">allocatable</span> :: ptmp(:,:)</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>) xsum,rab</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;   <span class="keywordtype">integer</span> i,j,k,m</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160; </div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;   <span class="keyword">allocate</span>(ptmp(ndim,ndim))</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;   <span class="keyword">call </span>blas_gemm(<span class="stringliteral">&#39;N&#39;</span>,<span class="stringliteral">&#39;N&#39;</span>,ndim,ndim,ndim,1.0d0,p,ndim,s,ndim,0.0d0,ptmp,ndim)</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;   wb = 0</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;   <span class="keywordflow">do</span> i = 1, n</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;      <span class="keywordflow">do</span> j = 1, i-1</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;         xsum = 0.0_wp</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;         rab = sum((xyz(:,i) - xyz(:,j))**2)</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;         <span class="keywordflow">if</span>(rab &lt; 100.0_wp)<span class="keywordflow">then</span></div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;            <span class="keywordflow">do</span> k = fila2(1,i), fila2(2,i) <span class="comment">! AOs on atom i</span></div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;               <span class="keywordflow">do</span> m = fila2(1,j), fila2(2,j) <span class="comment">! AOs on atom j</span></div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;                  xsum = xsum + ptmp(k,m)*ptmp(m,k)</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;<span class="keywordflow">               enddo</span></div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;<span class="keywordflow">            enddo</span></div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;         wb(i,j) = xsum</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;         wb(j,i) = xsum</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;   <span class="keyword">deallocate</span>(ptmp)</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160; </div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacextb__scc__core.html#a2cc45bad34d8ad8fc414f3a2929c4d54">get_wiberg</a></div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160; </div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160; </div>
<div class="line"><a name="l01195"></a><span class="lineno"><a class="line" href="namespacextb__scc__core.html#a965fd5bf899e797e7b4cf266748f6701"> 1195</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacextb__scc__core.html#a965fd5bf899e797e7b4cf266748f6701">mpopall</a>(n,nao,aoat,S,P,qao,q)</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;   <span class="keywordtype">integer</span> nao,n,aoat(nao)</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>)  s (nao,nao)</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>)  p (nao,nao)</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>)  qao(nao),q(n),ps</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160; </div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;   <span class="keywordtype">integer</span> i,j,ii,jj,ij,is,js</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160; </div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;   q  = 0</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;   qao= 0</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;   <span class="keywordflow">do</span> i=1,nao</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;      ii=aoat(i)</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;      <span class="keywordflow">do</span> j=1,i-1</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;         jj=aoat(j)</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;         ps=p(j,i)*s(j,i)</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;         q(ii)=q(ii)+ps</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;         q(jj)=q(jj)+ps</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;         qao(i)=qao(i)+ps</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;         qao(j)=qao(j)+ps</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;      ps=p(i,i)*s(i,i)</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;      q(ii)=q(ii)+ps</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;      qao(i)=qao(i)+ps</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160; </div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacextb__scc__core.html#a965fd5bf899e797e7b4cf266748f6701">mpopall</a></div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160; </div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160; </div>
<div class="line"><a name="l01224"></a><span class="lineno"><a class="line" href="namespacextb__scc__core.html#a134b152bc9c2f94b1260a248e8fb4a1f"> 1224</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacextb__scc__core.html#a134b152bc9c2f94b1260a248e8fb4a1f">mpop0</a>(n,nao,aoat,S,P,q)</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;   <span class="keywordtype">integer</span> nao,n,aoat(nao)</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>)  s (nao,nao)</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>)  p (nao,nao)</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>)  q(n),ps</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160; </div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;   <span class="keywordtype">integer</span> i,j,ii,jj,ij,is,js</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160; </div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;   q = 0</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;   <span class="keywordflow">do</span> i=1,nao</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;      ii=aoat(i)</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;      <span class="keywordflow">do</span> j=1,i-1</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;         jj=aoat(j)</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;         ps=p(j,i)*s(j,i)</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;         q(ii)=q(ii)+ps</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;         q(jj)=q(jj)+ps</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;      ps=p(i,i)*s(i,i)</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;      q(ii)=q(ii)+ps</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160; </div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacextb__scc__core.html#a134b152bc9c2f94b1260a248e8fb4a1f">mpop0</a></div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160; </div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160; </div>
<div class="line"><a name="l01249"></a><span class="lineno"><a class="line" href="namespacextb__scc__core.html#a321910253246c2a7505f7e1fcaeaa5bf"> 1249</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacextb__scc__core.html#a321910253246c2a7505f7e1fcaeaa5bf">mpopao</a>(n,nao,S,P,qao)</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;   <span class="keywordtype">integer</span> nao,n</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>)  s (nao,nao)</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>)  p (nao,nao)</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>)  qao(nao),ps</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160; </div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;   <span class="keywordtype">integer</span> i,j</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160; </div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;   qao = 0</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;   <span class="keywordflow">do</span> i=1,nao</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;      <span class="keywordflow">do</span> j=1,i-1</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;         ps=p(j,i)*s(j,i)</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;         qao(i)=qao(i)+ps</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;         qao(j)=qao(j)+ps</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;      ps=p(i,i)*s(i,i)</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;      qao(i)=qao(i)+ps</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160; </div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacextb__scc__core.html#a321910253246c2a7505f7e1fcaeaa5bf">mpopao</a></div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160; </div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160; </div>
<div class="line"><a name="l01272"></a><span class="lineno"><a class="line" href="namespacextb__scc__core.html#a7b41a4ff7431082309e438ba754461f3"> 1272</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacextb__scc__core.html#a7b41a4ff7431082309e438ba754461f3">mpop</a>(n,nao,aoat,lao,S,P,q,ql)</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;   <span class="keywordtype">integer</span> nao,n,aoat(nao),lao(nao)</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>)  s (nao,nao)</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>)  p (nao,nao)</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>)  q(n),ps</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>)  ql(3,n)</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160; </div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;   <span class="keywordtype">integer</span> i,j,ii,jj,ij,is,js,<a class="code" href="namespacextb__scc__core.html#af36b4f9c033f8f02df6cf7ae6c4b4513">mmm</a>(20)</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;   <span class="keyword">data</span>    <a class="code" href="namespacextb__scc__core.html#af36b4f9c033f8f02df6cf7ae6c4b4513">mmm</a>/1,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4/</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160; </div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;   ql= 0</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;   q = 0</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;   <span class="keywordflow">do</span> i=1,nao</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;      ii=aoat(i)</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;      is=<a class="code" href="namespacextb__scc__core.html#af36b4f9c033f8f02df6cf7ae6c4b4513">mmm</a>(lao(i))</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;      <span class="keywordflow">do</span> j=1,i-1</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;         jj=aoat(j)</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;         js=<a class="code" href="namespacextb__scc__core.html#af36b4f9c033f8f02df6cf7ae6c4b4513">mmm</a>(lao(j))</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;         ps=p(j,i)*s(j,i)</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;         q(ii)=q(ii)+ps</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;         q(jj)=q(jj)+ps</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;         ql(is,ii)=ql(is,ii)+ps</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;         ql(js,jj)=ql(js,jj)+ps</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;      ps=p(i,i)*s(i,i)</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;      q(ii)=q(ii)+ps</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;      ql(is,ii)=ql(is,ii)+ps</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160; </div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacextb__scc__core.html#a7b41a4ff7431082309e438ba754461f3">mpop</a></div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160; </div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160; </div>
<div class="line"><a name="l01305"></a><span class="lineno"><a class="line" href="namespacextb__scc__core.html#aef6343e2d48902c11b8a14602aec2971"> 1305</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacextb__scc__core.html#aef6343e2d48902c11b8a14602aec2971">mpopsh</a>(n,nao,nshell,ao2sh,S,P,qsh)</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;   <span class="keywordtype">integer</span> nao,n,nshell,ao2sh(nao)</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>)  s (nao,nao)</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>)  p (nao,nao)</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>)  qsh(nshell),ps</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160; </div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;   <span class="keywordtype">integer</span> i,j,ii,jj,ij</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160; </div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;   qsh=0</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;   <span class="keywordflow">do</span> i=1,nao</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;      ii =ao2sh(i)</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;      <span class="keywordflow">do</span> j=1,i-1</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;         jj =ao2sh(j)</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;         ps=p(j,i)*s(j,i)</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;         qsh(ii)=qsh(ii)+ps</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;         qsh(jj)=qsh(jj)+ps</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;      ps=p(i,i)*s(i,i)</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;      qsh(ii)=qsh(ii)+ps</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160; </div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacextb__scc__core.html#aef6343e2d48902c11b8a14602aec2971">mpopsh</a></div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160; </div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160; </div>
<div class="line"><a name="l01329"></a><span class="lineno"><a class="line" href="namespacextb__scc__core.html#a59b1e6be65cf0c0bf82cae50bf40000c"> 1329</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacextb__scc__core.html#a59b1e6be65cf0c0bf82cae50bf40000c">qsh2qat</a>(ash,qsh,qat)</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: ash(:)</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>), <span class="keywordtype">intent(in)</span> :: qsh(:)</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>), <span class="keywordtype">intent(out)</span> :: qat(:)</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160; </div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;   <span class="keywordtype">integer</span> :: ish</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160; </div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;   qat(:) = 0.0_wp</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;   <span class="keywordflow">do</span> ish = 1, <span class="keyword">size</span>(qsh)</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;      qat(ash(ish)) = qat(ash(ish)) + qsh(ish)</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160; </div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacextb__scc__core.html#a59b1e6be65cf0c0bf82cae50bf40000c">qsh2qat</a></div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160; </div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160; </div>
<div class="line"><a name="l01345"></a><span class="lineno"><a class="line" href="namespacextb__scc__core.html#af6e7712a4d49d56302e167ba6034da6f"> 1345</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacextb__scc__core.html#af6e7712a4d49d56302e167ba6034da6f">lpop</a>(n,nao,aoat,lao,occ,C,f,q,ql)</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;   <span class="keywordtype">integer</span> nao,n,aoat(nao),lao(nao)</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>)  c (nao,nao)</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>)  <a class="code" href="namespacextb__scc__core.html#a3226bc1823e27aac5c97598c51086ea4">occ</a>(nao)</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>)  q(n)</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>)  ql(3,n)</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>)  f</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160; </div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;   <span class="keywordtype">integer</span> i,j,ii,jj,js,<a class="code" href="namespacextb__scc__core.html#af36b4f9c033f8f02df6cf7ae6c4b4513">mmm</a>(20)</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;   <span class="keyword">data</span>    <a class="code" href="namespacextb__scc__core.html#af36b4f9c033f8f02df6cf7ae6c4b4513">mmm</a>/1,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4/</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>)  cc</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160; </div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;   <span class="keywordflow">do</span> i=1,nao</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="namespacextb__scc__core.html#a3226bc1823e27aac5c97598c51086ea4">occ</a>(i).lt.1.d-8) cycle</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;      <span class="keywordflow">do</span> j=1,nao</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;         cc=f*c(j,i)*c(j,i)*<a class="code" href="namespacextb__scc__core.html#a3226bc1823e27aac5c97598c51086ea4">occ</a>(i)</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;         jj=aoat(j)</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;         js=<a class="code" href="namespacextb__scc__core.html#af36b4f9c033f8f02df6cf7ae6c4b4513">mmm</a>(lao(j))</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;         q(jj)=q(jj)+cc</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;         ql(js,jj)=ql(js,jj)+cc</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160; </div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacextb__scc__core.html#af6e7712a4d49d56302e167ba6034da6f">lpop</a></div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160; </div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160; </div>
<div class="line"><a name="l01372"></a><span class="lineno"><a class="line" href="namespacextb__scc__core.html#ae6c9babc8cddf9d13539ebbab3a46d1c"> 1372</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacextb__scc__core.html#ae6c9babc8cddf9d13539ebbab3a46d1c">iniqshell</a>(xtbData,n,at,z,nshell,q,qsh,gfn_method)</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;   <span class="keywordtype">type</span>(<a class="code" href="structxtb__xtb__data_1_1txtbdata.html">txtbdata</a>), <span class="keywordtype">intent(in)</span> :: xtbdata</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: n</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: at(n)</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: nshell</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: gfn_method</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(in)</span>  :: z(n)</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(in)</span>  :: q(n)</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(out)</span> :: qsh(nshell)</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>) :: zshell</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>) :: ntot,fracz</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;   <span class="keywordtype">integer</span>  :: i,j,k,m,l,ll(0:3),iat,lll,iver</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;   <span class="keyword">data</span> ll /1,3,5,7/</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160; </div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;   qsh = 0.0_wp</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160; </div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;   k=0</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;   <span class="keywordflow">do</span> i=1,n</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;      iat=at(i)</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;      ntot=-1.d-6</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;      <span class="keywordflow">do</span> m=1,xtbdata%nShell(iat)</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;         l=xtbdata%hamiltonian%angShell(m,iat)</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;         k=k+1</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;         zshell=xtbdata%hamiltonian%referenceOcc(m,iat)</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;         ntot=ntot+zshell</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;         <span class="keywordflow">if</span>(ntot.gt.z(i)) zshell=0</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;         fracz=zshell/z(i)</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;         qsh(k)=fracz*q(i)</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160; </div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacextb__scc__core.html#ae6c9babc8cddf9d13539ebbab3a46d1c">iniqshell</a></div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160; </div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160; </div>
<div class="line"><a name="l01406"></a><span class="lineno"><a class="line" href="namespacextb__scc__core.html#a83c6524ce5e445bf77857b79c238a8ff"> 1406</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacextb__scc__core.html#a83c6524ce5e445bf77857b79c238a8ff">setzshell</a>(xtbData,n,at,nshell,z,zsh,e,gfn_method)</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;   <span class="keywordtype">type</span>(<a class="code" href="structxtb__xtb__data_1_1txtbdata.html">txtbdata</a>), <span class="keywordtype">intent(in)</span> :: xtbdata</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: n</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: at(n)</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: nshell</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: gfn_method</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(in)</span>  :: z(n)</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(out)</span> :: zsh(nshell)</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;<span class="comment">!   integer, intent(out) :: ash(nshell)</span></div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;<span class="comment">!   integer, intent(out) :: lsh(nshell)</span></div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>),<span class="keywordtype">intent(out)</span> :: e</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160; </div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;<span class="keywordtype">   real</span>(<a class="code" href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">wp</a>)  ntot,fracz</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;   <span class="keywordtype">integer</span> i,j,k,m,l,ll(0:3),iat,lll,iver</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;   <span class="keyword">data</span> ll /1,3,5,7/</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160; </div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;   k=0</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;   e=0.0_wp</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;   <span class="keywordflow">do</span> i=1,n</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;      iat=at(i)</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;      ntot=-1.d-6</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;      <span class="keywordflow">do</span> m=1,xtbdata%nShell(iat)</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;         l=xtbdata%hamiltonian%angShell(m,iat)</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;         k=k+1</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;         zsh(k)=xtbdata%hamiltonian%referenceOcc(m,iat)</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;<span class="comment">!         lsh(k)=l</span></div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;<span class="comment">!         ash(k)=i</span></div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;         ntot=ntot+zsh(k)</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;         <span class="keywordflow">if</span>(ntot.gt.z(i)) zsh(k)=0</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;         e=e+xtbdata%hamiltonian%selfEnergy(m,iat)*zsh(k)</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160; </div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacextb__scc__core.html#a83c6524ce5e445bf77857b79c238a8ff">setzshell</a></div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160; </div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160; </div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;<span class="keyword">end module </span><a class="code" href="namespacextb__scc__core.html">xtb_scc_core</a></div>
<div class="ttc" id="aconstr_8f90_html_ae82fbacd108d547258e599e6ee56178b"><div class="ttname"><a href="constr_8f90.html#ae82fbacd108d547258e599e6ee56178b">omega</a></div><div class="ttdeci">real(wp) function omega(nat, xyz, i, j, k, l)</div><div class="ttdef"><b>Definition:</b> <a href="constr_8f90_source.html#l00777">constr.f90:778</a></div></div>
<div class="ttc" id="aconstrain__pot_8f90_html_ac62613d43f31c7bfa652ee80083b400b"><div class="ttname"><a href="constrain__pot_8f90.html#ac62613d43f31c7bfa652ee80083b400b">lin</a></div><div class="ttdeci">pure elemental integer function lin(i1, i2)</div><div class="ttdef"><b>Definition:</b> <a href="constrain__pot_8f90_source.html#l00078">constrain_pot.f90:79</a></div></div>
<div class="ttc" id="anamespacextb__aespot_html"><div class="ttname"><a href="namespacextb__aespot.html">xtb_aespot</a></div><div class="ttdef"><b>Definition:</b> <a href="aespot_8f90_source.html#l00018">aespot.f90:18</a></div></div>
<div class="ttc" id="anamespacextb__aespot_html_a05bf1200d30dce1fb402ae1ef8609d3a"><div class="ttname"><a href="namespacextb__aespot.html#a05bf1200d30dce1fb402ae1ef8609d3a">xtb_aespot::gfn2broyden_save</a></div><div class="ttdeci">subroutine gfn2broyden_save(n, istart, nbr, dipm, qp, q_in)</div><div class="ttdef"><b>Definition:</b> <a href="aespot_8f90_source.html#l01069">aespot.f90:1070</a></div></div>
<div class="ttc" id="anamespacextb__aespot_html_a10a8771cd9a6db96511bdd5f84c360d1"><div class="ttname"><a href="namespacextb__aespot.html#a10a8771cd9a6db96511bdd5f84c360d1">xtb_aespot::gfn2broyden_out</a></div><div class="ttdeci">subroutine gfn2broyden_out(n, istart, nbr, q_in, dipm, qp)</div><div class="ttdef"><b>Definition:</b> <a href="aespot_8f90_source.html#l01093">aespot.f90:1094</a></div></div>
<div class="ttc" id="anamespacextb__aespot_html_a49b3c4b26cb3479c91a54e16ca8dc168"><div class="ttname"><a href="namespacextb__aespot.html#a49b3c4b26cb3479c91a54e16ca8dc168">xtb_aespot::setvsdq</a></div><div class="ttdeci">subroutine setvsdq(aesData, nat, at, xyz, q, dipm, qp, gab3, gab5, vs, vd, vq)</div><div class="ttdef"><b>Definition:</b> <a href="aespot_8f90_source.html#l00448">aespot.f90:449</a></div></div>
<div class="ttc" id="anamespacextb__aespot_html_a7cea975ae11fb0b0b9ae8e0b61495d47"><div class="ttname"><a href="namespacextb__aespot.html#a7cea975ae11fb0b0b9ae8e0b61495d47">xtb_aespot::gfn2broyden_diff</a></div><div class="ttdeci">subroutine gfn2broyden_diff(n, istart, nbr, dipm, qp, q_in, dq)</div><div class="ttdef"><b>Definition:</b> <a href="aespot_8f90_source.html#l01047">aespot.f90:1048</a></div></div>
<div class="ttc" id="anamespacextb__aespot_html_ab85dc8fda19d2fc49468e845966e72a4"><div class="ttname"><a href="namespacextb__aespot.html#ab85dc8fda19d2fc49468e845966e72a4">xtb_aespot::aniso_electro</a></div><div class="ttdeci">subroutine aniso_electro(aesData, nat, at, xyz, q, dipm, qp, gab3, gab5, e, epol)</div><div class="ttdef"><b>Definition:</b> <a href="aespot_8f90_source.html#l00281">aespot.f90:282</a></div></div>
<div class="ttc" id="anamespacextb__aespot_html_ac7317133fd3c2f90fe508fb06e7acc7a"><div class="ttname"><a href="namespacextb__aespot.html#ac7317133fd3c2f90fe508fb06e7acc7a">xtb_aespot::mmompop</a></div><div class="ttdeci">subroutine mmompop(nat, nao, aoat2, xyz, p, s, dpint, qpint, dipm, qp)</div><div class="ttdef"><b>Definition:</b> <a href="aespot_8f90_source.html#l00136">aespot.f90:137</a></div></div>
<div class="ttc" id="anamespacextb__broyden_html"><div class="ttname"><a href="namespacextb__broyden.html">xtb_broyden</a></div><div class="ttdef"><b>Definition:</b> <a href="broyden_8f90_source.html#l00034">broyden.f90:34</a></div></div>
<div class="ttc" id="anamespacextb__broyden_html_ab8ea7338631bb6e5be77f76b32e5467c"><div class="ttname"><a href="namespacextb__broyden.html#ab8ea7338631bb6e5be77f76b32e5467c">xtb_broyden::broyden</a></div><div class="ttdeci">subroutine broyden(n, q, qlast, dq, dqlast, iter, maxiter, alpha, omega, df, u, a)</div><div class="ttdef"><b>Definition:</b> <a href="broyden_8f90_source.html#l00037">broyden.f90:39</a></div></div>
<div class="ttc" id="anamespacextb__disp__dftd4_html"><div class="ttname"><a href="namespacextb__disp__dftd4.html">xtb_disp_dftd4</a></div><div class="ttdef"><b>Definition:</b> <a href="dftd4_8F90_source.html#l00019">dftd4.F90:19</a></div></div>
<div class="ttc" id="anamespacextb__disp__dftd4_html_a885a7392a062b6c1231b6f6d5cc14bb7"><div class="ttname"><a href="namespacextb__disp__dftd4.html#a885a7392a062b6c1231b6f6d5cc14bb7">xtb_disp_dftd4::edisp_scc</a></div><div class="ttdeci">real(wp) function edisp_scc(dispm, nat, ndim, at, itbl, q, g_a, g_c, wdispmat, gw)</div><div class="ttdef"><b>Definition:</b> <a href="dftd4_8F90_source.html#l00812">dftd4.F90:813</a></div></div>
<div class="ttc" id="anamespacextb__disp__dftd4_html_ab5c7be6d2c0d30018b8fc446f517b527"><div class="ttname"><a href="namespacextb__disp__dftd4.html#ab5c7be6d2c0d30018b8fc446f517b527">xtb_disp_dftd4::disppot</a></div><div class="ttdeci">subroutine disppot(dispm, nat, ndim, at, itbl, q, g_a, g_c, wdispmat, gw, hdisp)</div><div class="ttdef"><b>Definition:</b> <a href="dftd4_8F90_source.html#l00726">dftd4.F90:727</a></div></div>
<div class="ttc" id="anamespacextb__embedding_html"><div class="ttname"><a href="namespacextb__embedding.html">xtb_embedding</a></div><div class="ttdef"><b>Definition:</b> <a href="embedding_8f90_source.html#l00018">embedding.f90:18</a></div></div>
<div class="ttc" id="anamespacextb__embedding_html_ac848381f507e87559fb4910371564751"><div class="ttname"><a href="namespacextb__embedding.html#ac848381f507e87559fb4910371564751">xtb_embedding::electro_pcem</a></div><div class="ttdeci">pure subroutine electro_pcem(nshell, dqsh, Vpc, es, scc)</div><div class="ttdef"><b>Definition:</b> <a href="embedding_8f90_source.html#l00261">embedding.f90:262</a></div></div>
<div class="ttc" id="anamespacextb__mctc__accuracy_html"><div class="ttname"><a href="namespacextb__mctc__accuracy.html">xtb_mctc_accuracy</a></div><div class="ttdoc">Numerical storage size parameters.</div><div class="ttdef"><b>Definition:</b> <a href="accuracy_8f90_source.html#l00019">accuracy.f90:19</a></div></div>
<div class="ttc" id="anamespacextb__mctc__accuracy_html_a8bb85237162b62dd2297a6ec2b11d954"><div class="ttname"><a href="namespacextb__mctc__accuracy.html#a8bb85237162b62dd2297a6ec2b11d954">xtb_mctc_accuracy::wp</a></div><div class="ttdeci">integer, parameter wp</div><div class="ttdoc">Wanted precision.</div><div class="ttdef"><b>Definition:</b> <a href="accuracy_8f90_source.html#l00031">accuracy.f90:31</a></div></div>
<div class="ttc" id="anamespacextb__mctc__accuracy_html_af8a3da98f40445db18ce006622ae46ca"><div class="ttname"><a href="namespacextb__mctc__accuracy.html#af8a3da98f40445db18ce006622ae46ca">xtb_mctc_accuracy::sp</a></div><div class="ttdeci">integer, parameter sp</div><div class="ttdoc">Single precision real numbers.</div><div class="ttdef"><b>Definition:</b> <a href="accuracy_8f90_source.html#l00025">accuracy.f90:25</a></div></div>
<div class="ttc" id="anamespacextb__mctc__blas_html"><div class="ttname"><a href="namespacextb__mctc__blas.html">xtb_mctc_blas</a></div><div class="ttdoc">Interfaces to BLAS.</div><div class="ttdef"><b>Definition:</b> <a href="blas_8f90_source.html#l00019">blas.f90:19</a></div></div>
<div class="ttc" id="anamespacextb__mctc__constants_html"><div class="ttname"><a href="namespacextb__mctc__constants.html">xtb_mctc_constants</a></div><div class="ttdef"><b>Definition:</b> <a href="mctc__constants_8f90_source.html#l00018">mctc_constants.f90:18</a></div></div>
<div class="ttc" id="anamespacextb__mctc__constants_html_a7ca103006dbf0afc6107ab58d3abfac2"><div class="ttname"><a href="namespacextb__mctc__constants.html#a7ca103006dbf0afc6107ab58d3abfac2">xtb_mctc_constants::kb</a></div><div class="ttdeci">real(wp), parameter, public kb</div><div class="ttdef"><b>Definition:</b> <a href="mctc__constants_8f90_source.html#l00035">mctc_constants.f90:35</a></div></div>
<div class="ttc" id="anamespacextb__mctc__convert_html"><div class="ttname"><a href="namespacextb__mctc__convert.html">xtb_mctc_convert</a></div><div class="ttdef"><b>Definition:</b> <a href="convert_8f90_source.html#l00018">convert.f90:18</a></div></div>
<div class="ttc" id="anamespacextb__mctc__convert_html_a251a6230289b71aefe9a11d7df95213a"><div class="ttname"><a href="namespacextb__mctc__convert.html#a251a6230289b71aefe9a11d7df95213a">xtb_mctc_convert::autoev</a></div><div class="ttdeci">real(wp), parameter, public autoev</div><div class="ttdef"><b>Definition:</b> <a href="convert_8f90_source.html#l00027">convert.f90:27</a></div></div>
<div class="ttc" id="anamespacextb__mctc__convert_html_a4b0d1ae04bd4514d581a066cd7c26993"><div class="ttname"><a href="namespacextb__mctc__convert.html#a4b0d1ae04bd4514d581a066cd7c26993">xtb_mctc_convert::aatoau</a></div><div class="ttdeci">real(wp), parameter, public aatoau</div><div class="ttdef"><b>Definition:</b> <a href="convert_8f90_source.html#l00025">convert.f90:25</a></div></div>
<div class="ttc" id="anamespacextb__mctc__convert_html_acdf2e027ee943efa9cc9a6b4701e3810"><div class="ttname"><a href="namespacextb__mctc__convert.html#acdf2e027ee943efa9cc9a6b4701e3810">xtb_mctc_convert::evtoau</a></div><div class="ttdeci">real(wp), parameter, public evtoau</div><div class="ttdef"><b>Definition:</b> <a href="convert_8f90_source.html#l00028">convert.f90:28</a></div></div>
<div class="ttc" id="anamespacextb__mctc__la_html"><div class="ttname"><a href="namespacextb__mctc__la.html">xtb_mctc_la</a></div><div class="ttdef"><b>Definition:</b> <a href="linalg_8f90_source.html#l00018">linalg.f90:18</a></div></div>
<div class="ttc" id="anamespacextb__mctc__lapack__eigensolve_html"><div class="ttname"><a href="namespacextb__mctc__lapack__eigensolve.html">xtb_mctc_lapack_eigensolve</a></div><div class="ttdoc">Wrapper for eigensolver routines.</div><div class="ttdef"><b>Definition:</b> <a href="eigensolve_8F90_source.html#l00020">eigensolve.F90:20</a></div></div>
<div class="ttc" id="anamespacextb__mctc__lapack_html"><div class="ttname"><a href="namespacextb__mctc__lapack.html">xtb_mctc_lapack</a></div><div class="ttdoc">Interfaces to LAPACK.</div><div class="ttdef"><b>Definition:</b> <a href="lapack_8f90_source.html#l00019">lapack.f90:19</a></div></div>
<div class="ttc" id="anamespacextb__scc__core_html"><div class="ttname"><a href="namespacextb__scc__core.html">xtb_scc_core</a></div><div class="ttdoc">general functions for core functionalities of the SCC</div><div class="ttdef"><b>Definition:</b> <a href="scc__core_8f90_source.html#l00019">scc_core.f90:19</a></div></div>
<div class="ttc" id="anamespacextb__scc__core_html_a1214bb696e4b74ce8080805213d13adb"><div class="ttname"><a href="namespacextb__scc__core.html#a1214bb696e4b74ce8080805213d13adb">xtb_scc_core::buildisotropich1</a></div><div class="ttdeci">subroutine buildisotropich1(n, at, ndim, nshell, nmat, matlist, H, H0, S, shellShift, aoat2, ao2sh)</div><div class="ttdoc">build isotropic H1/Fockian</div><div class="ttdef"><b>Definition:</b> <a href="scc__core_8f90_source.html#l00110">scc_core.f90:112</a></div></div>
<div class="ttc" id="anamespacextb__scc__core_html_a134b152bc9c2f94b1260a248e8fb4a1f"><div class="ttname"><a href="namespacextb__scc__core.html#a134b152bc9c2f94b1260a248e8fb4a1f">xtb_scc_core::mpop0</a></div><div class="ttdeci">subroutine, public mpop0(n, nao, aoat, S, P, q)</div><div class="ttdoc">Mulliken pop.</div><div class="ttdef"><b>Definition:</b> <a href="scc__core_8f90_source.html#l01224">scc_core.f90:1225</a></div></div>
<div class="ttc" id="anamespacextb__scc__core_html_a136cd39a28befead4338400b448fddc3"><div class="ttname"><a href="namespacextb__scc__core.html#a136cd39a28befead4338400b448fddc3">xtb_scc_core::h0scal</a></div><div class="ttdeci">subroutine, public h0scal(hData, il, jl, izp, jzp, valaoi, valaoj, km)</div><div class="ttdoc">H0 off-diag scaling.</div><div class="ttdef"><b>Definition:</b> <a href="scc__core_8f90_source.html#l00613">scc_core.f90:614</a></div></div>
<div class="ttc" id="anamespacextb__scc__core_html_a242df5f670f054274ad6af4fc5b68a7c"><div class="ttname"><a href="namespacextb__scc__core.html#a242df5f670f054274ad6af4fc5b68a7c">xtb_scc_core::electro</a></div><div class="ttdeci">pure subroutine, public electro(n, at, nbf, nshell, ies, H0, P, dq, dqsh, es, scc)</div><div class="ttdef"><b>Definition:</b> <a href="scc__core_8f90_source.html#l00655">scc_core.f90:656</a></div></div>
<div class="ttc" id="anamespacextb__scc__core_html_a283a0b5552f059cc1b825cf6f29bc47b"><div class="ttname"><a href="namespacextb__scc__core.html#a283a0b5552f059cc1b825cf6f29bc47b">xtb_scc_core::build_h0</a></div><div class="ttdeci">subroutine, public build_h0(hData, H0, n, at, ndim, nmat, matlist, xyz, selfEnergy, S, aoat2, lao2, valao2, aoexp, ao2sh)</div><div class="ttdef"><b>Definition:</b> <a href="scc__core_8f90_source.html#l00050">scc_core.f90:52</a></div></div>
<div class="ttc" id="anamespacextb__scc__core_html_a2cc45bad34d8ad8fc414f3a2929c4d54"><div class="ttname"><a href="namespacextb__scc__core.html#a2cc45bad34d8ad8fc414f3a2929c4d54">xtb_scc_core::get_wiberg</a></div><div class="ttdeci">subroutine, public get_wiberg(n, ndim, at, xyz, P, S, wb, fila2)</div><div class="ttdef"><b>Definition:</b> <a href="scc__core_8f90_source.html#l01159">scc_core.f90:1160</a></div></div>
<div class="ttc" id="anamespacextb__scc__core_html_a321910253246c2a7505f7e1fcaeaa5bf"><div class="ttname"><a href="namespacextb__scc__core.html#a321910253246c2a7505f7e1fcaeaa5bf">xtb_scc_core::mpopao</a></div><div class="ttdeci">subroutine, public mpopao(n, nao, S, P, qao)</div><div class="ttdoc">Mulliken AO pop.</div><div class="ttdef"><b>Definition:</b> <a href="scc__core_8f90_source.html#l01249">scc_core.f90:1250</a></div></div>
<div class="ttc" id="anamespacextb__scc__core_html_a3226bc1823e27aac5c97598c51086ea4"><div class="ttname"><a href="namespacextb__scc__core.html#a3226bc1823e27aac5c97598c51086ea4">xtb_scc_core::occ</a></div><div class="ttdeci">subroutine, public occ(ndim, nel, nopen, ihomo, focc)</div><div class="ttdef"><b>Definition:</b> <a href="scc__core_8f90_source.html#l01018">scc_core.f90:1019</a></div></div>
<div class="ttc" id="anamespacextb__scc__core_html_a3a50c09ff46dca0182ee74b31c3d2980"><div class="ttname"><a href="namespacextb__scc__core.html#a3a50c09ff46dca0182ee74b31c3d2980">xtb_scc_core::solve</a></div><div class="ttdeci">subroutine, public solve(full, ndim, ihomo, acc, H, S, X, P, e, fail)</div><div class="ttdef"><b>Definition:</b> <a href="scc__core_8f90_source.html#l00874">scc_core.f90:875</a></div></div>
<div class="ttc" id="anamespacextb__scc__core_html_a3e0e142b640924088ca8b0ab266dd5e0"><div class="ttname"><a href="namespacextb__scc__core.html#a3e0e142b640924088ca8b0ab266dd5e0">xtb_scc_core::scc</a></div><div class="ttdeci">subroutine, public scc(env, xtbData, solver, n, nel, nopen, ndim, ndp, nqp, nmat, nshell, at, matlist, mdlst, mqlst, aoat2, ao2sh, ash, q, dipm, qp, qq, qlmom, qsh, zsh, xyz, aes, cm5, cm5a, gborn, solvation, scD4, broy, broydamp, damp0, pcem, shellShift, externShift, et, focc, focca, foccb, efa, efb, eel, ees, eaes, epol, ed, epcem, egap, emo, ihomo, ihomoa, ihomob, H0, H, S, dpint, qpint, X, P, ies, maxiter, startpdiag, scfconv, qconv, minpr, pr, fail, jter)</div><div class="ttdoc">self consistent charge iterator</div><div class="ttdef"><b>Definition:</b> <a href="scc__core_8f90_source.html#l00229">scc_core.f90:243</a></div></div>
<div class="ttc" id="anamespacextb__scc__core_html_a49f0c6e6ceb820a75cb334ab646d92ed"><div class="ttname"><a href="namespacextb__scc__core.html#a49f0c6e6ceb820a75cb334ab646d92ed">xtb_scc_core::setespot</a></div><div class="ttdeci">pure subroutine setespot(nshell, qsh, jmat, shellShift)</div><div class="ttdef"><b>Definition:</b> <a href="scc__core_8f90_source.html#l00729">scc_core.f90:730</a></div></div>
<div class="ttc" id="anamespacextb__scc__core_html_a59b1e6be65cf0c0bf82cae50bf40000c"><div class="ttname"><a href="namespacextb__scc__core.html#a59b1e6be65cf0c0bf82cae50bf40000c">xtb_scc_core::qsh2qat</a></div><div class="ttdeci">subroutine, public qsh2qat(ash, qsh, qat)</div><div class="ttdef"><b>Definition:</b> <a href="scc__core_8f90_source.html#l01329">scc_core.f90:1330</a></div></div>
<div class="ttc" id="anamespacextb__scc__core_html_a6464c6f815b95933767e307bbe7b34d1"><div class="ttname"><a href="namespacextb__scc__core.html#a6464c6f815b95933767e307bbe7b34d1">xtb_scc_core::fermismear</a></div><div class="ttdeci">subroutine, public fermismear(prt, norbs, nel, t, eig, occ, fod, e_fermi, s)</div><div class="ttdef"><b>Definition:</b> <a href="scc__core_8f90_source.html#l00953">scc_core.f90:954</a></div></div>
<div class="ttc" id="anamespacextb__scc__core_html_a7b41a4ff7431082309e438ba754461f3"><div class="ttname"><a href="namespacextb__scc__core.html#a7b41a4ff7431082309e438ba754461f3">xtb_scc_core::mpop</a></div><div class="ttdeci">subroutine, public mpop(n, nao, aoat, lao, S, P, q, ql)</div><div class="ttdoc">Mulliken pop.</div><div class="ttdef"><b>Definition:</b> <a href="scc__core_8f90_source.html#l01272">scc_core.f90:1273</a></div></div>
<div class="ttc" id="anamespacextb__scc__core_html_a83c6524ce5e445bf77857b79c238a8ff"><div class="ttname"><a href="namespacextb__scc__core.html#a83c6524ce5e445bf77857b79c238a8ff">xtb_scc_core::setzshell</a></div><div class="ttdeci">subroutine, public setzshell(xtbData, n, at, nshell, z, zsh, e, gfn_method)</div><div class="ttdef"><b>Definition:</b> <a href="scc__core_8f90_source.html#l01406">scc_core.f90:1407</a></div></div>
<div class="ttc" id="anamespacextb__scc__core_html_a965fd5bf899e797e7b4cf266748f6701"><div class="ttname"><a href="namespacextb__scc__core.html#a965fd5bf899e797e7b4cf266748f6701">xtb_scc_core::mpopall</a></div><div class="ttdeci">subroutine, public mpopall(n, nao, aoat, S, P, qao, q)</div><div class="ttdoc">Mulliken pop + AO pop.</div><div class="ttdef"><b>Definition:</b> <a href="scc__core_8f90_source.html#l01195">scc_core.f90:1196</a></div></div>
<div class="ttc" id="anamespacextb__scc__core_html_aa0ad51cc910549eaec45c7a3374b9661"><div class="ttname"><a href="namespacextb__scc__core.html#aa0ad51cc910549eaec45c7a3374b9661">xtb_scc_core::addanisotropich1</a></div><div class="ttdeci">subroutine addanisotropich1(n, at, ndim, nshell, nmat, ndp, nqp, matlist, mdlst, mqlst, H, S, dpint, qpint, vs, vd, vq, aoat2, ao2sh)</div><div class="ttdoc">build anisotropic H1/Fockian</div><div class="ttdef"><b>Definition:</b> <a href="scc__core_8f90_source.html#l00150">scc_core.f90:152</a></div></div>
<div class="ttc" id="anamespacextb__scc__core_html_aac06c643c8cf37ba0337ace78508ab19"><div class="ttname"><a href="namespacextb__scc__core.html#aac06c643c8cf37ba0337ace78508ab19">xtb_scc_core::occu</a></div><div class="ttdeci">subroutine, public occu(ndim, nel, nopen, ihomoa, ihomob, focca, foccb)</div><div class="ttdef"><b>Definition:</b> <a href="scc__core_8f90_source.html#l01063">scc_core.f90:1064</a></div></div>
<div class="ttc" id="anamespacextb__scc__core_html_ab589fe59f0960d1e9adf8ef9d48a6e45"><div class="ttname"><a href="namespacextb__scc__core.html#ab589fe59f0960d1e9adf8ef9d48a6e45">xtb_scc_core::shellpoly</a></div><div class="ttdeci">pure real(wp) function, public shellpoly(iPoly, jPoly, iRad, jRad, xyz1, xyz2)</div><div class="ttdef"><b>Definition:</b> <a href="scc__core_8f90_source.html#l00697">scc_core.f90:698</a></div></div>
<div class="ttc" id="anamespacextb__scc__core_html_ac01c578b81a798d30846c16f0f35d699"><div class="ttname"><a href="namespacextb__scc__core.html#ac01c578b81a798d30846c16f0f35d699">xtb_scc_core::solve4</a></div><div class="ttdeci">subroutine, public solve4(full, ndim, ihomo, acc, H, S, X, P, e, fail)</div><div class="ttdef"><b>Definition:</b> <a href="scc__core_8f90_source.html#l00772">scc_core.f90:773</a></div></div>
<div class="ttc" id="anamespacextb__scc__core_html_acd449c8351fbbaacd8b4a82d211faffd"><div class="ttname"><a href="namespacextb__scc__core.html#acd449c8351fbbaacd8b4a82d211faffd">xtb_scc_core::addtoshellshift</a></div><div class="ttdeci">pure subroutine addtoshellshift(shellAtom, atomicShift, shellShift)</div><div class="ttdef"><b>Definition:</b> <a href="scc__core_8f90_source.html#l00749">scc_core.f90:750</a></div></div>
<div class="ttc" id="anamespacextb__scc__core_html_ae6c9babc8cddf9d13539ebbab3a46d1c"><div class="ttname"><a href="namespacextb__scc__core.html#ae6c9babc8cddf9d13539ebbab3a46d1c">xtb_scc_core::iniqshell</a></div><div class="ttdeci">subroutine, public iniqshell(xtbData, n, at, z, nshell, q, qsh, gfn_method)</div><div class="ttdoc">atomic valence shell pops and total atomic energy</div><div class="ttdef"><b>Definition:</b> <a href="scc__core_8f90_source.html#l01372">scc_core.f90:1373</a></div></div>
<div class="ttc" id="anamespacextb__scc__core_html_aef6343e2d48902c11b8a14602aec2971"><div class="ttname"><a href="namespacextb__scc__core.html#aef6343e2d48902c11b8a14602aec2971">xtb_scc_core::mpopsh</a></div><div class="ttdeci">subroutine, public mpopsh(n, nao, nshell, ao2sh, S, P, qsh)</div><div class="ttdoc">Mulliken pop shell wise.</div><div class="ttdef"><b>Definition:</b> <a href="scc__core_8f90_source.html#l01305">scc_core.f90:1306</a></div></div>
<div class="ttc" id="anamespacextb__scc__core_html_af36b4f9c033f8f02df6cf7ae6c4b4513"><div class="ttname"><a href="namespacextb__scc__core.html#af36b4f9c033f8f02df6cf7ae6c4b4513">xtb_scc_core::mmm</a></div><div class="ttdeci">integer, dimension(20), parameter, private mmm</div><div class="ttdef"><b>Definition:</b> <a href="scc__core_8f90_source.html#l00042">scc_core.f90:42</a></div></div>
<div class="ttc" id="anamespacextb__scc__core_html_af5c3cd803d403c23fc0ae9c2eb1229c6"><div class="ttname"><a href="namespacextb__scc__core.html#af5c3cd803d403c23fc0ae9c2eb1229c6">xtb_scc_core::dmat</a></div><div class="ttdeci">subroutine, public dmat(ndim, focc, C, P)</div><div class="ttdoc">density matrix</div><div class="ttdef"><b>Definition:</b> <a href="scc__core_8f90_source.html#l01128">scc_core.f90:1129</a></div></div>
<div class="ttc" id="anamespacextb__scc__core_html_af6e7712a4d49d56302e167ba6034da6f"><div class="ttname"><a href="namespacextb__scc__core.html#af6e7712a4d49d56302e167ba6034da6f">xtb_scc_core::lpop</a></div><div class="ttdeci">subroutine, public lpop(n, nao, aoat, lao, occ, C, f, q, ql)</div><div class="ttdoc">Loewdin pop.</div><div class="ttdef"><b>Definition:</b> <a href="scc__core_8f90_source.html#l01345">scc_core.f90:1346</a></div></div>
<div class="ttc" id="anamespacextb__type__environment_html"><div class="ttname"><a href="namespacextb__type__environment.html">xtb_type_environment</a></div><div class="ttdoc">Calculation environment.</div><div class="ttdef"><b>Definition:</b> <a href="type_2environment_8f90_source.html#l00019">environment.f90:19</a></div></div>
<div class="ttc" id="anamespacextb__type__solvation_html"><div class="ttname"><a href="namespacextb__type__solvation.html">xtb_type_solvation</a></div><div class="ttdoc">Abstract solvation model.</div><div class="ttdef"><b>Definition:</b> <a href="solvation_8f90_source.html#l00019">solvation.f90:19</a></div></div>
<div class="ttc" id="anamespacextb__xtb__coulomb_html"><div class="ttname"><a href="namespacextb__xtb__coulomb.html">xtb_xtb_coulomb</a></div><div class="ttdoc">Implementation of an isotropic electrostatics container.</div><div class="ttdef"><b>Definition:</b> <a href="src_2xtb_2coulomb_8f90_source.html#l00019">coulomb.f90:19</a></div></div>
<div class="ttc" id="anamespacextb__xtb__data_html"><div class="ttname"><a href="namespacextb__xtb__data.html">xtb_xtb_data</a></div><div class="ttdoc">Parametrisation data for xTB methods.</div><div class="ttdef"><b>Definition:</b> <a href="xtb_2data_8f90_source.html#l00019">data.f90:19</a></div></div>
<div class="ttc" id="anamespacextb__xtb__dispersion_html"><div class="ttname"><a href="namespacextb__xtb__dispersion.html">xtb_xtb_dispersion</a></div><div class="ttdoc">Self-consistent dispersion energy.</div><div class="ttdef"><b>Definition:</b> <a href="dispersion_8f90_source.html#l00019">dispersion.f90:19</a></div></div>
<div class="ttc" id="anamespacextb__xtb__multipole_html"><div class="ttname"><a href="namespacextb__xtb__multipole.html">xtb_xtb_multipole</a></div><div class="ttdoc">TODO.</div><div class="ttdef"><b>Definition:</b> <a href="multipole_8f90_source.html#l00019">multipole.f90:19</a></div></div>
<div class="ttc" id="apseudodiag_8f90_html_afdad9eb3e146467bf9b609606bad29fa"><div class="ttname"><a href="pseudodiag_8f90.html#afdad9eb3e146467bf9b609606bad29fa">pseudodiag</a></div><div class="ttdeci">subroutine pseudodiag(n, nocc, fmo, eig)</div><div class="ttdef"><b>Definition:</b> <a href="pseudodiag_8f90_source.html#l00030">pseudodiag.f90:31</a></div></div>
<div class="ttc" id="astructxtb__mctc__lapack__eigensolve_1_1teigensolver_html"><div class="ttname"><a href="structxtb__mctc__lapack__eigensolve_1_1teigensolver.html">xtb_mctc_lapack_eigensolve::teigensolver</a></div><div class="ttdef"><b>Definition:</b> <a href="eigensolve_8F90_source.html#l00035">eigensolve.F90:35</a></div></div>
<div class="ttc" id="astructxtb__type__environment_1_1tenvironment_html"><div class="ttname"><a href="structxtb__type__environment_1_1tenvironment.html">xtb_type_environment::tenvironment</a></div><div class="ttdoc">Calculation environment.</div><div class="ttdef"><b>Definition:</b> <a href="type_2environment_8f90_source.html#l00038">environment.f90:38</a></div></div>
<div class="ttc" id="astructxtb__type__solvation_1_1tsolvation_html"><div class="ttname"><a href="structxtb__type__solvation_1_1tsolvation.html">xtb_type_solvation::tsolvation</a></div><div class="ttdef"><b>Definition:</b> <a href="solvation_8f90_source.html#l00028">solvation.f90:28</a></div></div>
<div class="ttc" id="astructxtb__xtb__coulomb_1_1txtbcoulomb_html"><div class="ttname"><a href="structxtb__xtb__coulomb_1_1txtbcoulomb.html">xtb_xtb_coulomb::txtbcoulomb</a></div><div class="ttdoc">Isotropic electrostatics.</div><div class="ttdef"><b>Definition:</b> <a href="src_2xtb_2coulomb_8f90_source.html#l00031">coulomb.f90:31</a></div></div>
<div class="ttc" id="astructxtb__xtb__data_1_1thamiltoniandata_html"><div class="ttname"><a href="structxtb__xtb__data_1_1thamiltoniandata.html">xtb_xtb_data::thamiltoniandata</a></div><div class="ttdoc">Data for the evaluation of the xTB core Hamiltonian.</div><div class="ttdef"><b>Definition:</b> <a href="xtb_2data_8f90_source.html#l00099">data.f90:99</a></div></div>
<div class="ttc" id="astructxtb__xtb__data_1_1txtbdata_html"><div class="ttname"><a href="structxtb__xtb__data_1_1txtbdata.html">xtb_xtb_data::txtbdata</a></div><div class="ttdoc">Parametrisation data for the xTB method.</div><div class="ttdef"><b>Definition:</b> <a href="xtb_2data_8f90_source.html#l00273">data.f90:273</a></div></div>
<div class="ttc" id="astructxtb__xtb__dispersion_1_1txtbdispersion_html"><div class="ttname"><a href="structxtb__xtb__dispersion_1_1txtbdispersion.html">xtb_xtb_dispersion::txtbdispersion</a></div><div class="ttdef"><b>Definition:</b> <a href="dispersion_8f90_source.html#l00032">dispersion.f90:32</a></div></div>
<div class="ttc" id="astructxtb__xtb__multipole_1_1txtbmultipole_html"><div class="ttname"><a href="structxtb__xtb__multipole_1_1txtbmultipole.html">xtb_xtb_multipole::txtbmultipole</a></div><div class="ttdef"><b>Definition:</b> <a href="multipole_8f90_source.html#l00028">multipole.f90:28</a></div></div>
<div class="ttc" id="asymmetry__i_8c_html_aa77c823a9fc018ae1d437369708d8727"><div class="ttname"><a href="symmetry__i_8c.html#aa77c823a9fc018ae1d437369708d8727">true</a></div><div class="ttdeci">int true(void)</div><div class="ttdef"><b>Definition:</b> <a href="symmetry__i_8c_source.html#l00132">symmetry_i.c:132</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Jan 29 2021 07:08:35 for My Project by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
